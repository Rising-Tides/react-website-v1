{"ast":null,"code":"var gt = Object.create;\nvar U = Object.defineProperty,\n    Rt = Object.defineProperties,\n    Tt = Object.getOwnPropertyDescriptor,\n    vt = Object.getOwnPropertyDescriptors,\n    xt = Object.getOwnPropertyNames,\n    $e = Object.getOwnPropertySymbols,\n    It = Object.getPrototypeOf,\n    be = Object.prototype.hasOwnProperty,\n    Pt = Object.prototype.propertyIsEnumerable;\n\nvar Me = (t, e, n) => e in t ? U(t, e, {\n  enumerable: !0,\n  configurable: !0,\n  writable: !0,\n  value: n\n}) : t[e] = n,\n    Ne = (t, e) => {\n  for (var n in e || (e = {})) be.call(e, n) && Me(t, n, e[n]);\n\n  if ($e) for (var n of $e(e)) Pt.call(e, n) && Me(t, n, e[n]);\n  return t;\n},\n    Ae = (t, e) => Rt(t, vt(e)),\n    $t = t => U(t, \"__esModule\", {\n  value: !0\n});\n\nvar bt = (t, e) => () => (e || t((e = {\n  exports: {}\n}).exports, e), e.exports),\n    Mt = (t, e) => {\n  for (var n in e) U(t, n, {\n    get: e[n],\n    enumerable: !0\n  });\n},\n    Nt = (t, e, n, r) => {\n  if (e && typeof e == \"object\" || typeof e == \"function\") for (let s of xt(e)) !be.call(t, s) && (n || s !== \"default\") && U(t, s, {\n    get: () => e[s],\n    enumerable: !(r = Tt(e, s)) || r.enumerable\n  });\n  return t;\n},\n    At = (t, e) => Nt($t(U(t != null ? gt(It(t)) : {}, \"default\", !e && t && t.__esModule ? {\n  get: () => t.default,\n  enumerable: !0\n} : {\n  value: t,\n  enumerable: !0\n})), t);\n\nvar I = (t, e, n) => new Promise((r, s) => {\n  var o = c => {\n    try {\n      i(n.next(c));\n    } catch (p) {\n      s(p);\n    }\n  },\n      a = c => {\n    try {\n      i(n.throw(c));\n    } catch (p) {\n      s(p);\n    }\n  },\n      i = c => c.done ? r(c.value) : Promise.resolve(c.value).then(o, a);\n\n  i((n = n.apply(t, e)).next());\n});\n\nvar nt = bt((fr, he) => {\n  \"use strict\";\n\n  var $n = Object.prototype.hasOwnProperty,\n      T = \"~\";\n\n  function B() {}\n\n  Object.create && (B.prototype = Object.create(null), new B().__proto__ || (T = !1));\n\n  function bn(t, e, n) {\n    this.fn = t, this.context = e, this.once = n || !1;\n  }\n\n  function tt(t, e, n, r, s) {\n    if (typeof n != \"function\") throw new TypeError(\"The listener must be a function\");\n    var o = new bn(n, r || t, s),\n        a = T ? T + e : e;\n    return t._events[a] ? t._events[a].fn ? t._events[a] = [t._events[a], o] : t._events[a].push(o) : (t._events[a] = o, t._eventsCount++), t;\n  }\n\n  function se(t, e) {\n    --t._eventsCount === 0 ? t._events = new B() : delete t._events[e];\n  }\n\n  function g() {\n    this._events = new B(), this._eventsCount = 0;\n  }\n\n  g.prototype.eventNames = function () {\n    var e = [],\n        n,\n        r;\n    if (this._eventsCount === 0) return e;\n\n    for (r in n = this._events) $n.call(n, r) && e.push(T ? r.slice(1) : r);\n\n    return Object.getOwnPropertySymbols ? e.concat(Object.getOwnPropertySymbols(n)) : e;\n  };\n\n  g.prototype.listeners = function (e) {\n    var n = T ? T + e : e,\n        r = this._events[n];\n    if (!r) return [];\n    if (r.fn) return [r.fn];\n\n    for (var s = 0, o = r.length, a = new Array(o); s < o; s++) a[s] = r[s].fn;\n\n    return a;\n  };\n\n  g.prototype.listenerCount = function (e) {\n    var n = T ? T + e : e,\n        r = this._events[n];\n    return r ? r.fn ? 1 : r.length : 0;\n  };\n\n  g.prototype.emit = function (e, n, r, s, o, a) {\n    var i = T ? T + e : e;\n    if (!this._events[i]) return !1;\n    var c = this._events[i],\n        p = arguments.length,\n        l,\n        u;\n\n    if (c.fn) {\n      switch (c.once && this.removeListener(e, c.fn, void 0, !0), p) {\n        case 1:\n          return c.fn.call(c.context), !0;\n\n        case 2:\n          return c.fn.call(c.context, n), !0;\n\n        case 3:\n          return c.fn.call(c.context, n, r), !0;\n\n        case 4:\n          return c.fn.call(c.context, n, r, s), !0;\n\n        case 5:\n          return c.fn.call(c.context, n, r, s, o), !0;\n\n        case 6:\n          return c.fn.call(c.context, n, r, s, o, a), !0;\n      }\n\n      for (u = 1, l = new Array(p - 1); u < p; u++) l[u - 1] = arguments[u];\n\n      c.fn.apply(c.context, l);\n    } else {\n      var v = c.length,\n          M;\n\n      for (u = 0; u < v; u++) switch (c[u].once && this.removeListener(e, c[u].fn, void 0, !0), p) {\n        case 1:\n          c[u].fn.call(c[u].context);\n          break;\n\n        case 2:\n          c[u].fn.call(c[u].context, n);\n          break;\n\n        case 3:\n          c[u].fn.call(c[u].context, n, r);\n          break;\n\n        case 4:\n          c[u].fn.call(c[u].context, n, r, s);\n          break;\n\n        default:\n          if (!l) for (M = 1, l = new Array(p - 1); M < p; M++) l[M - 1] = arguments[M];\n          c[u].fn.apply(c[u].context, l);\n      }\n    }\n\n    return !0;\n  };\n\n  g.prototype.on = function (e, n, r) {\n    return tt(this, e, n, r, !1);\n  };\n\n  g.prototype.once = function (e, n, r) {\n    return tt(this, e, n, r, !0);\n  };\n\n  g.prototype.removeListener = function (e, n, r, s) {\n    var o = T ? T + e : e;\n    if (!this._events[o]) return this;\n    if (!n) return se(this, o), this;\n    var a = this._events[o];\n    if (a.fn) a.fn === n && (!s || a.once) && (!r || a.context === r) && se(this, o);else {\n      for (var i = 0, c = [], p = a.length; i < p; i++) (a[i].fn !== n || s && !a[i].once || r && a[i].context !== r) && c.push(a[i]);\n\n      c.length ? this._events[o] = c.length === 1 ? c[0] : c : se(this, o);\n    }\n    return this;\n  };\n\n  g.prototype.removeAllListeners = function (e) {\n    var n;\n    return e ? (n = T ? T + e : e, this._events[n] && se(this, n)) : (this._events = new B(), this._eventsCount = 0), this;\n  };\n\n  g.prototype.off = g.prototype.removeListener;\n  g.prototype.addListener = g.prototype.on;\n  g.prefixed = T;\n  g.EventEmitter = g;\n  typeof he != \"undefined\" && (he.exports = g);\n});\n\nfunction wt(t) {\n  let e = {\n    exports: {}\n  };\n  return t(e, e.exports), e.exports;\n}\n\nvar St = Number.MAX_SAFE_INTEGER || 9007199254740991;\n\nvar de = {\n  SEMVER_SPEC_VERSION: \"2.0.0\",\n  MAX_LENGTH: 256,\n  MAX_SAFE_INTEGER: St,\n  MAX_SAFE_COMPONENT_LENGTH: 16\n},\n    Lt = typeof process == \"object\" && process.env && process.env.NODE_DEBUG && /\\bsemver\\b/i.test(process.env.NODE_DEBUG) ? function () {\n  for (var _len = arguments.length, t = new Array(_len), _key = 0; _key < _len; _key++) {\n    t[_key] = arguments[_key];\n  }\n\n  return console.error(\"SEMVER\", ...t);\n} : () => {},\n    d = Lt,\n    K = wt(function (t, e) {\n  let {\n    MAX_SAFE_COMPONENT_LENGTH: n\n  } = de,\n      r = (e = t.exports = {}).re = [],\n      s = e.src = [],\n      o = e.t = {},\n      a = 0,\n      i = (c, p, l) => {\n    let u = a++;\n    d(u, p), o[c] = u, s[u] = p, r[u] = new RegExp(p, l ? \"g\" : void 0);\n  };\n\n  i(\"NUMERICIDENTIFIER\", \"0|[1-9]\\\\d*\"), i(\"NUMERICIDENTIFIERLOOSE\", \"[0-9]+\"), i(\"NONNUMERICIDENTIFIER\", \"\\\\d*[a-zA-Z-][a-zA-Z0-9-]*\"), i(\"MAINVERSION\", `(${s[o.NUMERICIDENTIFIER]})\\\\.(${s[o.NUMERICIDENTIFIER]})\\\\.(${s[o.NUMERICIDENTIFIER]})`), i(\"MAINVERSIONLOOSE\", `(${s[o.NUMERICIDENTIFIERLOOSE]})\\\\.(${s[o.NUMERICIDENTIFIERLOOSE]})\\\\.(${s[o.NUMERICIDENTIFIERLOOSE]})`), i(\"PRERELEASEIDENTIFIER\", `(?:${s[o.NUMERICIDENTIFIER]}|${s[o.NONNUMERICIDENTIFIER]})`), i(\"PRERELEASEIDENTIFIERLOOSE\", `(?:${s[o.NUMERICIDENTIFIERLOOSE]}|${s[o.NONNUMERICIDENTIFIER]})`), i(\"PRERELEASE\", `(?:-(${s[o.PRERELEASEIDENTIFIER]}(?:\\\\.${s[o.PRERELEASEIDENTIFIER]})*))`), i(\"PRERELEASELOOSE\", `(?:-?(${s[o.PRERELEASEIDENTIFIERLOOSE]}(?:\\\\.${s[o.PRERELEASEIDENTIFIERLOOSE]})*))`), i(\"BUILDIDENTIFIER\", \"[0-9A-Za-z-]+\"), i(\"BUILD\", `(?:\\\\+(${s[o.BUILDIDENTIFIER]}(?:\\\\.${s[o.BUILDIDENTIFIER]})*))`), i(\"FULLPLAIN\", `v?${s[o.MAINVERSION]}${s[o.PRERELEASE]}?${s[o.BUILD]}?`), i(\"FULL\", `^${s[o.FULLPLAIN]}$`), i(\"LOOSEPLAIN\", `[v=\\\\s]*${s[o.MAINVERSIONLOOSE]}${s[o.PRERELEASELOOSE]}?${s[o.BUILD]}?`), i(\"LOOSE\", `^${s[o.LOOSEPLAIN]}$`), i(\"GTLT\", \"((?:<|>)?=?)\"), i(\"XRANGEIDENTIFIERLOOSE\", `${s[o.NUMERICIDENTIFIERLOOSE]}|x|X|\\\\*`), i(\"XRANGEIDENTIFIER\", `${s[o.NUMERICIDENTIFIER]}|x|X|\\\\*`), i(\"XRANGEPLAIN\", `[v=\\\\s]*(${s[o.XRANGEIDENTIFIER]})(?:\\\\.(${s[o.XRANGEIDENTIFIER]})(?:\\\\.(${s[o.XRANGEIDENTIFIER]})(?:${s[o.PRERELEASE]})?${s[o.BUILD]}?)?)?`), i(\"XRANGEPLAINLOOSE\", `[v=\\\\s]*(${s[o.XRANGEIDENTIFIERLOOSE]})(?:\\\\.(${s[o.XRANGEIDENTIFIERLOOSE]})(?:\\\\.(${s[o.XRANGEIDENTIFIERLOOSE]})(?:${s[o.PRERELEASELOOSE]})?${s[o.BUILD]}?)?)?`), i(\"XRANGE\", `^${s[o.GTLT]}\\\\s*${s[o.XRANGEPLAIN]}$`), i(\"XRANGELOOSE\", `^${s[o.GTLT]}\\\\s*${s[o.XRANGEPLAINLOOSE]}$`), i(\"COERCE\", `(^|[^\\\\d])(\\\\d{1,${n}})(?:\\\\.(\\\\d{1,${n}}))?(?:\\\\.(\\\\d{1,${n}}))?(?:$|[^\\\\d])`), i(\"COERCERTL\", s[o.COERCE], !0), i(\"LONETILDE\", \"(?:~>?)\"), i(\"TILDETRIM\", `(\\\\s*)${s[o.LONETILDE]}\\\\s+`, !0), e.tildeTrimReplace = \"$1~\", i(\"TILDE\", `^${s[o.LONETILDE]}${s[o.XRANGEPLAIN]}$`), i(\"TILDELOOSE\", `^${s[o.LONETILDE]}${s[o.XRANGEPLAINLOOSE]}$`), i(\"LONECARET\", \"(?:\\\\^)\"), i(\"CARETTRIM\", `(\\\\s*)${s[o.LONECARET]}\\\\s+`, !0), e.caretTrimReplace = \"$1^\", i(\"CARET\", `^${s[o.LONECARET]}${s[o.XRANGEPLAIN]}$`), i(\"CARETLOOSE\", `^${s[o.LONECARET]}${s[o.XRANGEPLAINLOOSE]}$`), i(\"COMPARATORLOOSE\", `^${s[o.GTLT]}\\\\s*(${s[o.LOOSEPLAIN]})$|^$`), i(\"COMPARATOR\", `^${s[o.GTLT]}\\\\s*(${s[o.FULLPLAIN]})$|^$`), i(\"COMPARATORTRIM\", `(\\\\s*)${s[o.GTLT]}\\\\s*(${s[o.LOOSEPLAIN]}|${s[o.XRANGEPLAIN]})`, !0), e.comparatorTrimReplace = \"$1$2$3\", i(\"HYPHENRANGE\", `^\\\\s*(${s[o.XRANGEPLAIN]})\\\\s+-\\\\s+(${s[o.XRANGEPLAIN]})\\\\s*$`), i(\"HYPHENRANGELOOSE\", `^\\\\s*(${s[o.XRANGEPLAINLOOSE]})\\\\s+-\\\\s+(${s[o.XRANGEPLAINLOOSE]})\\\\s*$`), i(\"STAR\", \"(<|>)?=?\\\\s*\\\\*\"), i(\"GTE0\", \"^\\\\s*>=\\\\s*0.0.0\\\\s*$\"), i(\"GTE0PRE\", \"^\\\\s*>=\\\\s*0.0.0-0\\\\s*$\");\n}),\n    we = /^[0-9]+$/,\n    Se = (t, e) => {\n  let n = we.test(t),\n      r = we.test(e);\n  return n && r && (t = +t, e = +e), t === e ? 0 : n && !r ? -1 : r && !n ? 1 : t < e ? -1 : 1;\n},\n    Ct = (t, e) => Se(e, t),\n    Ot = {\n  compareIdentifiers: Se,\n  rcompareIdentifiers: Ct\n},\n    {\n  MAX_LENGTH: Le,\n  MAX_SAFE_INTEGER: z\n} = de,\n    {\n  re: Ce,\n  t: Oe\n} = K,\n    {\n  compareIdentifiers: j\n} = Ot,\n    E = class {\n  constructor(e, n) {\n    if (n && typeof n == \"object\" || (n = {\n      loose: !!n,\n      includePrerelease: !1\n    }), e instanceof E) {\n      if (e.loose === !!n.loose && e.includePrerelease === !!n.includePrerelease) return e;\n      e = e.version;\n    } else if (typeof e != \"string\") throw new TypeError(`Invalid Version: ${e}`);\n\n    if (e.length > Le) throw new TypeError(`version is longer than ${Le} characters`);\n    d(\"SemVer\", e, n), this.options = n, this.loose = !!n.loose, this.includePrerelease = !!n.includePrerelease;\n    let r = e.trim().match(n.loose ? Ce[Oe.LOOSE] : Ce[Oe.FULL]);\n    if (!r) throw new TypeError(`Invalid Version: ${e}`);\n    if (this.raw = e, this.major = +r[1], this.minor = +r[2], this.patch = +r[3], this.major > z || this.major < 0) throw new TypeError(\"Invalid major version\");\n    if (this.minor > z || this.minor < 0) throw new TypeError(\"Invalid minor version\");\n    if (this.patch > z || this.patch < 0) throw new TypeError(\"Invalid patch version\");\n    r[4] ? this.prerelease = r[4].split(\".\").map(s => {\n      if (/^[0-9]+$/.test(s)) {\n        let o = +s;\n        if (o >= 0 && o < z) return o;\n      }\n\n      return s;\n    }) : this.prerelease = [], this.build = r[5] ? r[5].split(\".\") : [], this.format();\n  }\n\n  format() {\n    return this.version = `${this.major}.${this.minor}.${this.patch}`, this.prerelease.length && (this.version += `-${this.prerelease.join(\".\")}`), this.version;\n  }\n\n  toString() {\n    return this.version;\n  }\n\n  compare(e) {\n    if (d(\"SemVer.compare\", this.version, this.options, e), !(e instanceof E)) {\n      if (typeof e == \"string\" && e === this.version) return 0;\n      e = new E(e, this.options);\n    }\n\n    return e.version === this.version ? 0 : this.compareMain(e) || this.comparePre(e);\n  }\n\n  compareMain(e) {\n    return e instanceof E || (e = new E(e, this.options)), j(this.major, e.major) || j(this.minor, e.minor) || j(this.patch, e.patch);\n  }\n\n  comparePre(e) {\n    if (e instanceof E || (e = new E(e, this.options)), this.prerelease.length && !e.prerelease.length) return -1;\n    if (!this.prerelease.length && e.prerelease.length) return 1;\n    if (!this.prerelease.length && !e.prerelease.length) return 0;\n    let n = 0;\n\n    do {\n      let r = this.prerelease[n],\n          s = e.prerelease[n];\n      if (d(\"prerelease compare\", n, r, s), r === void 0 && s === void 0) return 0;\n      if (s === void 0) return 1;\n      if (r === void 0) return -1;\n      if (r !== s) return j(r, s);\n    } while (++n);\n  }\n\n  compareBuild(e) {\n    e instanceof E || (e = new E(e, this.options));\n    let n = 0;\n\n    do {\n      let r = this.build[n],\n          s = e.build[n];\n      if (d(\"prerelease compare\", n, r, s), r === void 0 && s === void 0) return 0;\n      if (s === void 0) return 1;\n      if (r === void 0) return -1;\n      if (r !== s) return j(r, s);\n    } while (++n);\n  }\n\n  inc(e, n) {\n    switch (e) {\n      case \"premajor\":\n        this.prerelease.length = 0, this.patch = 0, this.minor = 0, this.major++, this.inc(\"pre\", n);\n        break;\n\n      case \"preminor\":\n        this.prerelease.length = 0, this.patch = 0, this.minor++, this.inc(\"pre\", n);\n        break;\n\n      case \"prepatch\":\n        this.prerelease.length = 0, this.inc(\"patch\", n), this.inc(\"pre\", n);\n        break;\n\n      case \"prerelease\":\n        this.prerelease.length === 0 && this.inc(\"patch\", n), this.inc(\"pre\", n);\n        break;\n\n      case \"major\":\n        this.minor === 0 && this.patch === 0 && this.prerelease.length !== 0 || this.major++, this.minor = 0, this.patch = 0, this.prerelease = [];\n        break;\n\n      case \"minor\":\n        this.patch === 0 && this.prerelease.length !== 0 || this.minor++, this.patch = 0, this.prerelease = [];\n        break;\n\n      case \"patch\":\n        this.prerelease.length === 0 && this.patch++, this.prerelease = [];\n        break;\n\n      case \"pre\":\n        if (this.prerelease.length === 0) this.prerelease = [0];else {\n          let r = this.prerelease.length;\n\n          for (; --r >= 0;) typeof this.prerelease[r] == \"number\" && (this.prerelease[r]++, r = -2);\n\n          r === -1 && this.prerelease.push(0);\n        }\n        n && (this.prerelease[0] === n ? isNaN(this.prerelease[1]) && (this.prerelease = [n, 0]) : this.prerelease = [n, 0]);\n        break;\n\n      default:\n        throw new Error(`invalid increment argument: ${e}`);\n    }\n\n    return this.format(), this.raw = this.version, this;\n  }\n\n},\n    _t = (t, e, n) => new E(t, n).compare(new E(e, n)),\n    D = _t,\n    Dt = (t, e, n) => D(t, e, n) === 0,\n    kt = Dt,\n    Jt = (t, e, n) => D(t, e, n) !== 0,\n    qt = Jt,\n    Gt = (t, e, n) => D(t, e, n) > 0,\n    Ut = Gt,\n    Kt = (t, e, n) => D(t, e, n) >= 0,\n    jt = Kt,\n    Ft = (t, e, n) => D(t, e, n) < 0,\n    Wt = Ft,\n    Xt = (t, e, n) => D(t, e, n) <= 0,\n    Bt = Xt,\n    Ht = (t, e, n, r) => {\n  switch (e) {\n    case \"===\":\n      return typeof t == \"object\" && (t = t.version), typeof n == \"object\" && (n = n.version), t === n;\n\n    case \"!==\":\n      return typeof t == \"object\" && (t = t.version), typeof n == \"object\" && (n = n.version), t !== n;\n\n    case \"\":\n    case \"=\":\n    case \"==\":\n      return kt(t, n, r);\n\n    case \"!=\":\n      return qt(t, n, r);\n\n    case \">\":\n      return Ut(t, n, r);\n\n    case \">=\":\n      return jt(t, n, r);\n\n    case \"<\":\n      return Wt(t, n, r);\n\n    case \"<=\":\n      return Bt(t, n, r);\n\n    default:\n      throw new TypeError(`Invalid operator: ${e}`);\n  }\n},\n    me = Ht,\n    F = Symbol(\"SemVer ANY\"),\n    L = class {\n  static get ANY() {\n    return F;\n  }\n\n  constructor(e, n) {\n    if (n && typeof n == \"object\" || (n = {\n      loose: !!n,\n      includePrerelease: !1\n    }), e instanceof L) {\n      if (e.loose === !!n.loose) return e;\n      e = e.value;\n    }\n\n    d(\"comparator\", e, n), this.options = n, this.loose = !!n.loose, this.parse(e), this.semver === F ? this.value = \"\" : this.value = this.operator + this.semver.version, d(\"comp\", this);\n  }\n\n  parse(e) {\n    let n = this.options.loose ? _e[De.COMPARATORLOOSE] : _e[De.COMPARATOR],\n        r = e.match(n);\n    if (!r) throw new TypeError(`Invalid comparator: ${e}`);\n    this.operator = r[1] !== void 0 ? r[1] : \"\", this.operator === \"=\" && (this.operator = \"\"), r[2] ? this.semver = new E(r[2], this.options.loose) : this.semver = F;\n  }\n\n  toString() {\n    return this.value;\n  }\n\n  test(e) {\n    if (d(\"Comparator.test\", e, this.options.loose), this.semver === F || e === F) return !0;\n    if (typeof e == \"string\") try {\n      e = new E(e, this.options);\n    } catch (n) {\n      return !1;\n    }\n    return me(e, this.operator, this.semver, this.options);\n  }\n\n  intersects(e, n) {\n    if (!(e instanceof L)) throw new TypeError(\"a Comparator is required\");\n    if (n && typeof n == \"object\" || (n = {\n      loose: !!n,\n      includePrerelease: !1\n    }), this.operator === \"\") return this.value === \"\" || new N(e.value, n).test(this.value);\n    if (e.operator === \"\") return e.value === \"\" || new N(this.value, n).test(e.semver);\n    let r = !(this.operator !== \">=\" && this.operator !== \">\" || e.operator !== \">=\" && e.operator !== \">\"),\n        s = !(this.operator !== \"<=\" && this.operator !== \"<\" || e.operator !== \"<=\" && e.operator !== \"<\"),\n        o = this.semver.version === e.semver.version,\n        a = !(this.operator !== \">=\" && this.operator !== \"<=\" || e.operator !== \">=\" && e.operator !== \"<=\"),\n        i = me(this.semver, \"<\", e.semver, n) && (this.operator === \">=\" || this.operator === \">\") && (e.operator === \"<=\" || e.operator === \"<\"),\n        c = me(this.semver, \">\", e.semver, n) && (this.operator === \"<=\" || this.operator === \"<\") && (e.operator === \">=\" || e.operator === \">\");\n    return r || s || o && a || i || c;\n  }\n\n},\n    {\n  re: _e,\n  t: De\n} = K,\n    N = class {\n  constructor(e, n) {\n    if (n && typeof n == \"object\" || (n = {\n      loose: !!n,\n      includePrerelease: !1\n    }), e instanceof N) return e.loose === !!n.loose && e.includePrerelease === !!n.includePrerelease ? e : new N(e.raw, n);\n    if (e instanceof L) return this.raw = e.value, this.set = [[e]], this.format(), this;\n    if (this.options = n, this.loose = !!n.loose, this.includePrerelease = !!n.includePrerelease, this.raw = e, this.set = e.split(/\\s*\\|\\|\\s*/).map(r => this.parseRange(r.trim())).filter(r => r.length), !this.set.length) throw new TypeError(`Invalid SemVer Range: ${e}`);\n    this.format();\n  }\n\n  format() {\n    return this.range = this.set.map(e => e.join(\" \").trim()).join(\"||\").trim(), this.range;\n  }\n\n  toString() {\n    return this.range;\n  }\n\n  parseRange(e) {\n    let {\n      loose: n\n    } = this.options;\n    e = e.trim();\n    let r = n ? y[h.HYPHENRANGELOOSE] : y[h.HYPHENRANGE];\n    e = e.replace(r, cn(this.options.includePrerelease)), d(\"hyphen replace\", e), e = e.replace(y[h.COMPARATORTRIM], Vt), d(\"comparator trim\", e, y[h.COMPARATORTRIM]), e = (e = (e = e.replace(y[h.TILDETRIM], zt)).replace(y[h.CARETTRIM], Yt)).split(/\\s+/).join(\" \");\n    let s = n ? y[h.COMPARATORLOOSE] : y[h.COMPARATOR];\n    return e.split(\" \").map(o => Zt(o, this.options)).join(\" \").split(/\\s+/).map(o => an(o, this.options)).filter(this.options.loose ? o => !!o.match(s) : () => !0).map(o => new L(o, this.options));\n  }\n\n  intersects(e, n) {\n    if (!(e instanceof N)) throw new TypeError(\"a Range is required\");\n    return this.set.some(r => ke(r, n) && e.set.some(s => ke(s, n) && r.every(o => s.every(a => o.intersects(a, n)))));\n  }\n\n  test(e) {\n    if (!e) return !1;\n    if (typeof e == \"string\") try {\n      e = new E(e, this.options);\n    } catch (n) {\n      return !1;\n    }\n\n    for (let n = 0; n < this.set.length; n++) if (ln(this.set[n], e, this.options)) return !0;\n\n    return !1;\n  }\n\n},\n    {\n  re: y,\n  t: h,\n  comparatorTrimReplace: Vt,\n  tildeTrimReplace: zt,\n  caretTrimReplace: Yt\n} = K,\n    ke = (t, e) => {\n  let n = !0,\n      r = t.slice(),\n      s = r.pop();\n\n  for (; n && r.length;) n = r.every(o => s.intersects(o, e)), s = r.pop();\n\n  return n;\n},\n    Zt = (t, e) => (d(\"comp\", t, e), t = tn(t, e), d(\"caret\", t), t = Qt(t, e), d(\"tildes\", t), t = rn(t, e), d(\"xrange\", t), t = on(t, e), d(\"stars\", t), t),\n    R = t => !t || t.toLowerCase() === \"x\" || t === \"*\",\n    Qt = (t, e) => t.trim().split(/\\s+/).map(n => en(n, e)).join(\" \"),\n    en = (t, e) => {\n  let n = e.loose ? y[h.TILDELOOSE] : y[h.TILDE];\n  return t.replace(n, (r, s, o, a, i) => {\n    let c;\n    return d(\"tilde\", t, r, s, o, a, i), R(s) ? c = \"\" : R(o) ? c = `>=${s}.0.0 <${+s + 1}.0.0-0` : R(a) ? c = `>=${s}.${o}.0 <${s}.${+o + 1}.0-0` : i ? (d(\"replaceTilde pr\", i), c = `>=${s}.${o}.${a}-${i} <${s}.${+o + 1}.0-0`) : c = `>=${s}.${o}.${a} <${s}.${+o + 1}.0-0`, d(\"tilde return\", c), c;\n  });\n},\n    tn = (t, e) => t.trim().split(/\\s+/).map(n => nn(n, e)).join(\" \"),\n    nn = (t, e) => {\n  d(\"caret\", t, e);\n  let n = e.loose ? y[h.CARETLOOSE] : y[h.CARET],\n      r = e.includePrerelease ? \"-0\" : \"\";\n  return t.replace(n, (s, o, a, i, c) => {\n    let p;\n    return d(\"caret\", t, s, o, a, i, c), R(o) ? p = \"\" : R(a) ? p = `>=${o}.0.0${r} <${+o + 1}.0.0-0` : R(i) ? p = o === \"0\" ? `>=${o}.${a}.0${r} <${o}.${+a + 1}.0-0` : `>=${o}.${a}.0${r} <${+o + 1}.0.0-0` : c ? (d(\"replaceCaret pr\", c), p = o === \"0\" ? a === \"0\" ? `>=${o}.${a}.${i}-${c} <${o}.${a}.${+i + 1}-0` : `>=${o}.${a}.${i}-${c} <${o}.${+a + 1}.0-0` : `>=${o}.${a}.${i}-${c} <${+o + 1}.0.0-0`) : (d(\"no pr\"), p = o === \"0\" ? a === \"0\" ? `>=${o}.${a}.${i}${r} <${o}.${a}.${+i + 1}-0` : `>=${o}.${a}.${i}${r} <${o}.${+a + 1}.0-0` : `>=${o}.${a}.${i} <${+o + 1}.0.0-0`), d(\"caret return\", p), p;\n  });\n},\n    rn = (t, e) => (d(\"replaceXRanges\", t, e), t.split(/\\s+/).map(n => sn(n, e)).join(\" \")),\n    sn = (t, e) => {\n  t = t.trim();\n  let n = e.loose ? y[h.XRANGELOOSE] : y[h.XRANGE];\n  return t.replace(n, (r, s, o, a, i, c) => {\n    d(\"xRange\", t, r, s, o, a, i, c);\n    let p = R(o),\n        l = p || R(a),\n        u = l || R(i),\n        v = u;\n    return s === \"=\" && v && (s = \"\"), c = e.includePrerelease ? \"-0\" : \"\", p ? r = s === \">\" || s === \"<\" ? \"<0.0.0-0\" : \"*\" : s && v ? (l && (a = 0), i = 0, s === \">\" ? (s = \">=\", l ? (o = +o + 1, a = 0, i = 0) : (a = +a + 1, i = 0)) : s === \"<=\" && (s = \"<\", l ? o = +o + 1 : a = +a + 1), s === \"<\" && (c = \"-0\"), r = `${s + o}.${a}.${i}${c}`) : l ? r = `>=${o}.0.0${c} <${+o + 1}.0.0-0` : u && (r = `>=${o}.${a}.0${c} <${o}.${+a + 1}.0-0`), d(\"xRange return\", r), r;\n  });\n},\n    on = (t, e) => (d(\"replaceStars\", t, e), t.trim().replace(y[h.STAR], \"\")),\n    an = (t, e) => (d(\"replaceGTE0\", t, e), t.trim().replace(y[e.includePrerelease ? h.GTE0PRE : h.GTE0], \"\")),\n    cn = t => (e, n, r, s, o, a, i, c, p, l, u, v, M) => `${n = R(r) ? \"\" : R(s) ? `>=${r}.0.0${t ? \"-0\" : \"\"}` : R(o) ? `>=${r}.${s}.0${t ? \"-0\" : \"\"}` : a ? `>=${n}` : `>=${n}${t ? \"-0\" : \"\"}`} ${c = R(p) ? \"\" : R(l) ? `<${+p + 1}.0.0-0` : R(u) ? `<${p}.${+l + 1}.0-0` : v ? `<=${p}.${l}.${u}-${v}` : t ? `<${p}.${l}.${+u + 1}-0` : `<=${c}`}`.trim(),\n    ln = (t, e, n) => {\n  for (let r = 0; r < t.length; r++) if (!t[r].test(e)) return !1;\n\n  if (e.prerelease.length && !n.includePrerelease) {\n    for (let r = 0; r < t.length; r++) if (d(t[r].semver), t[r].semver !== L.ANY && t[r].semver.prerelease.length > 0) {\n      let s = t[r].semver;\n      if (s.major === e.major && s.minor === e.minor && s.patch === e.patch) return !0;\n    }\n\n    return !1;\n  }\n\n  return !0;\n},\n    Je = (t, e, n) => {\n  try {\n    e = new N(e, n);\n  } catch (r) {\n    return !1;\n  }\n\n  return e.test(t);\n};\n\nvar {\n  MAX_LENGTH: pn\n} = de,\n    {\n  re: qe,\n  t: Ge\n} = K,\n    un = (t, e) => {\n  if (e && typeof e == \"object\" || (e = {\n    loose: !!e,\n    includePrerelease: !1\n  }), t instanceof E) return t;\n  if (typeof t != \"string\" || t.length > pn || !(e.loose ? qe[Ge.LOOSE] : qe[Ge.FULL]).test(t)) return null;\n\n  try {\n    return new E(t, e);\n  } catch (n) {\n    return null;\n  }\n},\n    dn = un,\n    {\n  re: Y,\n  t: Z\n} = K,\n    Ue = (t, e) => {\n  if (t instanceof E) return t;\n  if (typeof t == \"number\" && (t = String(t)), typeof t != \"string\") return null;\n  let n = null;\n\n  if ((e = e || {}).rtl) {\n    let r;\n\n    for (; (r = Y[Z.COERCERTL].exec(t)) && (!n || n.index + n[0].length !== t.length);) n && r.index + r[0].length === n.index + n[0].length || (n = r), Y[Z.COERCERTL].lastIndex = r.index + r[1].length + r[2].length;\n\n    Y[Z.COERCERTL].lastIndex = -1;\n  } else n = t.match(Y[Z.COERCE]);\n\n  return n === null ? null : dn(`${n[2]}.${n[3] || \"0\"}.${n[4] || \"0\"}`, e);\n};\n\nfunction mn(t) {\n  return String.fromCharCode(parseInt(t.slice(1), 16));\n}\n\nfunction En(t) {\n  return `%${`00${t.charCodeAt(0).toString(16)}`.slice(-2)}`;\n}\n\nfunction hn(t) {\n  return btoa(encodeURIComponent(t).replace(/%[0-9A-F]{2}/g, mn));\n}\n\nfunction fn(t) {\n  return decodeURIComponent(Array.from(atob(t), En).join(\"\"));\n}\n\nfunction Q(t) {\n  return hn(JSON.stringify(t));\n}\n\nfunction Ke(t) {\n  return JSON.parse(fn(t));\n}\n\nimport { RPCErrorCode as vn, SDKErrorCode as k, SDKWarningCode as ne } from \"@magic-sdk/types\";\nimport { MagicPayloadMethod as yn, RPCErrorCode as gn } from \"@magic-sdk/types\";\n\nfunction $(t) {\n  return typeof t == \"undefined\";\n}\n\nfunction Rn(t) {\n  return t === null;\n}\n\nfunction ee(t) {\n  return Rn(t) || $(t);\n}\n\nfunction er(t) {\n  return ee(t) ? !1 : !$(t.jsonrpc) && !$(t.id) && !$(t.method) && !$(t.params);\n}\n\nfunction je(t) {\n  return ee(t) ? !1 : !$(t.jsonrpc) && !$(t.id) && (!$(t.result) || !$(t.error));\n}\n\nfunction tr(t) {\n  return ee(t) ? !1 : typeof t == \"string\" && Object.values(yn).includes(t);\n}\n\nfunction Fe(t) {\n  return ee(t) ? !1 : typeof t == \"number\" && Object.values(gn).includes(t);\n}\n\nfunction te(t) {\n  if (!t) return !0;\n\n  for (let e in t) if (Object.hasOwnProperty.call(t, e)) return !1;\n\n  return !0;\n}\n\nvar m = {};\n\nfunction Tn(t, e) {\n  return Object.assign(m, e), t;\n}\n\nvar We = {\n  \"magic-sdk\": \"magic-sdk\",\n  \"@magic-sdk/react-native\": \"magic-sdk-rn\"\n};\nvar b = class extends Error {\n  constructor(e, n) {\n    super(`Magic SDK Error: [${e}] ${n}`);\n    this.code = e;\n    this.rawMessage = n;\n    this.__proto__ = Error;\n    Object.setPrototypeOf(this, b.prototype);\n  }\n\n},\n    A = class extends Error {\n  constructor(e) {\n    super();\n    this.__proto__ = Error;\n    let n = Number(e == null ? void 0 : e.code);\n    this.rawMessage = (e == null ? void 0 : e.message) || \"Internal error\", this.code = Fe(n) ? n : vn.InternalError, this.message = `Magic RPC Error: [${this.code}] ${this.rawMessage}`, Object.setPrototypeOf(this, A.prototype);\n  }\n\n},\n    W = class {\n  constructor(e, n) {\n    this.code = e;\n    this.rawMessage = n;\n    this.message = `Magic SDK Warning: [${e}] ${n}`;\n  }\n\n  log() {\n    console.warn(this.message);\n  }\n\n},\n    X = class extends Error {\n  constructor(e, n, r, s) {\n    super(`Magic Extension Error (${e.name}): [${n}] ${r}`);\n    this.code = n;\n    this.rawMessage = r;\n    this.data = s;\n    this.__proto__ = Error;\n    Object.setPrototypeOf(this, X.prototype);\n  }\n\n},\n    re = class {\n  constructor(e, n, r) {\n    this.code = n;\n    this.rawMessage = r;\n    this.message = `Magic Extension Warning (${e.name}): [${n}] ${r}`;\n  }\n\n  log() {\n    console.warn(this.message);\n  }\n\n};\n\nfunction Xe() {\n  return new b(k.MissingApiKey, \"Please provide an API key that you acquired from the Magic developer dashboard.\");\n}\n\nfunction cr() {\n  return new b(k.ModalNotReady, \"Modal is not ready.\");\n}\n\nfunction Be() {\n  return new b(k.MalformedResponse, \"Response from the Magic iframe is malformed.\");\n}\n\nfunction He(t) {\n  return new b(k.ExtensionNotInitialized, `Extensions must be initialized with a Magic SDK instance before \\`Extension.${t}\\` can be accessed. Do not invoke \\`Extension.${t}\\` inside an extension constructor.`);\n}\n\nfunction Ve(t) {\n  let e = `Some extensions are incompatible with \\`${m.sdkName}@${m.version}\\`:`;\n  return t.filter(n => typeof n.compat != \"undefined\" && n.compat !== null).forEach(n => {\n    let r = n.compat[m.sdkName];\n    typeof r == \"string\" ? e += `\n  - Extension \\`${n.name}\\` supports version(s) \\`${r}\\`` : r || (e += `\n  - Extension \\`${n.name}\\` does not support ${m.platform} environments.`);\n  }), new b(k.IncompatibleExtensions, e);\n}\n\nfunction ze(t) {\n  let e = n => {\n    let r = n + 1,\n        s = r % 10,\n        o = r % 100;\n    return s === 1 && o !== 11 ? `${r}st` : s === 2 && o !== 12 ? `${r}nd` : s === 3 && o !== 13 ? `${r}rd` : `${r}th`;\n  };\n\n  return new b(k.InvalidArgument, `Invalid ${e(t.argument)} argument given to \\`${t.procedure}\\`.\n  Expected: \\`${t.expected}\\`\n  Received: \\`${t.received}\\``);\n}\n\nfunction lr() {\n  return new W(ne.DuplicateIframe, \"Duplicate iframes found.\");\n}\n\nfunction Ye() {\n  return new W(ne.SyncWeb3Method, \"Non-async web3 methods are deprecated in web3 > 1.0 and are not supported by the Magic web3 provider. Please use an async method instead.\");\n}\n\nfunction Ze() {\n  return new W(ne.ReactNativeEndpointConfiguration, `CUSTOM DOMAINS ARE NOT SUPPORTED WHEN USING MAGIC SDK WITH REACT NATIVE! The \\`endpoint\\` parameter SHOULD NOT be provided. The Magic \\`<iframe>\\` is automatically wrapped by a WebView pointed at \\`${m.defaultEndpoint}\\`. Changing this default behavior will lead to unexpected results and potentially security-threatening bugs.`);\n}\n\nfunction pr(t) {\n  let {\n    method: e,\n    removalVersions: n,\n    useInstead: r\n  } = t,\n      s = n[m.sdkName],\n      o = r ? ` Use \\`${r}\\` instead.` : \"\",\n      a = `\\`${e}\\` will be removed from \\`${m.sdkName}\\` in version \\`${s}\\`.${o}`;\n  return new W(ne.DeprecationNotice, a);\n}\n\nimport { MagicPayloadMethod as J } from \"@magic-sdk/types\";\nimport { MagicOutgoingWindowMessage as Mn, MagicIncomingWindowMessage as Nn } from \"@magic-sdk/types\";\n\nfunction* xn() {\n  let t = 0;\n\n  for (;;) t < Number.MAX_SAFE_INTEGER ? yield ++t : t = 0;\n}\n\nvar In = xn();\n\nfunction Ee() {\n  return In.next().value;\n}\n\nvar Qe = Symbol(\"Payload pre-processed by Magic SDK\");\n\nfunction et(t) {\n  return Object.defineProperty(t, Qe, {\n    value: !0,\n    enumerable: !1\n  }), t;\n}\n\nfunction Pn(t) {\n  return !!t[Qe];\n}\n\nfunction C(t) {\n  var e, n, r;\n  return Pn(t) || (t.jsonrpc = (e = t.jsonrpc) != null ? e : \"2.0\", t.id = Ee(), t.method = (n = t.method) != null ? n : \"noop\", t.params = (r = t.params) != null ? r : [], et(t)), t;\n}\n\nfunction f(t) {\n  let e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n  return et({\n    params: e,\n    method: t,\n    jsonrpc: \"2.0\",\n    id: Ee()\n  });\n}\n\nvar O = class {\n  constructor(e) {\n    e instanceof O ? (this._jsonrpc = e.payload.jsonrpc, this._id = e.payload.id, this._result = e.payload.result, this._error = e.payload.error) : je(e) ? (this._jsonrpc = e.jsonrpc, this._id = e.id, this._result = e.result, this._error = e.error) : (this._jsonrpc = e.jsonrpc, this._id = e.id, this._result = void 0, this._error = void 0);\n  }\n\n  applyError(e) {\n    return this._error = e, this;\n  }\n\n  applyResult(e) {\n    return this._result = e, this;\n  }\n\n  get hasError() {\n    return typeof this._error != \"undefined\" && this._error !== null;\n  }\n\n  get hasResult() {\n    return typeof this._result != \"undefined\";\n  }\n\n  get payload() {\n    return {\n      jsonrpc: this._jsonrpc,\n      id: this._id,\n      result: this._result,\n      error: this._error\n    };\n  }\n\n};\nvar rt = At(nt()),\n    st = class extends rt.default {};\n\nfunction oe() {\n  let t = new st();\n  return {\n    emitter: t,\n    createChainingEmitterMethod: (r, s) => function () {\n      for (var _len2 = arguments.length, o = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n        o[_key2] = arguments[_key2];\n      }\n\n      return t[r].apply(t, o), s;\n    },\n    createBoundEmitterMethod: r => function () {\n      for (var _len3 = arguments.length, s = new Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {\n        s[_key3] = arguments[_key3];\n      }\n\n      return t[r].apply(t, s);\n    }\n  };\n}\n\nvar ot = Symbol(\"isPromiEvent\");\n\nfunction it(t) {\n  return !!t[ot];\n}\n\nfunction ie(t) {\n  let e = fe(t),\n      {\n    createBoundEmitterMethod: n,\n    createChainingEmitterMethod: r\n  } = oe(),\n      s = Symbol(\"Promise.then\"),\n      o = Symbol(\"Promise.catch\"),\n      a = Symbol(\"Promise.finally\"),\n      i = (l, u) => function () {\n    for (var _len4 = arguments.length, v = new Array(_len4), _key4 = 0; _key4 < _len4; _key4++) {\n      v[_key4] = arguments[_key4];\n    }\n\n    let M = u[l].apply(u, v);\n    return c(M);\n  },\n      c = l => Object.assign(l, {\n    [ot]: !0,\n    [s]: l[s] || l.then,\n    [o]: l[o] || l.catch,\n    [a]: l[a] || l.finally,\n    then: i(s, l),\n    catch: i(o, l),\n    finally: i(a, l),\n    on: r(\"on\", l),\n    once: r(\"once\", l),\n    addListener: r(\"addListener\", l),\n    off: r(\"off\", l),\n    removeListener: r(\"removeListener\", l),\n    removeAllListeners: r(\"removeAllListeners\", l),\n    emit: n(\"emit\"),\n    eventNames: n(\"eventNames\"),\n    listeners: n(\"listeners\"),\n    listenerCount: n(\"listenerCount\")\n  }),\n      p = c(e.then(l => (p.emit(\"done\", l), p.emit(\"settled\"), l), l => {\n    throw p.emit(\"error\", l), p.emit(\"settled\"), l;\n  }));\n\n  return p;\n}\n\nfunction fe(t) {\n  return new Promise((e, n) => {\n    let r = t(e, n);\n    Promise.resolve(r).catch(n);\n  });\n}\n\nvar P = class {\n  constructor(e) {\n    this.sdk = e;\n  }\n\n  get overlay() {\n    return this.sdk.overlay;\n  }\n\n  request(e) {\n    let n = this.overlay.post(Mn.MAGIC_HANDLE_REQUEST, C(e)),\n        r = ie((o, a) => {\n      n.then(i => {\n        if (s(), i.hasError) a(new A(i.payload.error));else if (i.hasResult) o(i.payload.result);else throw Be();\n      }).catch(i => {\n        s(), a(i);\n      });\n    }),\n        s = this.overlay.on(Nn.MAGIC_HANDLE_EVENT, o => {\n      var i;\n      let {\n        response: a\n      } = o.data;\n\n      if (a.id === e.id && ((i = a.result) == null ? void 0 : i.event)) {\n        let {\n          event: c,\n          params: p = []\n        } = a.result;\n        r.emit(c, ...p);\n      }\n    });\n    return r;\n  }\n\n};\nvar ye = class extends P {\n  loginWithMagicLink(e) {\n    let {\n      email: n,\n      showUI: r = !0,\n      redirectURI: s\n    } = e,\n        o = f(this.sdk.testMode ? J.LoginWithMagicLinkTestMode : J.LoginWithMagicLink, [{\n      email: n,\n      showUI: r,\n      redirectURI: s\n    }]);\n    return this.request(o);\n  }\n\n  loginWithSMS(e) {\n    let {\n      phoneNumber: n\n    } = e,\n        r = f(this.sdk.testMode ? J.LoginWithSmsTestMode : J.LoginWithSms, [{\n      phoneNumber: n,\n      showUI: !0\n    }]);\n    return this.request(r);\n  }\n\n  loginWithCredential(e) {\n    let n = e != null ? e : \"\";\n\n    if (!e && m.platform === \"web\") {\n      n = window.location.search;\n      let s = window.location.origin + window.location.pathname;\n      window.history.replaceState(null, \"\", s);\n    }\n\n    let r = f(this.sdk.testMode ? J.LoginWithCredentialTestMode : J.LoginWithCredential, [n]);\n    return this.request(r);\n  }\n\n};\nimport { MagicPayloadMethod as x } from \"@magic-sdk/types\";\nvar H = {};\nMt(H, {\n  clear: () => An,\n  getItem: () => _,\n  iterate: () => Cn,\n  key: () => Sn,\n  keys: () => Ln,\n  length: () => wn,\n  removeItem: () => ce,\n  setItem: () => q\n});\nvar ae;\n\nfunction w(t) {\n  var _this = this;\n\n  return function () {\n    for (var _len5 = arguments.length, e = new Array(_len5), _key5 = 0; _key5 < _len5; _key5++) {\n      e[_key5] = arguments[_key5];\n    }\n\n    return I(_this, null, function* () {\n      return ae || (ae = yield m.configureStorage()), yield ae.ready(), ae[t](...e);\n    });\n  };\n}\n\nvar _ = w(\"getItem\"),\n    q = w(\"setItem\"),\n    ce = w(\"removeItem\"),\n    An = w(\"clear\"),\n    wn = w(\"length\"),\n    Sn = w(\"key\"),\n    Ln = w(\"keys\"),\n    Cn = w(\"iterate\");\n\nfunction at() {\n  let t = window.crypto.getRandomValues(new Uint8Array(16));\n  t[6] = t[6] & 15 | 64, t[8] = t[8] & 191 | 128;\n  let e = \"\";\n  return e += t[0].toString(16), e += t[1].toString(16), e += t[2].toString(16), e += t[3].toString(16), e += \"-\", e += t[4].toString(16), e += t[5].toString(16), e += \"-\", e += t[6].toString(16), e += t[7].toString(16), e += \"-\", e += t[8].toString(16), e += t[9].toString(16), e += \"-\", e += t[10].toString(16), e += t[11].toString(16), e += t[12].toString(16), e += t[13].toString(16), e += t[14].toString(16), e += t[15].toString(16), e;\n}\n\nvar ge = \"STORE_KEY_PRIVATE_KEY\",\n    le = \"STORE_KEY_PUBLIC_JWK\",\n    Re = \"ECDSA\",\n    ct = \"P-256\",\n    On = {\n  name: Re,\n  namedCurve: ct\n},\n    _n = {\n  name: Re,\n  namedCurve: ct\n};\n\nfunction lt() {\n  ce(le), ce(ge);\n}\n\nfunction pt() {\n  return I(this, null, function* () {\n    let t = yield Dn();\n\n    if (!t) {\n      console.info(\"unable to create public key or webcrypto is unsupported\");\n      return;\n    }\n\n    let {\n      subtle: e\n    } = window.crypto,\n        n = yield _(ge);\n\n    if (!n || !e) {\n      console.info(\"unable to find private key or webcrypto unsupported\");\n      return;\n    }\n\n    let r = {\n      iat: Math.floor(new Date().getTime() / 1e3),\n      jti: at()\n    },\n        s = {\n      typ: \"dpop+jwt\",\n      alg: \"ES256\",\n      jwk: t\n    },\n        o = {\n      protected: ut(JSON.stringify(s)),\n      claims: ut(JSON.stringify(r))\n    },\n        a = qn(`${o.protected}.${o.claims}`),\n        i = {\n      name: Re,\n      hash: {\n        name: \"SHA-256\"\n      }\n    },\n        c = Un(new Uint8Array(yield e.sign(i, n, a)));\n    return `${o.protected}.${o.claims}.${c}`;\n  });\n}\n\nfunction Dn() {\n  return I(this, null, function* () {\n    if (!Jn()) {\n      console.info(\"webcrypto is not supported\");\n      return;\n    }\n\n    return (yield _(le)) || (yield kn()), _(le);\n  });\n}\n\nfunction kn() {\n  return I(this, null, function* () {\n    let t = null,\n        {\n      subtle: e\n    } = window.crypto,\n        n = yield e.generateKey(On, !0, [\"sign\"]),\n        r = yield e.exportKey(\"jwk\", n.privateKey);\n    t = yield e.exportKey(\"jwk\", n.publicKey);\n    let s = yield e.importKey(\"jwk\", r, _n, !1, [\"sign\"]);\n    yield q(ge, s), yield q(le, t);\n  });\n}\n\nfunction Jn() {\n  let t = typeof window != \"undefined\" && !!window.crypto,\n      e = t && !!window.crypto.subtle;\n  return t && e;\n}\n\nfunction ut(t) {\n  return dt(Gn(t));\n}\n\nfunction qn(t) {\n  return new TextEncoder().encode(t);\n}\n\nfunction dt(t) {\n  return btoa(t).replace(/\\+/g, \"-\").replace(/\\//g, \"_\").replace(/=+/g, \"\");\n}\n\nfunction Gn(t) {\n  return encodeURIComponent(t).replace(/%([0-9A-F]{2})/g, (n, r) => String.fromCharCode(parseInt(r, 16)));\n}\n\nfunction Un(t) {\n  let e = \"\";\n  return t.forEach(n => {\n    e += String.fromCharCode(n);\n  }), dt(e);\n}\n\nvar Te = class extends P {\n  getIdToken(e) {\n    let n = f(this.sdk.testMode ? x.GetIdTokenTestMode : x.GetIdToken, [e]);\n    return this.request(n);\n  }\n\n  generateIdToken(e) {\n    let n = f(this.sdk.testMode ? x.GenerateIdTokenTestMode : x.GenerateIdToken, [e]);\n    return this.request(n);\n  }\n\n  getMetadata() {\n    let e = f(this.sdk.testMode ? x.GetMetadataTestMode : x.GetMetadata);\n    return this.request(e);\n  }\n\n  updateEmail(e) {\n    let {\n      email: n,\n      showUI: r = !0\n    } = e,\n        s = f(this.sdk.testMode ? x.UpdateEmailTestMode : x.UpdateEmail, [{\n      email: n,\n      showUI: r\n    }]);\n    return this.request(s);\n  }\n\n  isLoggedIn() {\n    let e = f(this.sdk.testMode ? x.IsLoggedInTestMode : x.IsLoggedIn);\n    return this.request(e);\n  }\n\n  logout() {\n    lt();\n    let e = f(this.sdk.testMode ? x.LogoutTestMode : x.Logout);\n    return this.request(e);\n  }\n\n  showSettings() {\n    let e = f(this.sdk.testMode ? x.UserSettingsTestMode : x.UserSettings);\n    return this.request(e);\n  }\n\n};\nimport { MagicOutgoingWindowMessage as mt } from \"@magic-sdk/types\";\nvar {\n  createBoundEmitterMethod: pe,\n  createChainingEmitterMethod: G\n} = oe(),\n    ve = class extends P {\n  constructor() {\n    super(...arguments);\n    this.isMagic = !0;\n    this.on = G(\"on\", this);\n    this.once = G(\"once\", this);\n    this.addListener = G(\"addListener\", this);\n    this.off = G(\"off\", this);\n    this.removeListener = G(\"removeListener\", this);\n    this.removeAllListeners = G(\"removeAllListeners\", this);\n    this.emit = pe(\"emit\");\n    this.eventNames = pe(\"eventNames\");\n    this.listeners = pe(\"listeners\");\n    this.listenerCount = pe(\"listenerCount\");\n  }\n\n  sendAsync(e, n) {\n    if (!n) throw ze({\n      procedure: \"Magic.rpcProvider.sendAsync\",\n      argument: 1,\n      expected: \"function\",\n      received: n === null ? \"null\" : typeof n\n    });\n    if (Array.isArray(e)) this.overlay.post(mt.MAGIC_HANDLE_REQUEST, e.map(r => {\n      let s = C(r);\n      return this.prefixPayloadMethodForTestMode(s), s;\n    })).then(r => {\n      n(null, r.map(s => Ae(Ne({}, s.payload), {\n        error: s.hasError ? new A(s.payload.error) : null\n      })));\n    });else {\n      let r = C(e);\n      this.prefixPayloadMethodForTestMode(r), this.overlay.post(mt.MAGIC_HANDLE_REQUEST, r).then(s => {\n        n(s.hasError ? new A(s.payload.error) : null, s.payload);\n      });\n    }\n  }\n\n  send(e, n) {\n    if (typeof e == \"string\") {\n      let s = f(e, Array.isArray(n) ? n : []);\n      return this.request(s);\n    }\n\n    if (Array.isArray(e) || !!n) {\n      this.sendAsync(e, n);\n      return;\n    }\n\n    let r = Ye();\n    return r.log(), new O(e).applyError({\n      code: -32603,\n      message: r.rawMessage\n    }).payload;\n  }\n\n  enable() {\n    let e = f(\"eth_accounts\");\n    return this.request(e);\n  }\n\n  request(e) {\n    return this.prefixPayloadMethodForTestMode(e), super.request(e);\n  }\n\n  prefixPayloadMethodForTestMode(e) {\n    let n = \"testMode/eth/\";\n    this.sdk.testMode && (e.method = `${n}${e.method}`);\n  }\n\n};\n\nfunction xe(t, e) {\n  return e ? new URL(t, e) : new URL(t);\n}\n\nvar Et = [\"request\", \"overlay\", \"sdk\"];\n\nfunction Kn(t) {\n  let e = Object.getPrototypeOf(t),\n      n = [e];\n\n  for (; e !== P.prototype;) e = Object.getPrototypeOf(e), n.push(e);\n\n  return n;\n}\n\nvar Ie = class extends P {\n  constructor() {\n    super(void 0);\n    this.__sdk_access_field_descriptors__ = new Map();\n    this.__is_initialized__ = !1;\n    this.utils = {\n      createPromiEvent: ie,\n      isPromiEvent: it,\n      encodeJSON: Q,\n      decodeJSON: Ke,\n      createJsonRpcRequestPayload: f,\n      standardizeJsonRpcRequestPayload: C,\n      storage: H\n    };\n    let e = [this, ...Kn(this)];\n    Et.forEach(n => {\n      let r = e.map(i => Object.getOwnPropertyDescriptor(i, n)),\n          s = r.findIndex(i => !!i),\n          o = s > 0,\n          a = r[s];\n      a && (this.__sdk_access_field_descriptors__.set(n, {\n        descriptor: a,\n        isPrototypeField: o\n      }), Object.defineProperty(this, n, {\n        configurable: !0,\n        get: () => {\n          throw He(n);\n        }\n      }));\n    });\n  }\n\n  init(e) {\n    this.__is_initialized__ || (Et.forEach(n => {\n      if (this.__sdk_access_field_descriptors__.has(n)) {\n        let {\n          descriptor: r,\n          isPrototypeField: s\n        } = this.__sdk_access_field_descriptors__.get(n);\n\n        s ? delete this[n] : Object.defineProperty(this, n, r);\n      }\n    }), this.sdk = e, this.__is_initialized__ = !0);\n  }\n\n  createDeprecationWarning(e) {\n    let {\n      method: n,\n      removalVersion: r,\n      useInstead: s\n    } = e,\n        o = s ? ` Use \\`${s}\\` instead.` : \"\",\n        a = `\\`${n}\\` will be removed from this Extension in version \\`${r}\\`.${o}`;\n    return new re(this, \"DEPRECATION_NOTICE\", a);\n  }\n\n  createWarning(e, n) {\n    return new re(this, e, n);\n  }\n\n  createError(e, n, r) {\n    return new X(this, e, n, r);\n  }\n\n},\n    ht = class extends Ie {},\n    S = class extends Ie {};\nS.Internal = ht, S.Anonymous = \"anonymous extension\";\n\nfunction ft(t) {\n  return t.compat && t.compat[m.sdkName] != null ? typeof t.compat[m.sdkName] == \"string\" ? Je(Ue(m.version), t.compat[m.sdkName]) : !!t.compat[m.sdkName] : !0;\n}\n\nfunction jn(t) {\n  var s;\n  let e = (s = t == null ? void 0 : t.extensions) != null ? s : [],\n      n = {},\n      r = [];\n  if (Array.isArray(e) ? e.forEach(o => {\n    ft(o) ? (o.init(this), (o.name || o.name !== S.Anonymous) && (this[o.name] = o), o instanceof S.Internal && (te(o.config) || (n[o.name] = o.config))) : r.push(o);\n  }) : Object.keys(e).forEach(o => {\n    if (ft(e[o])) {\n      e[o].init(this);\n      let a = e[o];\n      this[o] = a, a instanceof S.Internal && (te(a.config) || (n[e[o].name] = a.config));\n    } else r.push(e[o]);\n  }), r.length) throw Ve(r);\n  return n;\n}\n\nvar V = class {\n  constructor(e, n) {\n    this.apiKey = e;\n    var a;\n    if (!e) throw Xe();\n    m.platform === \"react-native\" && (n == null ? void 0 : n.endpoint) && Ze().log();\n    let {\n      defaultEndpoint: r,\n      version: s\n    } = m;\n    this.testMode = !!(n == null ? void 0 : n.testMode), this.endpoint = xe((a = n == null ? void 0 : n.endpoint) != null ? a : r).origin, this.auth = new ye(this), this.user = new Te(this), this.rpcProvider = new ve(this);\n    let o = jn.call(this, n);\n    this.parameters = Q({\n      API_KEY: this.apiKey,\n      DOMAIN_ORIGIN: window.location ? window.location.origin : \"\",\n      ETH_NETWORK: n == null ? void 0 : n.network,\n      host: xe(this.endpoint).host,\n      sdk: We[m.sdkName],\n      version: s,\n      ext: te(o) ? void 0 : o,\n      locale: (n == null ? void 0 : n.locale) || \"en_US\"\n    });\n  }\n\n  get overlay() {\n    if (!V.__overlays__.has(this.parameters)) {\n      let e = new m.ViewController(this.endpoint, this.parameters);\n      e.init(), V.__overlays__.set(this.parameters, e);\n    }\n\n    return V.__overlays__.get(this.parameters);\n  }\n\n  preload() {\n    return I(this, null, function* () {\n      yield this.overlay.ready;\n    });\n  }\n\n},\n    Pe = V;\nPe.__overlays__ = new Map();\nimport { MagicIncomingWindowMessage as ue } from \"@magic-sdk/types\";\n\nfunction Fn(t, e) {\n  return e && Array.isArray(t) ? t.find(n => n.id === e) : t;\n}\n\nfunction Wn(t, e) {\n  var s;\n  let n = (s = e.data.response) == null ? void 0 : s.id,\n      r = Fn(t, n);\n\n  if (n && r) {\n    let o = new O(r).applyResult(e.data.response.result).applyError(e.data.response.error);\n    return {\n      id: n,\n      response: o\n    };\n  }\n\n  return {};\n}\n\nfunction Xn(t, e) {\n  return I(this, null, function* () {\n    let n = yield _(\"rt\"),\n        r;\n    if (m.platform === \"web\") try {\n      r = yield pt();\n    } catch (s) {\n      console.error(\"webcrypto error\", s);\n    }\n    return r ? n ? {\n      msgType: t,\n      payload: e,\n      jwt: r,\n      rt: n\n    } : {\n      msgType: t,\n      payload: e,\n      jwt: r\n    } : {\n      msgType: t,\n      payload: e\n    };\n  });\n}\n\nfunction Bn(t) {\n  return I(this, null, function* () {\n    !t.data.rt || (yield q(\"rt\", t.data.rt));\n  });\n}\n\nvar yt = class {\n  constructor(e, n) {\n    this.endpoint = e;\n    this.parameters = n;\n    this.messageHandlers = new Set();\n    this.ready = this.waitForReady(), this.listen();\n  }\n\n  post(e, n) {\n    return I(this, null, function* () {\n      return fe(r => I(this, null, function* () {\n        yield this.ready;\n        let s = [],\n            o = Array.isArray(n) ? n.map(p => p.id) : [],\n            a = yield Xn(`${e}-${this.parameters}`, n);\n        yield this._post(a);\n\n        let i = p => l => {\n          let {\n            id: u,\n            response: v\n          } = Wn(n, l);\n          Bn(l), u && v && Array.isArray(n) && o.includes(u) ? (s.push(v), s.length === n.length && (p(), r(s))) : u && v && !Array.isArray(n) && u === n.id && (p(), r(v));\n        },\n            c = this.on(ue.MAGIC_HANDLE_RESPONSE, i(() => c()));\n      }));\n    });\n  }\n\n  on(e, n) {\n    let r = n.bind(window),\n        s = o => {\n      o.data.msgType === `${e}-${this.parameters}` && r(o);\n    };\n\n    return this.messageHandlers.add(s), () => this.messageHandlers.delete(s);\n  }\n\n  waitForReady() {\n    return new Promise(e => {\n      this.on(ue.MAGIC_OVERLAY_READY, () => e());\n    });\n  }\n\n  listen() {\n    this.on(ue.MAGIC_HIDE_OVERLAY, () => {\n      this.hideOverlay();\n    }), this.on(ue.MAGIC_SHOW_OVERLAY, () => {\n      this.showOverlay();\n    });\n  }\n\n};\nexport { S as Extension, X as MagicExtensionError, re as MagicExtensionWarning, A as MagicRPCError, b as MagicSDKError, W as MagicSDKWarning, Pe as SDKBase, ge as STORE_KEY_PRIVATE_KEY, le as STORE_KEY_PUBLIC_JWK, st as TypedEmitter, yt as ViewController, lt as clearKeys, pr as createDeprecationWarning, lr as createDuplicateIframeWarning, He as createExtensionNotInitializedError, Ve as createIncompatibleExtensionsError, ze as createInvalidArgumentError, pt as createJwt, Be as createMalformedResponseError, Xe as createMissingApiKeyError, cr as createModalNotReadyError, ie as createPromiEvent, fe as createPromise, Ze as createReactNativeEndpointConfigurationWarning, Tn as createSDK, Ye as createSynchronousWeb3MethodWarning, oe as createTypedEmitter, xe as createURL, Ke as decodeJSON, Q as encodeJSON, Ee as getPayloadId, te as isEmpty, Fe as isJsonRpcErrorCode, er as isJsonRpcRequestPayload, je as isJsonRpcResponsePayload, tr as isMagicPayloadMethod, it as isPromiEvent, H as storage, at as uuid };","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;;AAEA,MAAIA,KAAMC,OAAOC,SAAP,CAAiBC,cAA3B;AAAA,MACIC,IAAS,GADb;;AAUA,eAAkB,CASd;;AAAAH,SAAOI,MAAP,KACFC,EAAOJ,SAAP,GAAmBD,OAAOI,MAAP,CAAc,IAAd,CAAnB,EAMK,IAAIC,CAAJ,GAAaC,SAAb,KAAwBH,IAAS,EAAjC,CAPH;;AAmBJ,cAAYI,CAAZ,EAAgBC,CAAhB,EAAyBC,CAAzB,EAA+B;AAC7B,SAAKC,EAAL,GAAUH,CAAV,EACA,KAAKI,OAAL,GAAeH,CADf,EAEA,KAAKI,IAAL,GAAYH,KAAQ,EAFpB;AAgBF;;AAAA,cAAqBF,CAArB,EAA8BC,CAA9B,EAAqCC,CAArC,EAAyCI,CAAzC,EAAkDC,CAAlD,EAAwD;AACtD,QAAI,OAAOL,CAAP,IAAc,UAAlB,EACE,MAAM,IAAIM,SAAJ,CAAc,iCAAd,CAAN;AAGF,QAAIC,IAAW,IAAIC,EAAJ,CAAOR,CAAP,EAAWI,KAAWN,CAAtB,EAA+BO,CAA/B,CAAf;AAAA,QACII,IAAMf,IAASA,IAASK,CAAlB,GAA0BA,CADpC;AAGA,WAAKD,EAAQY,OAAR,CAAgBD,CAAhB,IACKX,EAAQY,OAAb,CAAqBD,CAAhB,EAAqBR,EAA1B,GACAH,EAAQY,OAAR,CAAgBD,CAAhB,IAAuB,CAACX,EAAQY,OAAR,CAAgBD,CAAhB,CAAD,EAAuBF,CAAvB,CADlB,GAAyBT,EAAQY,OAAR,CAAgBD,CAAhB,EAAqBE,IAArB,CAA0BJ,CAA1B,CAD9B,IAAsBT,EAAQY,OAAR,CAAgBD,CAAhB,IAAuBF,CAAvB,EAAiCT,EAAQc,YAAR,EAAvD,GAIEd,CAJP;AAcF;;AAAA,cAAoBA,CAApB,EAA6BC,CAA7B,EAAkC;AAC5B,MAAED,EAAQc,YAAd,KAA+B,CAA3B,GAA8Bd,EAAQY,OAAR,GAAkB,IAAId,CAAJ,EAAhD,GACC,OAAOE,EAAQY,OAAR,CAAgBX,CAAhB,CADZ;AAWF;;AAAA,eAAwB;AACtB,SAAKW,OAAL,GAAe,IAAId,CAAJ,EAAf,EACA,KAAKgB,YAAL,GAAoB,CADpB;AAWF;;AAAAC,IAAarB,SAAb,CAAuBsB,UAAvB,GAAoC,YAAsB;AACxD,QAAIf,IAAQ,EAAZ;AAAA,QACIC,CADJ;AAAA,QAEII,CAFJ;AAIA,QAAI,KAAKQ,YAAL,KAAsB,CAA1B,EAA6B,OAAOb,CAAP;;AAE7B,SAAKK,CAAL,IAAcJ,IAAS,KAAKU,OAA5B,EACMpB,GAAIyB,IAAR,CAAaf,CAAT,EAAiBI,CAArB,KAA4BL,EAAMY,IAAN,CAAWjB,IAASU,EAAKY,KAAL,CAAW,CAAX,CAAT,GAAyBZ,CAApC,CAAxB;;AAGN,WAAIb,OAAO0B,qBAAP,GACKlB,EAAMmB,MAAN,CAAa3B,OAAO0B,qBAAP,CAA6BjB,CAA7B,CAAb,CADL,GAIGD,CAJP;AAIO,GAfT;;AAyBAc,IAAarB,SAAb,CAAuB2B,SAAvB,GAAmC,UAAmBpB,CAAnB,EAA0B;AAC3D,QAAIC,IAAMN,IAASA,IAASK,CAAlB,GAA0BA,CAApC;AAAA,QACIK,IAAW,KAAKM,OAAL,CAAaV,CAAb,CADf;AAGA,QAAI,CAACI,CAAL,EAAe,OAAO,EAAP;AACf,QAAIA,EAASH,EAAb,EAAiB,OAAO,CAACG,EAASH,EAAV,CAAP;;AAEjB,aAASI,IAAI,CAAb,EAAgBE,IAAIH,EAASgB,MAA7B,EAAqCX,IAAK,IAAIY,KAAJ,CAAUd,CAAV,CAA1C,EAAwDF,IAAIE,CAA5D,EAA+DF,GAA/D,EACEI,EAAGJ,CAAH,IAAQD,EAASC,CAAT,EAAYJ,EAApB;;AAGF,WAAOQ,CAAP;AAAO,GAXT;;AAqBAI,IAAarB,SAAb,CAAuB8B,aAAvB,GAAuC,UAAuBvB,CAAvB,EAA8B;AACnE,QAAIC,IAAMN,IAASA,IAASK,CAAlB,GAA0BA,CAApC;AAAA,QACIK,IAAY,KAAKM,OAAL,CAAaV,CAAb,CADhB;AAGA,WAAKI,IACDA,EAAUH,EAAV,GAAqB,CAArB,GACGG,EAAUgB,MAFZ,GAAkB,CAAvB;AAAuB,GAJzB;;AAgBAP,IAAarB,SAAb,CAAuB+B,IAAvB,GAA8B,UAAcxB,CAAd,EAAqBC,CAArB,EAAyBI,CAAzB,EAA6BC,CAA7B,EAAiCE,CAAjC,EAAqCE,CAArC,EAAyC;AACrE,QAAIe,IAAM9B,IAASA,IAASK,CAAlB,GAA0BA,CAApC;AAEA,QAAI,CAAC,KAAKW,OAAL,CAAac,CAAb,CAAL,EAAwB,OAAO,EAAP;AAExB,QAAIC,IAAY,KAAKf,OAAL,CAAac,CAAb,CAAhB;AAAA,QACIE,IAAMC,UAAUP,MADpB;AAAA,QAEIQ,CAFJ;AAAA,QAGIC,CAHJ;;AAKA,QAAIJ,EAAUxB,EAAd,EAAkB;AAGhB,cAFIwB,EAAUtB,IAAV,IAAgB,KAAK2B,cAAL,CAAoB/B,CAApB,EAA2B0B,EAAUxB,EAArC,EAAyC,MAAzC,EAAoD,EAApD,CAAhB,EAEIyB,CAAR;AAAQ,aACD,CADC;AACE,iBAAOD,EAAUxB,EAAV,CAAac,IAAb,CAAkBU,EAAUvB,OAA5B,GAAsC,EAA7C;;AAA6C,aAChD,CADgD;AAC7C,iBAAOuB,EAAUxB,EAAV,CAAac,IAAb,CAAkBU,EAAUvB,OAA5B,EAAqCF,CAArC,GAA0C,EAAjD;;AAAiD,aACpD,CADoD;AACjD,iBAAOyB,EAAUxB,EAAV,CAAac,IAAb,CAAkBU,EAAUvB,OAA5B,EAAqCF,CAArC,EAAyCI,CAAzC,GAA8C,EAArD;;AAAqD,aACxD,CADwD;AACrD,iBAAOqB,EAAUxB,EAAV,CAAac,IAAb,CAAkBU,EAAUvB,OAA5B,EAAqCF,CAArC,EAAyCI,CAAzC,EAA6CC,CAA7C,GAAkD,EAAzD;;AAAyD,aAC5D,CAD4D;AACzD,iBAAOoB,EAAUxB,EAAV,CAAac,IAAb,CAAkBU,EAAUvB,OAA5B,EAAqCF,CAArC,EAAyCI,CAAzC,EAA6CC,CAA7C,EAAiDE,CAAjD,GAAsD,EAA7D;;AAA6D,aAChE,CADgE;AAC7D,iBAAOkB,EAAUxB,EAAV,CAAac,IAAb,CAAkBU,EAAUvB,OAA5B,EAAqCF,CAArC,EAAyCI,CAAzC,EAA6CC,CAA7C,EAAiDE,CAAjD,EAAqDE,CAArD,GAA0D,EAAjE;AANV;;AASA,WAAKoB,IAAI,CAAJ,EAAOD,IAAO,IAAIP,KAAJ,CAAUK,IAAK,CAAf,CAAnB,EAAsCG,IAAIH,CAA1C,EAA+CG,GAA/C,EACED,EAAKC,IAAI,CAAT,IAAcF,UAAUE,CAAV,CAAd;;AAGFJ,QAAUxB,EAAV,CAAa8B,KAAb,CAAmBN,EAAUvB,OAA7B,EAAsC0B,CAAtC;AAAsC,KAhBxC,MAiBO;AACL,UAAII,IAASP,EAAUL,MAAvB;AAAA,UACIa,CADJ;;AAGA,WAAKJ,IAAI,CAAT,EAAYA,IAAIG,CAAhB,EAAwBH,GAAxB,EAGE,QAFIJ,EAAUI,CAAV,EAAa1B,IAAb,IAAmB,KAAK2B,cAAL,CAAoB/B,CAApB,EAA2B0B,EAAUI,CAAV,EAAa5B,EAAxC,EAA4C,MAA5C,EAAuD,EAAvD,CAAnB,EAEIyB,CAAR;AAAQ,aACD,CADC;AACED,YAAUI,CAAV,EAAa5B,EAAb,CAAgBc,IAAhB,CAAqBU,EAAUI,CAAV,EAAa3B,OAAlC;AAA4C;;AAAA,aAC/C,CAD+C;AAC5CuB,YAAUI,CAAV,EAAa5B,EAAb,CAAgBc,IAAhB,CAAqBU,EAAUI,CAAV,EAAa3B,OAAlC,EAA2CF,CAA3C;AAAgD;;AAAA,aACnD,CADmD;AAChDyB,YAAUI,CAAV,EAAa5B,EAAb,CAAgBc,IAAhB,CAAqBU,EAAUI,CAAV,EAAa3B,OAAlC,EAA2CF,CAA3C,EAA+CI,CAA/C;AAAoD;;AAAA,aACvD,CADuD;AACpDqB,YAAUI,CAAV,EAAa5B,EAAb,CAAgBc,IAAhB,CAAqBU,EAAUI,CAAV,EAAa3B,OAAlC,EAA2CF,CAA3C,EAA+CI,CAA/C,EAAmDC,CAAnD;AAAwD;;AAAA;AAE9D,cAAI,CAACuB,CAAL,EAAW,KAAKK,IAAI,CAAJ,EAAOL,IAAO,IAAIP,KAAJ,CAAUK,IAAK,CAAf,CAAnB,EAAsCO,IAAIP,CAA1C,EAA+CO,GAA/C,EACTL,EAAKK,IAAI,CAAT,IAAcN,UAAUM,CAAV,CAAd;AAGFR,YAAUI,CAAV,EAAa5B,EAAb,CAAgB8B,KAAhB,CAAsBN,EAAUI,CAAV,EAAa3B,OAAnC,EAA4C0B,CAA5C;AAVJ;AAeJ;;AAAA,WAAO,EAAP;AAAO,GAjDT;;AA6DAf,IAAarB,SAAb,CAAuB0C,EAAvB,GAA4B,UAAYnC,CAAZ,EAAmBC,CAAnB,EAAuBI,CAAvB,EAAgC;AAC1D,WAAO+B,GAAY,IAAZ,EAAkBpC,CAAlB,EAAyBC,CAAzB,EAA6BI,CAA7B,EAAsC,EAAtC,CAAP;AAA6C,GAD/C;;AAaAS,IAAarB,SAAb,CAAuBW,IAAvB,GAA8B,UAAcJ,CAAd,EAAqBC,CAArB,EAAyBI,CAAzB,EAAkC;AAC9D,WAAO+B,GAAY,IAAZ,EAAkBpC,CAAlB,EAAyBC,CAAzB,EAA6BI,CAA7B,EAAsC,EAAtC,CAAP;AAA6C,GAD/C;;AAcAS,IAAarB,SAAb,CAAuBsC,cAAvB,GAAwC,UAAwB/B,CAAxB,EAA+BC,CAA/B,EAAmCI,CAAnC,EAA4CC,CAA5C,EAAkD;AACxF,QAAIE,IAAMb,IAASA,IAASK,CAAlB,GAA0BA,CAApC;AAEA,QAAI,CAAC,KAAKW,OAAL,CAAaH,CAAb,CAAL,EAAwB,OAAO,IAAP;AACxB,QAAI,CAACP,CAAL,EACE,UAAW,IAAX,EAAiBO,CAAjB,GACO,IADP;AAIF,QAAIE,IAAY,KAAKC,OAAL,CAAaH,CAAb,CAAhB;AAEA,QAAIE,EAAUR,EAAd,EACEQ,CACE,CAAUR,EADZ,KACmBD,CAAjB,KACC,CAACK,CAAD,IAASI,EAAUN,IADpB,MAEC,CAACC,CAAD,IAAYK,EAAUP,OAAV,KAAsBE,CAFnC,KAIAgC,GAAW,IAAX,EAAiB7B,CAAjB,CALF,CADF,KAQO;AACL,eAASiB,IAAI,CAAb,EAAgBC,IAAS,EAAzB,EAA6BC,IAASjB,EAAUW,MAAhD,EAAwDI,IAAIE,CAA5D,EAAoEF,GAApE,EAEI,GAAUA,CAAV,EAAavB,EAAb,KAAoBD,CAApB,IACCK,KAAQ,CAACI,EAAUe,CAAV,EAAarB,IADvB,IAECC,KAAWK,EAAUe,CAAV,EAAatB,OAAb,KAAyBE,CAFrC,KAIAqB,EAAOd,IAAP,CAAYF,EAAUe,CAAV,CAAZ,CAJA;;AAWJC,OAAI,CAAOL,MAAX,GAAmB,KAAKV,OAAL,CAAaH,CAAb,IAAoBkB,EAAOL,MAAP,KAAkB,CAAlB,GAAsBK,EAAO,CAAP,CAAtB,GAAkCA,CAAzE,GACKW,GAAW,IAAX,EAAiB7B,CAAjB,CADL;AAIF;AAAA,WAAO,IAAP;AAAO,GArCT;;AA+CAM,IAAarB,SAAb,CAAuB6C,kBAAvB,GAA4C,UAA4BtC,CAA5B,EAAmC;AAC7E,QAAIC,CAAJ;AAEA,WAAID,KACFC,IAAMN,IAASA,IAASK,CAAlB,GAA0BA,CAAhC,EACI,KAAKW,OAAL,CAAaV,CAAb,KAAmBoC,GAAW,IAAX,EAAiBpC,CAAjB,CAFrB,KAIF,KAAKU,OAAL,GAAe,IAAId,CAAJ,EAAf,EACA,KAAKgB,YAAL,GAAoB,CALlB,GAQG,IARP;AAQO,GAXT;;AAiBAC,IAAarB,SAAb,CAAuB8C,GAAvB,GAA6BzB,EAAarB,SAAb,CAAuBsC,cAApD;AACAjB,IAAarB,SAAb,CAAuB+C,WAAvB,GAAqC1B,EAAarB,SAAb,CAAuB0C,EAA5D;AAKArB,IAAa2B,QAAb,GAAwB9C,CAAxB;AAKAmB,IAAa4B,YAAb,GAA4B5B,CAA5B;AAKoB,SAAO6B,EAAvB,eAAgB,KAClBA,GAAOC,OAAP,GAAiB9B,CADC;AACD,CA9UnB;;ACcA,YAA8Bf,CAA9B,EAAgC;AAAC,MAAMC,IAAE;AAAC4C,aAAQ;AAAT,GAAR;AAAqB,SAAO7C,EAAEC,CAAF,EAAIA,EAAE4C,OAAN,GAAe5C,EAAE4C,OAAxB;AAAgC;;AAAA,IAAmDC,KAAmBC,OAAOC,gBAAP,IAAyB,gBAA/F;;AAAA,IAA6IC,KAAU;AAACC,uBAAoB,OAArB;AAA6BC,cAAW,GAAxC;AAA4CH,oBAAiBF,EAA7D;AAAgFM,6BAA0B;AAA1G,CAAvJ;AAAA,IAAqQC,KAAgB,OAAOC,OAAjB,YAAU,IAAgBA,QAAQC,GAAlC,IAAuCD,QAAQC,GAAR,CAAYC,UAAnD,IAA+D,cAAcC,IAAd,CAAmBH,QAAQC,GAAR,CAAYC,UAA/B,CAArD,GAAgG;AAAA,oCAAIxD,CAAJ;AAAIA,KAAJ;AAAA;;AAAA,SAAQ0D,QAAQC,KAAR,CAAc,QAAd,EAAuB,GAAG3D,CAA1B,CAAR;AAAA,CAAhG,GAAqI,MAAI,EAA9Z;AAAA,IAAia4D,IAAQP,EAAza;AAAA,IAA+aQ,IAAKC,GAAqB,UAAS9D,CAAT,EAAWC,CAAX,EAAa;AAAC,MAAK;AAACmD,+BAA0BlD;AAA3B,MAA8B+C,EAAnC;AAAA,MAA6C3C,IAAG,KAAEN,EAAE6C,OAAF,GAAU,EAAZ,EAAgBkB,EAAhB,GAAmB,EAAnE;AAAA,MAAsExD,IAAEN,EAAE+D,GAAF,GAAM,EAA9E;AAAA,MAAiFvD,IAAER,EAAED,CAAF,GAAI,EAAvF;AAAA,MAA8FW,IAAE,CAAhG;AAAA,MAAwGe,IAAE,CAACC,CAAD,EAAGC,CAAH,EAAKE,CAAL,KAAS;AAAC,QAAMC,IAAEpB,GAAR;AAAYiD,MAAQ7B,CAAR,EAAUH,CAAV,GAAanB,EAAEkB,CAAF,IAAKI,CAAlB,EAAoBxB,EAAEwB,CAAF,IAAKH,CAAzB,EAA2BtB,EAAEyB,CAAF,IAAK,IAAIkC,MAAJ,CAAWrC,CAAX,EAAaE,IAAE,GAAF,GAAM,MAAnB,CAAhC;AAAmD,GAAnL;;AAA4LJ,IAAE,mBAAF,EAAsB,aAAtB,GAAqCA,EAAE,wBAAF,EAA2B,QAA3B,CAArC,EAA0EA,EAAE,sBAAF,EAAyB,4BAAzB,CAA1E,EAAiIA,EAAE,aAAF,EAAgB,IAAInB,EAAEE,EAAEyD,iBAAJ,CAAI,QAA6B3D,EAAEE,EAAEyD,iBAAJ,CAAI,QAA6B3D,EAAEE,EAAEyD,iBAAJ,CAAI,GAA1F,CAAjI,EAAkPxC,EAAE,kBAAF,EAAqB,IAAInB,EAAEE,EAAE0D,sBAAJ,CAAI,QAAkC5D,EAAEE,EAAE0D,sBAAJ,CAAI,QAAkC5D,EAAEE,EAAE0D,sBAAJ,CAAI,GAAzG,CAAlP,EAAuXzC,EAAE,sBAAF,EAAyB,MAAMnB,EAAEE,EAAEyD,iBAAJ,CAAI,IAAsB3D,EAAEE,EAAE2D,oBAAJ,CAAI,GAA7D,CAAvX,EAA8c1C,EAAE,2BAAF,EAA8B,MAAMnB,EAAEE,EAAE0D,sBAAJ,CAAI,IAA2B5D,EAAEE,EAAE2D,oBAAJ,CAAI,GAAvE,CAA9c,EAA+iB1C,EAAE,YAAF,EAAe,QAAQnB,EAAEE,EAAE4D,oBAAJ,CAAI,SAA8B9D,EAAEE,EAAE4D,oBAAJ,CAAI,MAA7D,CAA/iB,EAAyoB3C,EAAE,iBAAF,EAAoB,SAASnB,EAAEE,EAAE6D,yBAAJ,CAAI,SAAmC/D,EAAEE,EAAE6D,yBAAJ,CAAI,MAAxE,CAAzoB,EAAmvB5C,EAAE,iBAAF,EAAoB,eAApB,CAAnvB,EAAwxBA,EAAE,OAAF,EAAU,UAAUnB,EAAEE,EAAE8D,eAAJ,CAAI,SAAyBhE,EAAEE,EAAE8D,eAAJ,CAAI,MAArD,CAAxxB,EAAq2B7C,EAAE,WAAF,EAAc,KAAKnB,EAAEE,EAAE+D,WAAJ,CAAI,GAAejE,EAAEE,EAAEgE,UAAJ,CAAI,IAAelE,EAAEE,EAAEiE,KAAJ,CAAI,GAA7D,CAAr2B,EAA66BhD,EAAE,MAAF,EAAS,IAAInB,EAAEE,EAAEkE,SAAJ,CAAI,GAAjB,CAA76B,EAA68BjD,EAAE,YAAF,EAAe,WAAWnB,EAAEE,EAAEmE,gBAAJ,CAAI,GAAoBrE,EAAEE,EAAEoE,eAAJ,CAAI,IAAoBtE,EAAEE,EAAEiE,KAAJ,CAAI,GAA9E,CAA78B,EAAsiChD,EAAE,OAAF,EAAU,IAAInB,EAAEE,EAAEqE,UAAJ,CAAI,GAAlB,CAAtiC,EAAwkCpD,EAAE,MAAF,EAAS,cAAT,CAAxkC,EAAimCA,EAAE,uBAAF,EAA0B,GAAGnB,EAAEE,EAAE0D,sBAAJ,CAAI,UAAjC,CAAjmC,EAAqqCzC,EAAE,kBAAF,EAAqB,GAAGnB,EAAEE,EAAEyD,iBAAJ,CAAI,UAA5B,CAArqC,EAA+tCxC,EAAE,aAAF,EAAgB,YAAYnB,EAAEE,EAAEsE,gBAAJ,CAAI,WAA+BxE,EAAEE,EAAEsE,gBAAJ,CAAI,WAA+BxE,EAAEE,EAAEsE,gBAAJ,CAAI,OAA2BxE,EAAEE,EAAEgE,UAAJ,CAAI,KAAgBlE,EAAEE,EAAEiE,KAAJ,CAAI,OAAzJ,CAA/tC,EAA04ChD,EAAE,kBAAF,EAAqB,YAAYnB,EAAEE,EAAEuE,qBAAJ,CAAI,WAAoCzE,EAAEE,EAAEuE,qBAAJ,CAAI,WAAoCzE,EAAEE,EAAEuE,qBAAJ,CAAI,OAAgCzE,EAAEE,EAAEoE,eAAJ,CAAI,KAAqBtE,EAAEE,EAAEiE,KAAJ,CAAI,OAAlL,CAA14C,EAA8kDhD,EAAE,QAAF,EAAW,IAAInB,EAAEE,EAAEwE,IAAJ,CAAI,OAAY1E,EAAEE,EAAEyE,WAAJ,CAAI,GAAnC,CAA9kD,EAAkoDxD,EAAE,aAAF,EAAgB,IAAInB,EAAEE,EAAEwE,IAAJ,CAAI,OAAY1E,EAAEE,EAAE0E,gBAAJ,CAAI,GAAxC,CAAloD,EAAgsDzD,EAAE,QAAF,EAAW,oBAAoBxB,mBAAsBA,qBAAwBA,mBAA7E,CAAhsD,EAAqyDwB,EAAE,WAAF,EAAcnB,EAAEE,EAAE2E,MAAJ,CAAd,EAA0B,EAA1B,CAAryD,EAAm0D1D,EAAE,WAAF,EAAc,SAAd,CAAn0D,EAA41DA,EAAE,WAAF,EAAc,SAASnB,EAAEE,EAAE4E,SAAJ,CAAI,MAA3B,EAA4C,EAA5C,CAA51D,EAA44DpF,EAAEqF,gBAAF,GAAmB,KAA/5D,EAAq6D5D,EAAE,OAAF,EAAU,IAAInB,EAAEE,EAAE4E,SAAJ,CAAI,GAAa9E,EAAEE,EAAEyE,WAAJ,CAAI,GAAnC,CAAr6D,EAAy9DxD,EAAE,YAAF,EAAe,IAAInB,EAAEE,EAAE4E,SAAJ,CAAI,GAAa9E,EAAEE,EAAE0E,gBAAJ,CAAI,GAAxC,CAAz9D,EAAuhEzD,EAAE,WAAF,EAAc,SAAd,CAAvhE,EAAgjEA,EAAE,WAAF,EAAc,SAASnB,EAAEE,EAAE8E,SAAJ,CAAI,MAA3B,EAA4C,EAA5C,CAAhjE,EAAgmEtF,EAAEuF,gBAAF,GAAmB,KAAnnE,EAAynE9D,EAAE,OAAF,EAAU,IAAInB,EAAEE,EAAE8E,SAAJ,CAAI,GAAahF,EAAEE,EAAEyE,WAAJ,CAAI,GAAnC,CAAznE,EAA6qExD,EAAE,YAAF,EAAe,IAAInB,EAAEE,EAAE8E,SAAJ,CAAI,GAAahF,EAAEE,EAAE0E,gBAAJ,CAAI,GAAxC,CAA7qE,EAA2uEzD,EAAE,iBAAF,EAAoB,IAAInB,EAAEE,EAAEwE,IAAJ,CAAI,QAAa1E,EAAEE,EAAEqE,UAAJ,CAAI,OAA7C,CAA3uE,EAA4yEpD,EAAE,YAAF,EAAe,IAAInB,EAAEE,EAAEwE,IAAJ,CAAI,QAAa1E,EAAEE,EAAEkE,SAAJ,CAAI,OAAxC,CAA5yE,EAAu2EjD,EAAE,gBAAF,EAAmB,SAASnB,EAAEE,EAAEwE,IAAJ,CAAI,QAAa1E,EAAEE,EAAEqE,UAAJ,CAAI,IAAevE,EAAEE,EAAEyE,WAAJ,CAAI,GAApE,EAAoF,EAApF,CAAv2E,EAA+7EjF,EAAEwF,qBAAF,GAAwB,QAAv9E,EAAg+E/D,EAAE,aAAF,EAAgB,SAASnB,EAAEE,EAAEyE,WAAJ,CAAI,cAAgC3E,EAAEE,EAAEyE,WAAJ,CAAI,QAAjE,CAAh+E,EAA0jFxD,EAAE,kBAAF,EAAqB,SAASnB,EAAEE,EAAE0E,gBAAJ,CAAI,cAAqC5E,EAAEE,EAAE0E,gBAAJ,CAAI,QAA3E,CAA1jF,EAAmqFzD,EAAE,MAAF,EAAS,iBAAT,CAAnqF,EAA+rFA,EAAE,MAAF,EAAS,uBAAT,CAA/rF,EAAiuFA,EAAE,SAAF,EAAY,yBAAZ,CAAjuF;AAA6uF,CAA58F,CAApb;AAAA,IAA65GgE,KAAQ,UAAr6G;AAAA,IAAg7GC,KAAqB,CAAC3F,CAAD,EAAGC,CAAH,KAAO;AAAC,MAAMC,IAAEwF,GAAQjC,IAAR,CAAazD,CAAb,CAAR;AAAA,MAAwBM,IAAEoF,GAAQjC,IAAR,CAAaxD,CAAb,CAA1B;AAA0C,SAAOC,KAAGI,CAAH,KAAON,IAAE,CAACA,CAAH,EAAKC,IAAE,CAACA,CAAf,GAAkBD,MAAIC,CAAJ,GAAM,CAAN,GAAQC,KAAG,CAACI,CAAJ,GAAM,EAAN,GAASA,KAAG,CAACJ,CAAJ,GAAM,CAAN,GAAQF,IAAEC,CAAF,GAAI,EAAJ,GAAO,CAAzD;AAAyD,CAAhjH;AAAA,IAAmjH2F,KAAoB,CAAC5F,CAAD,EAAGC,CAAH,KAAO0F,GAAqB1F,CAArB,EAAuBD,CAAvB,CAA9kH;AAAA,IAAwmH6F,KAAY;AAACC,sBAAmBH,EAApB;AAAyCI,uBAAoBH;AAA7D,CAApnH;AAAA,IAAssH;AAACzC,cAAW6C,EAAZ;AAAyBhD,oBAAiBiD;AAA1C,IAA4DhD,EAAlwH;AAAA,IAA4wH;AAACc,MAAGmC,EAAJ;AAASlG,KAAEmG;AAAX,IAAgBtC,CAA5xH;AAAA,IAAiyH;AAACiC,sBAAmBM;AAApB,IAAwCP,EAAz0H;AAAA,IAAq1HQ,UAAY;AAACC,cAAYrG,CAAZ,EAAcC,CAAd,EAAgB;AAAC,QAAGA,KAAG,OAAiBA,CAAjB,YAAH,KAAwBA,IAAE;AAACqG,aAAM,CAAC,CAACrG,CAAT;AAAWsG,yBAAkB;AAA7B,KAA1B,GAA4DvG,aAAaoG,CAA5E,EAAmF;AAAC,UAAGpG,EAAEsG,KAAF,KAAU,CAAC,CAACrG,EAAEqG,KAAd,IAAqBtG,EAAEuG,iBAAF,KAAsB,CAAC,CAACtG,EAAEsG,iBAAlD,EAAoE,OAAOvG,CAAP;AAASA,UAAEA,EAAEwG,OAAJ;AAAI,KAArK,MAAqK,IAAgB,OAAiBxG,CAAjB,YAAhB,EAAmC,MAAM,IAAIO,SAAJ,CAAc,oBAAoBP,GAAlC,CAAN;;AAA6C,QAAGA,EAAEqB,MAAF,GAAS0E,EAAZ,EAAyB,MAAM,IAAIxF,SAAJ,CAAc,0BAA0BwF,eAAxC,CAAN;AAAyEpC,MAAQ,QAAR,EAAiB3D,CAAjB,EAAmBC,CAAnB,GAAsB,KAAKwG,OAAL,GAAaxG,CAAnC,EAAqC,KAAKqG,KAAL,GAAW,CAAC,CAACrG,EAAEqG,KAApD,EAA0D,KAAKC,iBAAL,GAAuB,CAAC,CAACtG,EAAEsG,iBAArF;AAAuG,QAAMlG,IAAEL,EAAE0G,IAAF,GAASC,KAAT,CAAe1G,EAAEqG,KAAF,GAAQL,GAAKC,GAAIU,KAAT,CAAR,GAAwBX,GAAKC,GAAIW,IAAT,CAAvC,CAAR;AAA+D,QAAG,CAACxG,CAAJ,EAAM,MAAM,IAAIE,SAAJ,CAAc,oBAAoBP,GAAlC,CAAN;AAA6C,QAAG,KAAK8G,GAAL,GAAS9G,CAAT,EAAW,KAAK+G,KAAL,GAAW,CAAC1G,EAAE,CAAF,CAAvB,EAA4B,KAAK2G,KAAL,GAAW,CAAC3G,EAAE,CAAF,CAAxC,EAA6C,KAAK4G,KAAL,GAAW,CAAC5G,EAAE,CAAF,CAAzD,EAA8D,KAAK0G,KAAL,GAAWf,CAAX,IAA6B,KAAKe,KAAL,GAAW,CAAzG,EAA2G,MAAM,IAAIxG,SAAJ,CAAc,uBAAd,CAAN;AAA6C,QAAG,KAAKyG,KAAL,GAAWhB,CAAX,IAA6B,KAAKgB,KAAL,GAAW,CAA3C,EAA6C,MAAM,IAAIzG,SAAJ,CAAc,uBAAd,CAAN;AAA6C,QAAG,KAAK0G,KAAL,GAAWjB,CAAX,IAA6B,KAAKiB,KAAL,GAAW,CAA3C,EAA6C,MAAM,IAAI1G,SAAJ,CAAc,uBAAd,CAAN;AAA6CF,MAAE,CAAF,IAAK,KAAK6G,UAAL,GAAgB7G,EAAE,CAAF,EAAK8G,KAAL,CAAW,GAAX,EAAgBC,GAAhB,CAAoB9G,KAAG;AAAC,UAAG,WAAWkD,IAAX,CAAgBlD,CAAhB,CAAH,EAAsB;AAAC,YAAME,IAAE,CAACF,CAAT;AAAW,YAAGE,KAAG,CAAH,IAAMA,IAAEwF,CAAX,EAA4B,OAAOxF,CAAP;AAAS;;AAAA,aAAOF,CAAP;AAAO,KAAtG,CAArB,GAA+H,KAAK4G,UAAL,GAAgB,EAA/I,EAAkJ,KAAKG,KAAL,GAAWhH,EAAE,CAAF,IAAKA,EAAE,CAAF,EAAK8G,KAAL,CAAW,GAAX,CAAL,GAAqB,EAAlL,EAAqL,KAAKG,MAAL,EAArL;AAAmM;;AAAAA,WAAQ;AAAC,WAAO,KAAKd,OAAL,GAAa,GAAG,KAAKO,SAAS,KAAKC,SAAS,KAAKC,OAAjD,EAAyD,KAAKC,UAAL,CAAgB7F,MAAhB,KAAyB,KAAKmF,OAAL,IAAc,IAAI,KAAKU,UAAL,CAAgBK,IAAhB,CAAqB,GAArB,CAAqB,EAAhE,CAAzD,EAAiI,KAAKf,OAA7I;AAAqJ;;AAAAgB,aAAU;AAAC,WAAO,KAAKhB,OAAZ;AAAoB;;AAAAiB,UAAQzH,CAAR,EAAU;AAAC,QAAG2D,EAAQ,gBAAR,EAAyB,KAAK6C,OAA9B,EAAsC,KAAKC,OAA3C,EAAmDzG,CAAnD,GAAsD,EAAEA,aAAaoG,CAAf,CAAzD,EAAgF;AAAC,UAAG,OAAiBpG,CAAjB,YAAU,IAAUA,MAAI,KAAKwG,OAAhC,EAAwC,OAAO,CAAP;AAASxG,UAAE,IAAIoG,CAAJ,CAAWpG,CAAX,EAAa,KAAKyG,OAAlB,CAAF;AAA6B;;AAAA,WAAOzG,EAAEwG,OAAF,KAAY,KAAKA,OAAjB,GAAyB,CAAzB,GAA2B,KAAKkB,WAAL,CAAiB1H,CAAjB,KAAqB,KAAK2H,UAAL,CAAgB3H,CAAhB,CAAvD;AAA0E;;AAAA0H,cAAY1H,CAAZ,EAAc;AAAC,WAAOA,aAAaoG,CAAb,KAAsBpG,IAAE,IAAIoG,CAAJ,CAAWpG,CAAX,EAAa,KAAKyG,OAAlB,CAAxB,GAAoDN,EAAmB,KAAKY,KAAxB,EAA8B/G,EAAE+G,KAAhC,KAAwCZ,EAAmB,KAAKa,KAAxB,EAA8BhH,EAAEgH,KAAhC,CAAxC,IAAgFb,EAAmB,KAAKc,KAAxB,EAA8BjH,EAAEiH,KAAhC,CAA3I;AAAkL;;AAAAU,aAAW3H,CAAX,EAAa;AAAC,QAAGA,aAAaoG,CAAb,KAAsBpG,IAAE,IAAIoG,CAAJ,CAAWpG,CAAX,EAAa,KAAKyG,OAAlB,CAAxB,GAAoD,KAAKS,UAAL,CAAgB7F,MAAhB,IAAwB,CAACrB,EAAEkH,UAAF,CAAa7F,MAA7F,EAAoG,OAAM,EAAN;AAAS,QAAG,CAAC,KAAK6F,UAAL,CAAgB7F,MAAjB,IAAyBrB,EAAEkH,UAAF,CAAa7F,MAAzC,EAAgD,OAAO,CAAP;AAAS,QAAG,CAAC,KAAK6F,UAAL,CAAgB7F,MAAjB,IAAyB,CAACrB,EAAEkH,UAAF,CAAa7F,MAA1C,EAAiD,OAAO,CAAP;AAAS,QAAIpB,IAAE,CAAN;;AAAQ,OAAE;AAAC,UAAMI,IAAE,KAAK6G,UAAL,CAAgBjH,CAAhB,CAAR;AAAA,UAA2BK,IAAEN,EAAEkH,UAAF,CAAajH,CAAb,CAA7B;AAA6C,UAAG0D,EAAQ,oBAAR,EAA6B1D,CAA7B,EAA+BI,CAA/B,EAAiCC,CAAjC,GAAoCD,CAAS,KAAT,UAAYC,CAAS,KAAT,MAAnD,EAA8D,OAAO,CAAP;AAAS,UAAGA,CAAS,KAAT,MAAH,EAAc,OAAO,CAAP;AAAS,UAAGD,CAAS,KAAT,MAAH,EAAc,OAAM,EAAN;AAAS,UAAGA,MAAIC,CAAP,EAAS,OAAO6F,EAAmB9F,CAAnB,EAAqBC,CAArB,CAAP;AAA4B,KAA1M,QAAmN,EAAEL,CAArN;AAAwN;;AAAA2H,eAAa5H,CAAb,EAAe;AAACA,iBAAaoG,CAAb,KAAsBpG,IAAE,IAAIoG,CAAJ,CAAWpG,CAAX,EAAa,KAAKyG,OAAlB,CAAxB;AAAoD,QAAIxG,IAAE,CAAN;;AAAQ,OAAE;AAAC,UAAMI,IAAE,KAAKgH,KAAL,CAAWpH,CAAX,CAAR;AAAA,UAAsBK,IAAEN,EAAEqH,KAAF,CAAQpH,CAAR,CAAxB;AAAmC,UAAG0D,EAAQ,oBAAR,EAA6B1D,CAA7B,EAA+BI,CAA/B,EAAiCC,CAAjC,GAAoCD,CAAS,KAAT,MAAS,IAAYC,MAAT,MAAnD,EAA8D,OAAO,CAAP;AAAS,UAAGA,CAAS,KAAT,MAAH,EAAc,OAAO,CAAP;AAAS,UAAGD,CAAS,KAAT,MAAH,EAAc,OAAM,EAAN;AAAS,UAAGA,MAAIC,CAAP,EAAS,OAAO6F,EAAmB9F,CAAnB,EAAqBC,CAArB,CAAP;AAA4B,KAAhM,QAAyM,EAAEL,CAA3M;AAA8M;;AAAA4H,MAAI7H,CAAJ,EAAMC,CAAN,EAAQ;AAAC,YAAOD,CAAP;AAAO,WAAO,UAAP;AAAkB,aAAKkH,UAAL,CAAgB7F,MAAhB,GAAuB,CAAvB,EAAyB,KAAK4F,KAAL,GAAW,CAApC,EAAsC,KAAKD,KAAL,GAAW,CAAjD,EAAmD,KAAKD,KAAL,EAAnD,EAAgE,KAAKc,GAAL,CAAS,KAAT,EAAe5H,CAAf,CAAhE;AAAkF;;AAAA,WAAU,UAAV;AAAqB,aAAKiH,UAAL,CAAgB7F,MAAhB,GAAuB,CAAvB,EAAyB,KAAK4F,KAAL,GAAW,CAApC,EAAsC,KAAKD,KAAL,EAAtC,EAAmD,KAAKa,GAAL,CAAS,KAAT,EAAe5H,CAAf,CAAnD;AAAqE;;AAAA,WAAU,UAAV;AAAqB,aAAKiH,UAAL,CAAgB7F,MAAhB,GAAuB,CAAvB,EAAyB,KAAKwG,GAAL,CAAS,OAAT,EAAiB5H,CAAjB,CAAzB,EAA6C,KAAK4H,GAAL,CAAS,KAAT,EAAe5H,CAAf,CAA7C;AAA+D;;AAAA,WAAU,YAAV;AAA2B,aAAKiH,UAAL,CAAgB7F,MAApB,MAAI,IAAwB,KAAKwG,GAAL,CAAS,OAAT,EAAiB5H,CAAjB,CAA5B,EAAgD,KAAK4H,GAAL,CAAS,KAAT,EAAe5H,CAAf,CAAhD;AAAkE;;AAAA,WAAU,OAAV;AAAsB,aAAK+G,KAAL,KAAJ,KAAoB,KAAKC,KAAL,KAAJ,CAAZ,IAA4B,KAASC,UAAL,CAAgB7F,MAApB,MAAhC,IAA4D,KAAK0F,KAAL,EAA5D,EAAyE,KAAKC,KAAL,GAAW,CAApF,EAAsF,KAAKC,KAAL,GAAW,CAAjG,EAAmG,KAAKC,UAAL,GAAgB,EAAnH;AAAsH;;AAAA,WAAU,OAAV;AAAsB,aAAKD,KAAL,KAAJ,KAAoB,KAAKC,UAAL,CAAgB7F,MAApB,MAAhB,IAA4C,KAAK2F,KAAL,EAAxC,EAAqD,KAAKC,KAAL,GAAW,CAApE,EAAsE,KAAKC,UAAL,GAAgB,EAAlF;AAAqF;;AAAA,WAAU,OAAV;AAAsB,aAAKA,UAAL,CAAgB7F,MAApB,MAAI,IAAwB,KAAK4F,KAAL,EAA5B,EAAyC,KAAKC,UAAL,GAAgB,EAArD;AAAwD;;AAAA,WAAU,KAAV;AAAgB,YAAG,KAASA,UAAL,CAAgB7F,MAApB,MAAH,EAA8B,KAAK6F,UAAL,GAAgB,CAAC,CAAD,CAAhB,CAA9B,KAAsD;AAAC,cAAI7G,IAAE,KAAK6G,UAAL,CAAgB7F,MAAtB;;AAA6B,iBAAK,EAAEhB,CAAF,IAAK,CAAV,GAAuB,OAAO,KAAK6G,UAAL,CAAgB7G,CAAhB,CAAP,IAAV,aAAsC,KAAK6G,UAAL,CAAgB7G,CAAhB,KAAqBA,IAAE,EAA7D;;AAAiEA,WAAK,KAAL,EAAK,IAAG,KAAK6G,UAAL,CAAgBtG,IAAhB,CAAqB,CAArB,CAAR;AAAgC;AAAAX,cAAI,KAAKiH,UAAL,CAAgB,CAAhB,MAAqBjH,CAArB,GAAuB6H,MAAM,KAAKZ,UAAL,CAAgB,CAAhB,CAAN,MAA4B,KAAKA,UAAL,GAAgB,CAACjH,CAAD,EAAG,CAAH,CAA5C,CAAvB,GAA0E,KAAKiH,UAAL,GAAgB,CAACjH,CAAD,EAAG,CAAH,CAA9F;AAAqG;;AAAA;AAAc,cAAM,IAAI8H,KAAJ,CAAU,+BAA+B/H,GAAzC,CAAN;AAAx/B;;AAA4iC,WAAO,KAAKsH,MAAL,IAAc,KAAKR,GAAL,GAAS,KAAKN,OAA5B,EAAoC,IAA3C;AAA2C;;AAA3gH,CAAj2H;AAAA,IAAw3OwB,KAAQ,CAACjI,CAAD,EAAGC,CAAH,EAAKC,CAAL,KAAS,IAAImG,CAAJ,CAAWrG,CAAX,EAAaE,CAAb,EAAgBwH,OAAhB,CAAwB,IAAIrB,CAAJ,CAAWpG,CAAX,EAAaC,CAAb,CAAxB,CAAz4O;AAAA,IAAk7OgI,IAAUD,EAA57O;AAAA,IAAo8OE,KAAG,CAACnI,CAAD,EAAGC,CAAH,EAAKC,CAAL,KAAagI,EAAUlI,CAAV,EAAYC,CAAZ,EAAcC,CAAd,CAAJ,MAAh9O;AAAA,IAAq+OkI,KAAKD,EAA1+O;AAAA,IAA6+OE,KAAI,CAACrI,CAAD,EAAGC,CAAH,EAAKC,CAAL,KAAagI,EAAUlI,CAAV,EAAYC,CAAZ,EAAcC,CAAd,CAAJ,MAA1/O;AAAA,IAA+gPoI,KAAMD,EAArhP;AAAA,IAAyhPE,KAAG,CAACvI,CAAD,EAAGC,CAAH,EAAKC,CAAL,KAASgI,EAAUlI,CAAV,EAAYC,CAAZ,EAAcC,CAAd,IAAiB,CAAtjP;AAAA,IAAwjPsI,KAAKD,EAA7jP;AAAA,IAAgkPE,KAAI,CAACzI,CAAD,EAAGC,CAAH,EAAKC,CAAL,KAASgI,EAAUlI,CAAV,EAAYC,CAAZ,EAAcC,CAAd,KAAkB,CAA/lP;AAAA,IAAimPwI,KAAMD,EAAvmP;AAAA,IAA2mPE,KAAG,CAAC3I,CAAD,EAAGC,CAAH,EAAKC,CAAL,KAASgI,EAAUlI,CAAV,EAAYC,CAAZ,EAAcC,CAAd,IAAiB,CAAxoP;AAAA,IAA0oP0I,KAAKD,EAA/oP;AAAA,IAAkpPE,KAAI,CAAC7I,CAAD,EAAGC,CAAH,EAAKC,CAAL,KAASgI,EAAUlI,CAAV,EAAYC,CAAZ,EAAcC,CAAd,KAAkB,CAAjrP;AAAA,IAAmrP4I,KAAMD,EAAzrP;AAAA,IAA6rPE,KAAI,CAAC/I,CAAD,EAAGC,CAAH,EAAKC,CAAL,EAAOI,CAAP,KAAW;AAAC,UAAOL,CAAP;AAAO,SAAO,KAAP;AAAa,aAAgB,OAAOD,CAAP,IAAV,QAAU,KAAWA,IAAEA,EAAEyG,OAAf,GAAkC,OAAOvG,CAAP,IAAV,aAAqBA,IAAEA,EAAEuG,OAAf,CAAlC,EAA0DzG,MAAIE,CAA9E;;AAA8E,SAAM,KAAN;AAAY,aAAgB,OAAOF,CAAP,IAAV,QAAU,KAAWA,IAAEA,EAAEyG,OAAf,GAAkC,OAAOvG,CAAP,IAAV,aAAqBA,IAAEA,EAAEuG,OAAf,CAAlC,EAA0DzG,MAAIE,CAA9E;;AAA8E,SAAM,EAAN;AAAM,SAAO,GAAP;AAAO,SAAQ,IAAR;AAAa,aAAOkI,GAAKpI,CAAL,EAAOE,CAAP,EAASI,CAAT,CAAP;;AAAgB,SAAO,IAAP;AAAY,aAAOgI,GAAMtI,CAAN,EAAQE,CAAR,EAAUI,CAAV,CAAP;;AAAiB,SAAO,GAAP;AAAW,aAAOkI,GAAKxI,CAAL,EAAOE,CAAP,EAASI,CAAT,CAAP;;AAAgB,SAAO,IAAP;AAAY,aAAOoI,GAAM1I,CAAN,EAAQE,CAAR,EAAUI,CAAV,CAAP;;AAAiB,SAAO,GAAP;AAAW,aAAOsI,GAAK5I,CAAL,EAAOE,CAAP,EAASI,CAAT,CAAP;;AAAgB,SAAO,IAAP;AAAY,aAAOwI,GAAM9I,CAAN,EAAQE,CAAR,EAAUI,CAAV,CAAP;;AAAiB;AAAW,YAAM,IAAIE,SAAJ,CAAc,qBAAqBP,GAAnC,CAAN;AAA9X;AAAua,CAApnQ;AAAA,IAA2nQ+I,KAAMD,EAAjoQ;AAAA,IAAqoQE,IAAIC,OAAO,YAAP,CAAzoQ;AAAA,IAA8pQC,UAAgB;AAAY,mBAAK;AAAC,WAAOF,CAAP;AAAW;;AAAA3C,cAAYrG,CAAZ,EAAcC,CAAd,EAAgB;AAAC,QAAGA,KAAa,OAAOA,CAAP,IAAV,QAAH,KAAwBA,IAAE;AAACqG,aAAM,CAAC,CAACrG,CAAT;AAAWsG,yBAAkB;AAA7B,KAA1B,GAA4DvG,aAAakJ,CAA5E,EAAuF;AAAC,UAAGlJ,EAAEsG,KAAF,KAAU,CAAC,CAACrG,EAAEqG,KAAjB,EAAuB,OAAOtG,CAAP;AAASA,UAAEA,EAAEmJ,KAAJ;AAAU;;AAAAxF,MAAQ,YAAR,EAAqB3D,CAArB,EAAuBC,CAAvB,GAA0B,KAAKwG,OAAL,GAAaxG,CAAvC,EAAyC,KAAKqG,KAAL,GAAW,CAAC,CAACrG,EAAEqG,KAAxD,EAA8D,KAAK8C,KAAL,CAAWpJ,CAAX,CAA9D,EAA4E,KAAKqJ,MAAL,KAAcL,CAAd,GAAkB,KAAKG,KAAL,GAAW,EAA7B,GAAgC,KAAKA,KAAL,GAAW,KAAKG,QAAL,GAAc,KAAKD,MAAL,CAAY7C,OAAjJ,EAAyJ7C,EAAQ,MAAR,EAAe,IAAf,CAAzJ;AAA8K;;AAAAyF,QAAMpJ,CAAN,EAAQ;AAAC,QAAMC,IAAE,KAAKwG,OAAL,CAAaH,KAAb,GAAmBiD,GAAKC,GAAIC,eAAT,CAAnB,GAA6CF,GAAKC,GAAIE,UAAT,CAArD;AAAA,QAA0ErJ,IAAEL,EAAE2G,KAAF,CAAQ1G,CAAR,CAA5E;AAAuF,QAAG,CAACI,CAAJ,EAAM,MAAM,IAAIE,SAAJ,CAAc,uBAAuBP,GAArC,CAAN;AAAgD,SAAKsJ,QAAL,GAAcjJ,CAAS,CAAE,CAAF,CAAT,WAAS,GAAKA,EAAE,CAAF,CAAd,GAAmB,EAAjC,EAAoC,KAAWiJ,QAAX,QAAM,KAAgB,KAAKA,QAAL,GAAc,EAApC,CAApC,EAA4EjJ,EAAE,CAAF,IAAK,KAAKgJ,MAAL,GAAY,IAAIjD,CAAJ,CAAW/F,EAAE,CAAF,CAAX,EAAgB,KAAKoG,OAAL,CAAaH,KAA7B,CAAjB,GAAqD,KAAK+C,MAAL,GAAYL,CAA7I;AAAiJ;;AAAAxB,aAAU;AAAC,WAAO,KAAK2B,KAAZ;AAAkB;;AAAA3F,OAAKxD,CAAL,EAAO;AAAC,QAAG2D,EAAQ,iBAAR,EAA0B3D,CAA1B,EAA4B,KAAKyG,OAAL,CAAaH,KAAzC,GAAgD,KAAK+C,MAAL,KAAcL,CAAd,IAAmBhJ,MAAIgJ,CAA1E,EAA8E,OAAM,EAAN;AAAS,QAAa,OAAOhJ,CAAjB,YAAH,EAAsB,IAAG;AAACA,UAAE,IAAIoG,CAAJ,CAAWpG,CAAX,EAAa,KAAKyG,OAAlB,CAAF;AAAoB,KAAxB,CAAwB,OAAexG,CAAf,EAAS;AAAS,aAAM,EAAN;AAAS;AAAA,WAAO8I,GAAM/I,CAAN,EAAQ,KAAKsJ,QAAb,EAAsB,KAAKD,MAA3B,EAAkC,KAAK5C,OAAvC,CAAP;AAAuD;;AAAAkD,aAAW3J,CAAX,EAAaC,CAAb,EAAe;AAAC,QAAG,EAAED,aAAakJ,CAAf,CAAH,EAA8B,MAAM,IAAI3I,SAAJ,CAAc,0BAAd,CAAN;AAAgD,QAAGN,KAAa,OAAOA,CAAjB,YAAH,KAAwBA,IAAE;AAACqG,aAAM,CAAC,CAACrG,CAAT;AAAWsG,yBAAkB;AAA7B,KAA1B,GAA4D,KAAU+C,QAAV,OAA/D,EAAkF,OAAW,KAAKH,KAAL,KAAL,EAAK,IAAY,IAAIS,CAAJ,CAAU5J,EAAEmJ,KAAZ,EAAkBlJ,CAAlB,EAAqBuD,IAArB,CAA0B,KAAK2F,KAA/B,CAAvB;AAA6D,QAAQnJ,EAAEsJ,QAAP,OAAH,EAAmB,OAAWtJ,EAAEmJ,KAAF,KAAL,EAAK,IAAS,IAAIS,CAAJ,CAAU,KAAKT,KAAf,EAAqBlJ,CAArB,EAAwBuD,IAAxB,CAA6BxD,EAAEqJ,MAA/B,CAApB;AAA2D,QAAMhJ,IAAE,EAAS,KAAKiJ,QAAL,KAAP,IAAO,IAAe,KAAWA,QAAX,QAAf,IAA2CtJ,EAAEsJ,QAAT,SAAO,IAAYtJ,CAAM,CAAEsJ,QAAR,QAAhE,CAAR;AAAA,QAA0FhJ,IAAE,EAAS,KAAKgJ,QAAL,KAAP,IAAO,IAAe,KAAWA,QAAX,QAAf,IAA2CtJ,EAAEsJ,QAAT,SAAO,IAAYtJ,CAAM,CAAEsJ,QAAR,QAAhE,CAA5F;AAAA,QAA8K9I,IAAE,KAAK6I,MAAL,CAAY7C,OAAZ,KAAsBxG,EAAEqJ,MAAF,CAAS7C,OAA/M;AAAA,QAAuN9F,IAAE,EAAS,KAAK4I,QAAL,KAAP,IAAO,IAAe,KAAYA,QAAZ,SAAf,IAA4CtJ,EAAEsJ,QAAT,SAAO,IAAYtJ,CAAO,CAAEsJ,QAAT,SAAjE,CAAzN;AAAA,QAA6S7H,IAAEsH,GAAM,KAAKM,MAAX,EAAkB,GAAlB,EAAsBrJ,EAAEqJ,MAAxB,EAA+BpJ,CAA/B,MAA2C,KAAKqJ,QAAL,KAAP,IAAO,IAAe,KAAWA,QAAX,QAA1D,MAAwFtJ,EAAEsJ,QAAF,KAAP,IAAO,IAAYtJ,CAAM,CAAEsJ,QAAR,QAApG,CAA/S;AAAA,QAAqa5H,IAAEqH,GAAM,KAAKM,MAAX,EAAkB,GAAlB,EAAsBrJ,EAAEqJ,MAAxB,EAA+BpJ,CAA/B,MAA2C,KAAKqJ,QAAL,KAAP,IAAO,IAAe,KAAWA,QAAX,QAA1D,MAAwFtJ,EAAEsJ,QAAF,KAAP,IAAO,IAAYtJ,CAAM,CAAEsJ,QAAR,QAApG,CAAva;AAA6hB,WAAOjJ,KAAGC,CAAH,IAAME,KAAGE,CAAT,IAAYe,CAAZ,IAAeC,CAAtB;AAAsB;;AAA/uD,CAA9qQ;AAAA,IAAq6T;AAACoC,MAAGyF,EAAJ;AAASxJ,KAAEyJ;AAAX,IAAgB5F,CAAr7T;AAAA,IAA07TgG,UAAW;AAACvD,cAAYrG,CAAZ,EAAcC,CAAd,EAAgB;AAAC,QAAGA,KAAa,OAAOA,CAAjB,YAAH,KAAwBA,IAAE;AAACqG,aAAM,CAAC,CAACrG,CAAT;AAAWsG,yBAAkB;AAA7B,KAA1B,GAA4DvG,aAAa4J,CAA5E,EAAkF,OAAO5J,EAAEsG,KAAF,KAAU,CAAC,CAACrG,EAAEqG,KAAd,IAAqBtG,EAAEuG,iBAAF,KAAsB,CAAC,CAACtG,EAAEsG,iBAA/C,GAAiEvG,CAAjE,GAAmE,IAAI4J,CAAJ,CAAU5J,EAAE8G,GAAZ,EAAgB7G,CAAhB,CAA1E;AAA6F,QAAGD,aAAakJ,CAAhB,EAA2B,OAAO,KAAKpC,GAAL,GAAS9G,EAAEmJ,KAAX,EAAiB,KAAKU,GAAL,GAAS,CAAC,CAAC7J,CAAD,CAAD,CAA1B,EAAgC,KAAKsH,MAAL,EAAhC,EAA8C,IAArD;AAA0D,QAAG,KAAKb,OAAL,GAAaxG,CAAb,EAAe,KAAKqG,KAAL,GAAW,CAAC,CAACrG,EAAEqG,KAA9B,EAAoC,KAAKC,iBAAL,GAAuB,CAAC,CAACtG,EAAEsG,iBAA/D,EAAiF,KAAKO,GAAL,GAAS9G,CAA1F,EAA4F,KAAK6J,GAAL,GAAS7J,EAAEmH,KAAF,CAAQ,YAAR,EAAsBC,GAAtB,CAA0B/G,KAAG,KAAKyJ,UAAL,CAAgBzJ,EAAEqG,IAAF,EAAhB,CAA7B,EAAwDqD,MAAxD,CAA+D1J,KAAGA,EAAEgB,MAApE,CAArG,EAAiL,CAAC,KAAKwI,GAAL,CAASxI,MAA9L,EAAqM,MAAM,IAAId,SAAJ,CAAc,yBAAyBP,GAAvC,CAAN;AAAkD,SAAKsH,MAAL;AAAc;;AAAAA,WAAQ;AAAC,WAAO,KAAK0C,KAAL,GAAW,KAAKH,GAAL,CAASzC,GAAT,CAAapH,KAAGA,EAAEuH,IAAF,CAAO,GAAP,EAAYb,IAAZ,EAAhB,EAAoCa,IAApC,CAAyC,IAAzC,EAA+Cb,IAA/C,EAAX,EAAiE,KAAKsD,KAA7E;AAAmF;;AAAAxC,aAAU;AAAC,WAAO,KAAKwC,KAAZ;AAAkB;;AAAAF,aAAW9J,CAAX,EAAa;AAAC,QAAK;AAACsG,aAAMrG;AAAP,QAAU,KAAKwG,OAApB;AAA4BzG,QAAEA,EAAE0G,IAAF,EAAF;AAAW,QAAMrG,IAAEJ,IAAEgK,EAAKC,EAAIC,gBAAT,CAAF,GAA6BF,EAAKC,EAAIE,WAAT,CAArC;AAA2DpK,QAAEA,EAAEqK,OAAF,CAAUhK,CAAV,EAAYiK,GAAc,KAAK7D,OAAL,CAAaF,iBAA3B,CAAZ,CAAF,EAA6D5C,EAAQ,gBAAR,EAAyB3D,CAAzB,CAA7D,EAAyFA,IAAEA,EAAEqK,OAAF,CAAUJ,EAAKC,EAAIK,cAAT,CAAV,EAAmCC,EAAnC,CAA3F,EAAqJ7G,EAAQ,iBAAR,EAA0B3D,CAA1B,EAA4BiK,EAAKC,EAAIK,cAAT,CAA5B,CAArJ,EAA2MvK,IAAG,KAAG,KAAEA,EAAEqK,OAAF,CAAUJ,EAAKC,EAAIO,SAAT,CAAV,EAA8BC,EAA9B,CAAF,EAAmDL,OAAnD,CAA2DJ,EAAKC,EAAIS,SAAT,CAA3D,EAA+EC,EAA/E,CAAH,EAAqGzD,KAArG,CAA2G,KAA3G,EAAkHI,IAAlH,CAAuH,GAAvH,CAA9M;AAA0U,QAAMjH,IAAEL,IAAEgK,EAAKC,EAAIT,eAAT,CAAF,GAA4BQ,EAAKC,EAAIR,UAAT,CAApC;AAAyD,WAAO1J,EAAEmH,KAAF,CAAQ,GAAR,EAAaC,GAAb,CAAiB5G,KAAGqK,GAAgBrK,CAAhB,EAAkB,KAAKiG,OAAvB,CAApB,EAAqDc,IAArD,CAA0D,GAA1D,EAA+DJ,KAA/D,CAAqE,KAArE,EAA4EC,GAA5E,CAAgF5G,KAAGsK,GAAYtK,CAAZ,EAAc,KAAKiG,OAAnB,CAAnF,EAAgHsD,MAAhH,CAAuH,KAAKtD,OAAL,CAAaH,KAAb,GAAmB9F,KAAG,CAAC,CAACA,EAAEmG,KAAF,CAAQrG,CAAR,CAAxB,GAAmC,MAAI,EAA9J,EAAkK8G,GAAlK,CAAsK5G,KAAG,IAAI0I,CAAJ,CAAe1I,CAAf,EAAiB,KAAKiG,OAAtB,CAAzK,CAAP;AAAgN;;AAAAkD,aAAW3J,CAAX,EAAaC,CAAb,EAAe;AAAC,QAAG,EAAED,aAAa4J,CAAf,CAAH,EAAyB,MAAM,IAAIrJ,SAAJ,CAAc,qBAAd,CAAN;AAA2C,WAAO,KAAKsJ,GAAL,CAASkB,IAAT,CAAc1K,KAAG2K,GAAc3K,CAAd,EAAgBJ,CAAhB,KAAoBD,EAAE6J,GAAF,CAAMkB,IAAN,CAAWzK,KAAG0K,GAAc1K,CAAd,EAAgBL,CAAhB,KAAoBI,EAAE4K,KAAF,CAAQzK,KAAGF,EAAE2K,KAAF,CAAQvK,KAAGF,EAAEmJ,UAAF,CAAajJ,CAAb,EAAeT,CAAf,CAAX,CAAX,CAAlC,CAArC,CAAP;AAA0H;;AAAAuD,OAAKxD,CAAL,EAAO;AAAC,QAAG,CAACA,CAAJ,EAAM,OAAM,EAAN;AAAS,QAAG,OAAiBA,CAAjB,YAAH,EAAsB,IAAG;AAACA,UAAE,IAAIoG,CAAJ,CAAWpG,CAAX,EAAa,KAAKyG,OAAlB,CAAF;AAAoB,KAAxB,CAAwB,OAAexG,CAAf,EAAS;AAAS,aAAM,EAAN;AAAS;;AAAA,aAAQA,IAAE,CAAV,EAAYA,IAAE,KAAK4J,GAAL,CAASxI,MAAvB,EAA8BpB,GAA9B,EAAkC,IAAGiL,GAAQ,KAAKrB,GAAL,CAAS5J,CAAT,CAAR,EAAoBD,CAApB,EAAsB,KAAKyG,OAA3B,CAAH,EAAuC,OAAM,EAAN;;AAAS,WAAM,EAAN;AAAM;;AAA7tD,CAAr8T;AAAA,IAA2qX;AAAC3C,MAAGmG,CAAJ;AAASlK,KAAEmK,CAAX;AAAe1E,yBAAsBgF,EAArC;AAA2DnF,oBAAiBqF,EAA5E;AAA6FnF,oBAAiBqF;AAA9G,IAAgIhH,CAA3yX;AAAA,IAAgzXoH,KAAc,CAACjL,CAAD,EAAGC,CAAH,KAAO;AAAC,MAAIC,IAAE,EAAN;AAAA,MAAeI,IAAEN,EAAEkB,KAAF,EAAjB;AAAA,MAA+BX,IAAED,EAAE8K,GAAF,EAAjC;;AAAyC,SAAKlL,KAAGI,EAAEgB,MAAV,GAAkBpB,IAAEI,EAAE4K,KAAF,CAAQzK,KAAGF,EAAEqJ,UAAF,CAAanJ,CAAb,EAAeR,CAAf,CAAX,CAAF,EAAgCM,IAAED,EAAE8K,GAAF,EAAlC;;AAA0C,SAAOlL,CAAP;AAAO,CAAl7X;AAAA,IAAq7X4K,KAAgB,CAAC9K,CAAD,EAAGC,CAAH,MAAQ2D,EAAQ,MAAR,EAAe5D,CAAf,EAAiBC,CAAjB,GAAoBD,IAAEqL,GAAcrL,CAAd,EAAgBC,CAAhB,CAAtB,EAAyC2D,EAAQ,OAAR,EAAgB5D,CAAhB,CAAzC,EAA4DA,IAAEsL,GAActL,CAAd,EAAgBC,CAAhB,CAA9D,EAAiF2D,EAAQ,QAAR,EAAiB5D,CAAjB,CAAjF,EAAqGA,IAAEuL,GAAevL,CAAf,EAAiBC,CAAjB,CAAvG,EAA2H2D,EAAQ,QAAR,EAAiB5D,CAAjB,CAA3H,EAA+IA,IAAEoC,GAAapC,CAAb,EAAeC,CAAf,CAAjJ,EAAmK2D,EAAQ,OAAR,EAAgB5D,CAAhB,CAAnK,EAAsLA,CAA9L,CAAr8X;AAAA,IAAsoYwL,IAAIxL,KAAG,CAACA,CAAD,IAAUA,EAAEyL,WAAR,UAAJ,IAA2BzL,CAAM,KAAN,GAAxqY;AAAA,IAAgrYsL,KAAc,CAACtL,CAAD,EAAGC,CAAH,KAAOD,EAAE2G,IAAF,GAASS,KAAT,CAAe,KAAf,EAAsBC,GAAtB,CAA0BnH,KAAGwL,GAAaxL,CAAb,EAAeD,CAAf,CAA7B,EAAgDuH,IAAhD,CAAqD,GAArD,CAArsY;AAAA,IAA+vYkE,KAAa,CAAC1L,CAAD,EAAGC,CAAH,KAAO;AAAC,MAAMC,IAAED,EAAEsG,KAAF,GAAQ2D,EAAKC,EAAIwB,UAAT,CAAR,GAA6BzB,EAAKC,EAAIyB,KAAT,CAArC;AAAqD,SAAO5L,EAAEsK,OAAF,CAAUpK,CAAV,EAAY,CAACI,CAAD,EAAGC,CAAH,EAAKE,CAAL,EAAOE,CAAP,EAASe,CAAT,KAAa;AAAC,QAAIC,CAAJ;AAAM,WAAOiC,EAAQ,OAAR,EAAgB5D,CAAhB,EAAkBM,CAAlB,EAAoBC,CAApB,EAAsBE,CAAtB,EAAwBE,CAAxB,EAA0Be,CAA1B,GAA6B8J,EAAIjL,CAAJ,IAAOoB,IAAE,EAAT,GAAY6J,EAAI/K,CAAJ,IAAOkB,IAAE,KAAKpB,UAAU,CAACA,CAAD,GAAG,SAA3B,GAAqCiL,EAAI7K,CAAJ,IAAOgB,IAAE,KAAKpB,KAAKE,QAAQF,KAAK,CAACE,CAAD,GAAG,OAAnC,GAA2CiB,KAAGkC,EAAQ,iBAAR,EAA0BlC,CAA1B,GAA6BC,IAAE,KAAKpB,KAAKE,KAAKE,KAAKe,MAAMnB,KAAK,CAACE,CAAD,GAAG,OAApE,IAA6EkB,IAAE,KAAKpB,KAAKE,KAAKE,MAAMJ,KAAK,CAACE,CAAD,GAAG,OAArO,EAA6OmD,EAAQ,cAAR,EAAuBjC,CAAvB,CAA7O,EAAuQA,CAA9Q;AAA8Q,GAA9S,CAAP;AAAqT,CAA9nZ;AAAA,IAAmoZ0J,KAAc,CAACrL,CAAD,EAAGC,CAAH,KAAOD,EAAE2G,IAAF,GAASS,KAAT,CAAe,KAAf,EAAsBC,GAAtB,CAA0BnH,KAAG2L,GAAa3L,CAAb,EAAeD,CAAf,CAA7B,EAAgDuH,IAAhD,CAAqD,GAArD,CAAxpZ;AAAA,IAAktZqE,KAAa,CAAC7L,CAAD,EAAGC,CAAH,KAAO;AAAC2D,IAAQ,OAAR,EAAgB5D,CAAhB,EAAkBC,CAAlB;AAAqB,MAAMC,IAAED,EAAEsG,KAAF,GAAQ2D,EAAKC,EAAI2B,UAAT,CAAR,GAA6B5B,EAAKC,EAAI4B,KAAT,CAArC;AAAA,MAAqDzL,IAAEL,EAAEuG,iBAAF,GAAoB,IAApB,GAAyB,EAAhF;AAAmF,SAAOxG,EAAEsK,OAAF,CAAUpK,CAAV,EAAY,CAACK,CAAD,EAAGE,CAAH,EAAKE,CAAL,EAAOe,CAAP,EAASC,CAAT,KAAa;AAAC,QAAIC,CAAJ;AAAM,WAAOgC,EAAQ,OAAR,EAAgB5D,CAAhB,EAAkBO,CAAlB,EAAoBE,CAApB,EAAsBE,CAAtB,EAAwBe,CAAxB,EAA0BC,CAA1B,GAA6B6J,EAAI/K,CAAJ,IAAOmB,IAAE,EAAT,GAAY4J,EAAI7K,CAAJ,IAAOiB,IAAE,KAAKnB,QAAQH,MAAM,CAACG,CAAD,GAAG,SAA/B,GAAyC+K,EAAI9J,CAAJ,IAAOE,IAAEnB,CAAM,KAAN,MAAQ,KAAKA,KAAKE,MAAML,MAAMG,KAAK,CAACE,CAAD,GAAG,OAAtC,GAA8C,KAAKF,KAAKE,MAAML,MAAM,CAACG,CAAD,GAAG,SAAhF,GAA0FkB,KAAGiC,EAAQ,iBAAR,EAA0BjC,CAA1B,GAA6BC,IAAEnB,CAAM,KAAN,MAAQE,CAAM,KAAN,MAAQ,KAAKF,KAAKE,KAAKe,KAAKC,MAAMlB,KAAKE,KAAK,CAACe,CAAD,GAAG,KAAzC,GAA+C,KAAKjB,KAAKE,KAAKe,KAAKC,MAAMlB,KAAK,CAACE,CAAD,GAAG,OAAzF,GAAiG,KAAKF,KAAKE,KAAKe,KAAKC,MAAM,CAAClB,CAAD,GAAG,SAAtK,KAAkLmD,EAAQ,OAAR,GAAiBhC,IAAQnB,MAAN,MAAcE,MAAN,MAAQ,KAAKF,KAAKE,KAAKe,IAAIpB,MAAMG,KAAKE,KAAK,CAACe,CAAD,GAAG,KAAxC,GAA8C,KAAKjB,KAAKE,KAAKe,IAAIpB,MAAMG,KAAK,CAACE,CAAD,GAAG,OAAvF,GAA+F,KAAKF,KAAKE,KAAKe,MAAM,CAACjB,CAAD,GAAG,SAAlU,CAA5K,EAAyfmD,EAAQ,cAAR,EAAuBhC,CAAvB,CAAzf,EAAmhBA,CAA1hB;AAA0hB,GAA1jB,CAAP;AAAikB,CAAh5a;AAAA,IAAq5a2J,KAAe,CAACvL,CAAD,EAAGC,CAAH,MAAQ2D,EAAQ,gBAAR,EAAyB5D,CAAzB,EAA2BC,CAA3B,GAA8BD,EAAEoH,KAAF,CAAQ,KAAR,EAAeC,GAAf,CAAmBnH,KAAG8L,GAAc9L,CAAd,EAAgBD,CAAhB,CAAtB,EAA0CuH,IAA1C,CAA+C,GAA/C,CAAtC,CAAp6a;AAAA,IAA+/awE,KAAc,CAAChM,CAAD,EAAGC,CAAH,KAAO;AAACD,MAAEA,EAAE2G,IAAF,EAAF;AAAW,MAAMzG,IAAED,EAAEsG,KAAF,GAAQ2D,EAAKC,EAAI8B,WAAT,CAAR,GAA8B/B,EAAKC,EAAI+B,MAAT,CAAtC;AAAuD,SAAOlM,EAAEsK,OAAF,CAAUpK,CAAV,EAAY,CAACI,CAAD,EAAGC,CAAH,EAAKE,CAAL,EAAOE,CAAP,EAASe,CAAT,EAAWC,CAAX,KAAe;AAACiC,MAAQ,QAAR,EAAiB5D,CAAjB,EAAmBM,CAAnB,EAAqBC,CAArB,EAAuBE,CAAvB,EAAyBE,CAAzB,EAA2Be,CAA3B,EAA6BC,CAA7B;AAAgC,QAAMC,IAAE4J,EAAI/K,CAAJ,CAAR;AAAA,QAAeqB,IAAEF,KAAG4J,EAAI7K,CAAJ,CAApB;AAAA,QAA2BoB,IAAED,KAAG0J,EAAI9J,CAAJ,CAAhC;AAAA,QAAuCQ,IAAEH,CAAzC;AAA2C,WAAYxB,MAAN,GAAM,IAAG2B,CAAH,KAAO3B,IAAE,EAAT,GAAaoB,IAAE1B,EAAEuG,iBAAF,GAAoB,IAApB,GAAyB,EAAxC,EAA2C5E,IAAEtB,IAAQC,MAAN,GAAM,IAAGA,CAAM,KAAN,GAAT,GAAiB,UAAjB,GAA4B,GAAhC,GAAoCA,KAAG2B,CAAH,IAAMJ,MAAInB,IAAE,CAAN,GAASe,IAAE,CAAX,EAAanB,CAAM,KAAN,GAAM,IAAGA,IAAE,IAAF,EAAOuB,KAAGrB,IAAE,CAACA,CAAD,GAAG,CAAL,EAAOE,IAAE,CAAT,EAAWe,IAAE,CAAhB,KAAoBf,IAAE,CAACA,CAAD,GAAG,CAAL,EAAOe,IAAE,CAA7B,CAAhB,IAAwDnB,MAAP,IAAO,KAAIA,IAAE,GAAF,EAAMuB,IAAErB,IAAE,CAACA,CAAD,GAAG,CAAP,GAASE,IAAE,CAACA,CAAD,GAAG,CAAxB,CAArE,EAAgGJ,CAAM,KAAN,GAAM,KAAIoB,IAAE,IAAN,CAAtG,EAAkHrB,IAAE,GAAGC,IAAEE,KAAKE,KAAKe,IAAIC,GAA7I,IAAkJG,IAAExB,IAAE,KAAKG,QAAQkB,MAAM,CAAClB,CAAD,GAAG,SAA1B,GAAoCsB,MAAIzB,IAAE,KAAKG,KAAKE,MAAMgB,MAAMlB,KAAK,CAACE,CAAD,GAAG,OAApC,CAArQ,EAAkTiD,EAAQ,eAAR,EAAwBtD,CAAxB,CAAlT,EAA6UA,CAAzV;AAAyV,GAAhc,CAAP;AAAuc,CAA9hc;AAAA,IAAmic8B,KAAa,CAACpC,CAAD,EAAGC,CAAH,MAAQ2D,EAAQ,cAAR,EAAuB5D,CAAvB,EAAyBC,CAAzB,GAA4BD,EAAE2G,IAAF,GAAS2D,OAAT,CAAiBJ,EAAKC,EAAIgC,IAAT,CAAjB,EAAgC,EAAhC,CAApC,CAAhjc;AAAA,IAAyncpB,KAAY,CAAC/K,CAAD,EAAGC,CAAH,MAAQ2D,EAAQ,aAAR,EAAsB5D,CAAtB,EAAwBC,CAAxB,GAA2BD,EAAE2G,IAAF,GAAS2D,OAAT,CAAiBJ,EAAKjK,EAAEuG,iBAAF,GAAoB2D,EAAIiC,OAAxB,GAAgCjC,EAAIkC,IAAzC,CAAjB,EAAgE,EAAhE,CAAnC,CAAroc;AAAA,IAA6uc9B,KAAcvK,KAAG,CAACC,CAAD,EAAGC,CAAH,EAAKI,CAAL,EAAOC,CAAP,EAASE,CAAT,EAAWE,CAAX,EAAae,CAAb,EAAeC,CAAf,EAAiBC,CAAjB,EAAmBE,CAAnB,EAAqBC,CAArB,EAAuBG,CAAvB,EAAyBC,CAAzB,KAA6B,GAAGjC,IAAEsL,EAAIlL,CAAJ,IAAO,EAAP,GAAUkL,EAAIjL,CAAJ,IAAO,KAAKD,QAAQN,IAAE,IAAF,GAAO,IAA3B,GAAgCwL,EAAI/K,CAAJ,IAAO,KAAKH,KAAKC,MAAMP,IAAE,IAAF,GAAO,IAA9B,GAAmCW,IAAE,KAAKT,GAAP,GAAW,KAAKA,IAAIF,IAAE,IAAF,GAAO,QAAQ2B,IAAE6J,EAAI5J,CAAJ,IAAO,EAAP,GAAU4J,EAAI1J,CAAJ,IAAO,IAAI,CAACF,CAAD,GAAG,SAAd,GAAwB4J,EAAIzJ,CAAJ,IAAO,IAAIH,KAAK,CAACE,CAAD,GAAG,OAAnB,GAA2BI,IAAE,KAAKN,KAAKE,KAAKC,KAAKG,GAAtB,GAA0BlC,IAAE,IAAI4B,KAAKE,KAAK,CAACC,CAAD,GAAG,KAAnB,GAAyB,KAAKJ,KAA5O,CAAkPgF,IAAlP,EAA3xc;AAAA,IAAohdwE,KAAQ,CAACnL,CAAD,EAAGC,CAAH,EAAKC,CAAL,KAAS;AAAC,WAAQI,IAAE,CAAV,EAAYA,IAAEN,EAAEsB,MAAhB,EAAuBhB,GAAvB,EAA2B,IAAG,CAACN,EAAEM,CAAF,EAAKmD,IAAL,CAAUxD,CAAV,CAAJ,EAAiB,OAAM,EAAN;;AAAS,MAAGA,EAAEkH,UAAF,CAAa7F,MAAb,IAAqB,CAACpB,EAAEsG,iBAA3B,EAA6C;AAAC,aAAQlG,IAAE,CAAV,EAAYA,IAAEN,EAAEsB,MAAhB,EAAuBhB,GAAvB,EAA2B,IAAGsD,EAAQ5D,EAAEM,CAAF,EAAKgJ,MAAb,GAAqBtJ,EAAEM,CAAF,EAAKgJ,MAAL,KAAcH,EAAWmD,GAAzB,IAA8BtM,EAAEM,CAAF,EAAKgJ,MAAL,CAAYnC,UAAZ,CAAuB7F,MAAvB,GAA8B,CAApF,EAAsF;AAAC,UAAMf,IAAEP,EAAEM,CAAF,EAAKgJ,MAAb;AAAoB,UAAG/I,EAAEyG,KAAF,KAAU/G,EAAE+G,KAAZ,IAAmBzG,EAAE0G,KAAF,KAAUhH,EAAEgH,KAA/B,IAAsC1G,EAAE2G,KAAF,KAAUjH,EAAEiH,KAArD,EAA2D,OAAM,EAAN;AAAS;;AAAA,WAAM,EAAN;AAAS;;AAAA,SAAM,EAAN;AAAM,CAAl2d;AAAA,IAAm3dqF,KAAU,CAACvM,CAAD,EAAGC,CAAH,EAAKC,CAAL,KAAS;AAAC,MAAG;AAACD,QAAE,IAAI4J,CAAJ,CAAU5J,CAAV,EAAYC,CAAZ,CAAF;AAAc,GAAlB,CAAkB,OAASI,CAAT,EAAG;AAAS,WAAM,EAAN;AAAS;;AAAA,SAAOL,EAAEwD,IAAF,CAAOzD,CAAP,CAAP;AAAc,CAA57d;;AAAg8d,IAA4B;AAACmD,cAAWqJ;AAAZ,IAAwBvJ,EAApD;AAAA,IAA8D;AAACc,MAAG0I,EAAJ;AAASzM,KAAE0M;AAAX,IAAgB7I,CAA9E;AAAA,IAAmF8I,KAAM,CAAC3M,CAAD,EAAGC,CAAH,KAAO;AAAC,MAAGA,KAAG,OAAiBA,CAAP,IAAV,QAAH,KAAwBA,IAAE;AAACsG,WAAM,CAAC,CAACtG,CAAT;AAAWuG,uBAAkB;AAA7B,GAA1B,GAA4DxG,aAAaqG,CAA5E,EAAmF,OAAOrG,CAAP;AAA8E,MAAlE,OAAiBA,CAAP,IAAV,YAAkCA,EAAEsB,MAAF,GAASkL,EAA3C,IAAqE,CAAE,GAAEjG,KAAF,GAAQkG,GAAKC,GAAI7F,KAAT,CAAR,GAAwB4F,GAAKC,GAAI5F,IAAT,CAAxB,EAAwCrD,IAAxC,CAA6CzD,CAA7C,CAAL,EAAqD,OAAO,IAAP;;AAAY,MAAG;AAAC,WAAO,IAAIqG,CAAJ,CAAWrG,CAAX,EAAaC,CAAb,CAAP;AAAoB,GAAxB,CAAwB,OAASC,CAAT,EAAG;AAAS,WAAO,IAAP;AAAO;AAAA,CAA9W;AAAA,IAAqX0M,KAAQD,EAA7X;AAAA,IAAmY;AAAC5I,MAAG8I,CAAJ;AAAO7M,KAAE8M;AAAT,IAAYjJ,CAA/Y;AAAA,IAAiakJ,KAAO,CAAC/M,CAAD,EAAGC,CAAH,KAAO;AAAC,MAAGD,aAAaqG,CAAhB,EAAuB,OAAOrG,CAAP;AAAS,MAAa,OAAOA,CAAP,IAAV,aAAqBA,IAAEgN,OAAOhN,CAAP,CAAvB,GAA4C,OAAOA,CAAP,IAAV,QAArC,EAAwD,OAAO,IAAP;AAAY,MAAIE,IAAE,IAAN;;AAAW,MAAI,KAAED,KAAG,EAAL,EAASgN,GAAb,EAAiB;AAAC,QAAI3M,CAAJ;;AAAM,WAAM,KAAEuM,EAAGC,EAAEI,SAAL,EAAgBC,IAAhB,CAAqBnN,CAArB,CAAF,MAA6B,CAACE,CAAD,IAAIA,EAAEkN,KAAF,GAAQlN,EAAE,CAAF,EAAKoB,MAAb,KAAsBtB,EAAEsB,MAAzD,CAAN,GAAwEpB,KAAGI,EAAE8M,KAAF,GAAQ9M,EAAE,CAAF,EAAKgB,MAAb,KAAsBpB,EAAEkN,KAAF,GAAQlN,EAAE,CAAF,EAAKoB,MAAtC,KAA+CpB,IAAEI,CAAjD,GAAoDuM,EAAGC,EAAEI,SAAL,EAAgBG,SAAhB,GAA0B/M,EAAE8M,KAAF,GAAQ9M,EAAE,CAAF,EAAKgB,MAAb,GAAoBhB,EAAE,CAAF,EAAKgB,MAAvG;;AAA8GuL,MAAGC,EAAEI,SAAL,EAAgBG,SAAhB,GAA0B,EAA1B;AAA0B,GAAxO,MAAgPnN,IAAEF,EAAE4G,KAAF,CAAQiG,EAAGC,EAAE1H,MAAL,CAAR,CAAF;;AAAwB,SAAclF,MAAP,IAAO,GAAE,IAAF,GAAO0M,GAAQ,GAAG1M,EAAE,CAAF,CAAE,IAAMA,EAAE,CAAF,KAAM,OAAOA,EAAE,CAAF,KAAM,KAAtC,EAA4CD,CAA5C,CAArB;AAAiE,CAAx2B;;ACdthe,YAAuBD,CAAvB,EAAkC;AAChC,SAAOgN,OAAOM,YAAP,CAAoBC,SAASvN,EAAEkB,KAAF,CAAQ,CAAR,CAAT,EAAqB,EAArB,CAApB,CAAP;AAGF;;AAAA,YAAuBlB,CAAvB,EAAkC;AAChC,SAAO,IAAI,KAAKA,EAAEwN,UAAF,CAAa,CAAb,EAAgB/F,QAAhB,CAAyB,EAAzB,CAAyB,EAA9B,CAAoCvG,KAApC,CAA0C,EAA1C,CAA0C,EAArD;AASF;;AAAA,YAAkBlB,CAAlB,EAAuC;AACrC,SAAOyN,KAAKC,mBAAmB1N,CAAnB,EAAwBsK,OAAxB,CAAgC,eAAhC,EAAiDqD,EAAjD,CAAL,CAAP;AASF;;AAAA,YAAkB3N,CAAlB,EAAuC;AACrC,SAAO4N,mBAAmBrM,MAAMsM,IAAN,CAAWC,KAAK9N,CAAL,CAAX,EAAsB+N,EAAtB,EAAqCvG,IAArC,CAA0C,EAA1C,CAAnB,CAAP;AAMK;;AAAA,WAAuBxH,CAAvB,EAA2C;AAChD,SAAOgO,GAASC,KAAKC,SAAL,CAAelO,CAAf,CAAT,CAAP;AAMK;;AAAA,YAAuBA,CAAvB,EAA+C;AACpD,SAAOiO,KAAK5E,KAAL,CAAWlJ,GAASH,CAAT,CAAX,CAAP;ACvCF;;AAAA;ACUA;;AAKA,WAAqBA,CAArB,EAAqD;AACnD,SAAO,OAAOA,CAAP,IAAiB,WAAxB;AAMF;;AAAA,YAAgBA,CAAhB,EAA2C;AACzC,SAAOA,MAAU,IAAjB;AAMF;;AAAA,YAAeA,CAAf,EAAsD;AACpD,SAAOmO,GAAOnO,CAAP,KAAiBoO,EAAYpO,CAAZ,CAAxB;AAMK;;AAAA,YAAiCA,CAAjC,EAAgG;AACrG,SAAIqO,GAAMrO,CAAN,IAAqB,EAArB,GAEF,CAACoO,EAAYpO,EAAMsO,OAAlB,CAAD,IAA+B,CAACF,EAAYpO,EAAMuO,EAAlB,CAAhC,IAAyD,CAACH,EAAYpO,EAAMwO,MAAlB,CAA1D,IAAuF,CAACJ,EAAYpO,EAAMyO,MAAlB,CAF1F;AASK;;AAAA,YAAkCzO,CAAlC,EAA+E;AACpF,SAAIqO,GAAMrO,CAAN,IAAqB,EAArB,GAEF,CAACoO,EAAYpO,EAAMsO,OAAlB,CAAD,IAA+B,CAACF,EAAYpO,EAAMuO,EAAlB,CAAhC,KAA0D,CAACH,EAAYpO,EAAM0O,MAAlB,CAAD,IAA8B,CAACN,EAAYpO,EAAM2D,KAAlB,CAAzF,CAFF;AASK;;AAAA,YAA8B3D,CAA9B,EAAwE;AAC7E,SAAIqO,GAAMrO,CAAN,IAAqB,EAArB,GACG,OAAOA,CAAP,IAAiB,QAAjB,IAA6BP,OAAOkP,MAAP,CAAcC,EAAd,EAAkCC,QAAlC,CAA2C7O,CAA3C,CADpC;AAOK;;AAAA,YAA4BA,CAA5B,EAAgE;AACrE,SAAIqO,GAAMrO,CAAN,IAAqB,EAArB,GACG,OAAOA,CAAP,IAAiB,QAAjB,IAA6BP,OAAOkP,MAAP,CAAcG,EAAd,EAA4BD,QAA5B,CAAqC7O,CAArC,CADpC;AAOK;;AAAA,YAAiBA,CAAjB,EAA2C;AAChD,MAAI,CAACA,CAAL,EAAY,OAAO,EAAP;;AAEZ,WAAWC,CAAX,IAAkBD,CAAlB,EAEE,IAAIP,OAAOE,cAAP,CAAsBsB,IAAtB,CAA2BjB,CAA3B,EAAkCC,CAAlC,CAAJ,EACE,OAAO,EAAP;;AAIJ,SAAO,EAAP;AC9DK;;AAAA,IAAM8O,IAAiC,EAAvC;;AAEA,YACL/O,CADK,EAELC,CAFK,EAGgB;AACrB,gBAAO+O,MAAP,CAAcD,CAAd,EAA8B9O,CAA9B,GACOD,CADP;AAIK;;AAAA,IAAMiP,KAAmB;AAC9B,eAAa,WADiB;AAE9B,6BAA2B;AAFG,CAAzB;AFlBA,sBAA4BjH,KAA5B,CAAkC;AAGvC1B,cAAmBrG,CAAnB,EAA8CC,CAA9C,EAAkE;AAChE,UAAM,qBAAqBD,MAASC,GAApC;AADiB;AAA2B;AAF9C,qBAAY8H,KAAZ;AAIEvI,WAAOyP,cAAP,CAAsB,IAAtB,EAA4BC,EAAczP,SAA1C;AAA0C;;AALL,CAAlC;AAAA,IAaA0P,kBAA4BpH,KAA5B,CAAkC;AAMvC1B,cAAYrG,CAAZ,EAA+C;AAC7C;AANF,qBAAY+H,KAAZ;AAQE,QAAM9H,IAAiB6C,OAAO9C,uBAAaoP,IAApB,CAAvB;AACA,SAAKC,UAAL,GAAkB,wBAAaC,OAAb,KAAwB,gBAA1C,EACA,KAAKF,IAAL,GAAYG,GAAmBtP,CAAnB,IAAqCA,CAArC,GAAsDuP,GAAaC,aAD/E,EAEA,KAAKH,OAAL,GAAe,qBAAqB,KAAKF,SAAS,KAAKC,YAFvD,EAIA7P,OAAOyP,cAAP,CAAsB,IAAtB,EAA4BE,EAAc1P,SAA1C,CAJA;AAI0C;;AAdL,CAblC;AAAA,IAoCAiQ,UAAsB;AAG3BrJ,cAAmBrG,CAAnB,EAAgDC,CAAhD,EAAoE;AAAjD;AAA6B;AAC9C,SAAKqP,OAAL,GAAe,uBAAuBtP,MAASC,GAA/C;AAMK;;AAAA0P,QAAM;AACXlM,YAAQmM,IAAR,CAAa,KAAKN,OAAlB;AAAkB;;AAXO,CApCtB;AAAA,IAwDAO,kBAA+C9H,KAA/C,CAAqD;AAG1D1B,cAAYrG,CAAZ,EAA2CC,CAA3C,EAAyEI,CAAzE,EAAoGC,CAApG,EAAiH;AAC/G,UAAM,0BAA0BN,EAAI8P,WAAW7P,MAASI,GAAxD;AADyC;AAA8B;AAA2B;AAFpG,qBAAY0H,KAAZ;AAIEvI,WAAOyP,cAAP,CAAsB,IAAtB,EAA4BY,EAAoBpQ,SAAhD;AAAgD;;AALQ,CAxDrD;AAAA,IAsEAqE,WAA4B;AAGjCuC,cAAYrG,CAAZ,EAA2CC,CAA3C,EAAyEI,CAAzE,EAA6F;AAAlD;AAA8B;AACvE,SAAKiP,OAAL,GAAe,4BAA4BtP,EAAI8P,WAAW7P,MAASI,GAAnE;AAMK;;AAAAsP,QAAM;AACXlM,YAAQmM,IAAR,CAAa,KAAKN,OAAlB;AAAkB;;AAXa,CAtE5B;;AAuFA,cAAoC;AACzC,SAAO,IAAIJ,CAAJ,CACLa,EAAaC,aADR,EAEL,iFAFK,CAAP;AAMK;;AAAA,cAAoC;AACzC,SAAO,IAAId,CAAJ,CAAkBa,EAAaE,aAA/B,EAA8C,qBAA9C,CAAP;AAGK;;AAAA,cAAwC;AAC7C,SAAO,IAAIf,CAAJ,CAAkBa,EAAaG,iBAA/B,EAAkD,8CAAlD,CAAP;AAGK;;AAAA,YAA4CnQ,CAA5C,EAA4D;AACjE,SAAO,IAAImP,CAAJ,CACLa,EAAaI,uBADR,EAEL,+EAA+EpQ,kDAAuDA,sCAFjI,CAAP;AAMK;;AAAA,YAA2CA,CAA3C,EAA4E;AACjF,MAAIC,IAAM,2CAA2C8O,EAAesB,WAAWtB,EAAetI,YAA9F;AAEA,WACGuD,MADH,CACU9J,CAAC,IAAQ,OAAOA,EAAIoQ,MAAX,IAAsB,WAAtB,IAAqCpQ,EAAIoQ,MAAJ,KAAe,IADvE,EAEGC,OAFH,CAEYrQ,KAAQ;AAChB,QAAMI,IAASJ,EAAIoQ,MAAJ,CAAYvB,EAAesB,OAA3B,CAAf;AAGA,WAAW/P,CAAP,IAAkB,QAAtB,GACEL,KAAO;AAAA,kBAAqBC,EAAI6P,gCAAgCzP,KADlE,GAEYA,MACVL,KAAO;AAAA,kBAAqBC,EAAI6P,2BAA2BhB,EAAeyB,wBADhE,CAFZ;AAG4E,GAThF,GAgBO,IAAIrB,CAAJ,CAAkBa,EAAaS,sBAA/B,EAAuDxQ,CAAvD,CAhBP;AAmBK;;AAAA,YAAoCD,CAApC,EAKJ;AAKD,MAAMC,IAAgBC,CAAC,IAAc;AACnC,QAAMI,IAAYJ,IAAI,CAAtB;AAAA,QACMK,IAAID,IAAY,EADtB;AAAA,QAEMG,IAAIH,IAAY,GAFtB;AAGA,WAAIC,MAAM,CAAN,IAAWE,MAAM,EAAjB,GAA4B,GAAGH,KAA/B,GACAC,MAAM,CAAN,IAAWE,MAAM,EAAjB,GAA4B,GAAGH,KAA/B,GACAC,MAAM,CAAN,IAAWE,MAAM,EAAjB,GAA4B,GAAGH,KAA/B,GACG,GAAGA,KAHV;AAGU,GAPZ;;AAUA,SAAO,IAAI6O,CAAJ,CACLa,EAAaU,eADR,EAEL,WAAWzQ,EAAcD,EAAQ2Q,QAAtB,CAAsB,wBAAiC3Q,EAAQ4Q;AAAA,gBACvD5Q,EAAQ6Q;AAAA,gBACR7Q,EAAQ8Q,YAJtB,CAAP;AAUK;;AAAA,cAAwC;AAC7C,SAAO,IAAInB,CAAJ,CAAoBoB,GAAeC,eAAnC,EAAoD,0BAApD,CAAP;AAGK;;AAAA,cAA8C;AACnD,SAAO,IAAIrB,CAAJ,CACLoB,GAAeE,cADV,EAEL,2IAFK,CAAP;AAMK;;AAAA,cAAyD;AAC9D,SAAO,IAAItB,CAAJ,CACLoB,GAAeG,gCADV,EAEL,yMAAyMnC,EAAeoC,8HAFnN,CAAP;AAMK;;AAAA,YAAkCnR,CAAlC,EAIJ;AACD,MAAM;AAAEwO,aAAF;AAAU4C,sBAAV;AAA2BC;AAA3B,MAA0CrR,CAAhD;AAAA,MAEMO,IAAiBL,EAAgB6O,EAAesB,OAA/B,CAFvB;AAAA,MAGM5P,IAAmBH,IAAa,UAAUA,cAAvB,GAAiD,EAH1E;AAAA,MAIMK,IAAU,KAAKV,8BAAmC8O,EAAesB,0BAA0B9P,OAAoBE,GAJrH;AAMA,SAAO,IAAIkP,CAAJ,CAAoBoB,GAAeO,iBAAnC,EAAsD3Q,CAAtD,CAAP;AG1MF;;AAAA;ACAA;;ACAA,eAAgE;AAC9D,MAAIX,IAAQ,CAAZ;;AAEA,WAEEA,CAAI,GAAQ+C,OAAOC,gBAAf,GAAiC,MAAM,EAAEhD,CAA7C,GACKA,IAAQ,CADT;AAKR;;AAAA,IAAMuR,KAAeC,IAArB;;AAKO,cAAgC;AACrC,SAAOD,GAAaE,IAAb,GAAoBrI,KAA3B;ACVF;;AAAA,IAAMsI,KAA4BxI,OAAO,oCAAP,CAAlC;;AAOA,YAA6ElJ,CAA7E,EAA4F;AAC1F,gBAAO2R,cAAP,CAAsB3R,CAAtB,EAA+B0R,EAA/B,EAA0D;AACxDtI,WAAO,EADiD;AAExDwI,gBAAY;AAF4C,GAA1D,GAKO5R,CALP;AAYF;;AAAA,YAAyEA,CAAzE,EAAqF;AACnF,SAAO,CAAC,CAAEA,EAAgB0R,EAAhB,CAAV;AAWK;;AAAA,WAA0C1R,CAA1C,EAAmF;AAtC1F;AAuCE,SAAK6R,GAAsB7R,CAAtB,MACHA,EAAQsO,OAAR,GAAkB,OAAQA,OAAR,gBAAmB,KAArC,EACAtO,EAAQuO,EAAR,GAAauD,IADb,EAEA9R,EAAQwO,MAAR,GAAiB,OAAQA,MAAR,gBAAkB,MAFnC,EAGAxO,EAAQyO,MAAR,GAAiB,OAAQA,MAAR,gBAAkB,EAHnC,EAKAsD,GAA0B/R,CAA1B,CANG,GAUEA,CAVP;AAgBK;;AAAA,WAAqCA,CAArC,EAAgG;AAAA,MAA3CC,CAA2C,uEAA3B,EAA2B;AACrG,SAAO8R,GAA0B;AAC/BtD,aAD+B;AAE/BD,aAF+B;AAG/BF,aAAS,KAHsB;AAI/BC,QAAIuD;AAJ2B,GAA1B,CAAP;AAYK;;AAAA,cAAwC;AAS7CxL,cAAYrG,CAAZ,EAA6G;AAC3GA,KAAI,YAA6B+R,CAAjC,IACE,KAAKC,QAAL,GAAgBhS,EAAkBiS,OAAlB,CAA0B5D,OAA1C,EACA,KAAK6D,GAAL,GAAWlS,EAAkBiS,OAAlB,CAA0B3D,EADrC,EAEA,KAAK6D,OAAL,GAAenS,EAAkBiS,OAAlB,CAA0BxD,MAFzC,EAGA,KAAK2D,MAAL,GAAcpS,EAAkBiS,OAAlB,CAA0BvO,KAJ1C,IAKO2O,EAAI,CAAyBrS,CAAzB,CAAJ,IACL,KAAKgS,QAAL,GAAgBhS,EAAkBqO,OAAlC,EACA,KAAK6D,GAAL,GAAWlS,EAAkBsO,EAD7B,EAEA,KAAK6D,OAAL,GAAenS,EAAkByO,MAFjC,EAGA,KAAK2D,MAAL,GAAcpS,EAAkB0D,KAJ3B,KAML,KAAKsO,QAAL,GAAgBhS,EAAkBqO,OAAlC,EACA,KAAK6D,GAAL,GAAWlS,EAAkBsO,EAD7B,EAEA,KAAK6D,OAAL,GAAe,MAFf,EAGA,KAAKC,MAAL,GAAc,MATL,CALP;AAkBC;;AAAAE,aAAWtS,CAAX,EAAwC;AAC7C,gBAAKoS,MAAL,GAAcpS,CAAd,EACO,IADP;AAIK;;AAAAuS,cAAYvS,CAAZ,EAAwC;AAC7C,gBAAKmS,OAAL,GAAenS,CAAf,EACO,IADP;AACO;;AAGE,iBAAW;AACpB,WAAO,OAAO,KAAKoS,MAAZ,IAAuB,WAAvB,IAAsC,KAAKA,MAAL,KAAgB,IAA7D;AAA6D;;AAGpD,kBAAY;AACrB,WAAO,OAAO,KAAKD,OAAZ,IAAwB,WAA/B;AAA+B;;AAGtB,gBAAkC;AAC3C,WAAO;AACL9D,eAAS,KAAK2D,QADT;AAEL1D,UAAI,KAAK4D,GAFJ;AAGLzD,cAAQ,KAAK0D,OAHR;AAILzO,aAAO,KAAK0O;AAJP,KAAP;AAIc;;AAnD6B,CAAxC;ACpEP,SAAyBI,QAAzB;AAAA,IAQOC,mBAAmEC,UAAnE,CAEL,EAVF;;AAqBO,cAAsE;AAC3E,MAAM3S,IAAU,IAAI0S,EAAJ,EAAhB;AAkBA,SAAO;AACLE,cADK;AAELC,iCAlBkC,CAClCvS,CADkC,EAElCC,CAFkC,KAI3B;AAAA,yCAAIE,CAAJ;AAAIA,SAAJ;AAAA;;AAAA,aACJT,EAAgBM,CAAhB,EAAwB2B,KAAxB,CAA8BjC,CAA9B,EAAuCS,CAAvC,GACMF,CAFF;AAAA,KAYF;AAGLuS,8BAT8DxS,KACvD;AAAA,yCAAIC,CAAJ;AAAIA,SAAJ;AAAA;;AAAA,aACGP,EAAgBM,CAAhB,EAAwB2B,KAAxB,CAA8BjC,CAA9B,EAAuCO,CAAvC,CADH;AAAA;AAKF,GAAP;ACEF;;AAAA,IAAMwS,KAAkB7J,OAAO,cAAP,CAAxB;;AAKO,YAAsBlJ,CAAtB,EAA4D;AACjE,SAAO,CAAC,CAACA,EAAM+S,EAAN,CAAT;AAOK;;AAAA,YACL/S,CADK,EAEkG;AACvG,MAAMC,IAAU+S,GAAchT,CAAd,CAAhB;AAAA,MACM;AAAE8S,+BAAF;AAA4BD;AAA5B,MAA4DI,IADlE;AAAA,MAOM1S,IAAa2I,OAAO,cAAP,CAPnB;AAAA,MAQMzI,IAAcyI,OAAO,eAAP,CARpB;AAAA,MASMvI,IAAgBuI,OAAO,iBAAP,CATtB;AAAA,MAeMxH,IACJ,CAACI,CAAD,EAAwEC,CAAxE,KACA,YAAoB;AAAA,uCAAhBG,CAAgB;AAAhBA,OAAgB;AAAA;;AAClB,QAAMC,IAAeJ,EAAeD,CAAf,EAAuBG,KAAvB,CAA6BF,CAA7B,EAAqCG,CAArC,CAArB;AACA,WAAOP,EAAWQ,CAAX,CAAP;AAAkB,GAnBtB;AAAA,MA0BMR,IAAcG,KACXrC,OAAOuP,MAAP,CAAclN,CAAd,EAAsB;AAAA,KAC1BiR,EAD0B,GACR,EADQ;AACR,KAElBxS,CAFkB,GAELuB,EAAOvB,CAAP,KAAsBuB,EAAOoR,IAHhB;AAGgB,KAC1CzS,CAD0C,GAC5BqB,EAAOrB,CAAP,KAAuBqB,EAAOqR,KAJlB;AAIkB,KAC5CxS,CAD4C,GAC5BmB,EAAOnB,CAAP,KAAyBmB,EAAOsR,OALtB;AAO3BF,UAAMxR,EAA4BnB,CAA5B,EAAwCuB,CAAxC,CAPqB;AAQ3BqR,WAAOzR,EAA4BjB,CAA5B,EAAyCqB,CAAzC,CARoB;AAS3BsR,aAAS1R,EAA4Bf,CAA5B,EAA2CmB,CAA3C,CATkB;AAW3BM,QAAI9B,EAA4B,IAA5B,EAAkCwB,CAAlC,CAXuB;AAY3BzB,UAAMC,EAA4B,MAA5B,EAAoCwB,CAApC,CAZqB;AAa3BW,iBAAanC,EAA4B,aAA5B,EAA2CwB,CAA3C,CAbc;AAe3BU,SAAKlC,EAA4B,KAA5B,EAAmCwB,CAAnC,CAfsB;AAgB3BE,oBAAgB1B,EAA4B,gBAA5B,EAA8CwB,CAA9C,CAhBW;AAiB3BS,wBAAoBjC,EAA4B,oBAA5B,EAAkDwB,CAAlD,CAjBO;AAmB3BL,UAAMvB,EAAyB,MAAzB,CAnBqB;AAoB3Bc,gBAAYd,EAAyB,YAAzB,CApBe;AAqB3BmB,eAAWnB,EAAyB,WAAzB,CArBgB;AAsB3BsB,mBAAetB,EAAyB,eAAzB;AAtBY,GAAtB,CA3BT;AAAA,MAqDM0B,IAASD,EACb1B,EAAQiT,IAAR,CACEpR,CAAC,KAECF,EAAOH,IAAP,CAAY,MAAZ,EAAoBK,CAApB,GACAF,EAAOH,IAAP,CAAY,SAAZ,CADA,EAEOK,CAJR,CADH,EAQGA,KAAQ;AAEP,YAAOL,IAAP,CAAY,OAAZ,EAAqBK,CAArB,GACAF,EAAOH,IAAP,CAAY,SAAZ,CADA,EAEMK,CAFN;AAEM,GAZV,CADa,CArDf;;AAuEA,SAAOF,CAAP;AAYK;;AAAA,YAAgC5B,CAAhC,EAAyE;AAC9E,SAAO,IAAIqT,OAAJ,CAAqB,CAACpT,CAAD,EAAUC,CAAV,KAAqB;AAC/C,QAAMI,IAASN,EAASC,CAAT,EAAkBC,CAAlB,CAAf;AACAmT,YAAQC,OAAR,CAAgBhT,CAAhB,EAAwB6S,KAAxB,CAA8BjT,CAA9B;AAA8B,GAFzB,CAAP;AJtIK;;AAAA,cAAiB;AACtBoG,cAAsBrG,CAAtB,EAAoC;AAAd;AAAA;;AAKR,gBAA0B;AACtC,WAAQ,KAAKsT,GAAL,CAAiBC,OAAzB;AAMQ;;AAAAC,UAAkExT,CAAlE,EAA2G;AACnH,QAAMC,IAAkB,KAAKsT,OAAL,CAAaE,IAAb,CACtBC,GAA2BC,oBADL,EAEtBC,EAAiC5T,CAAjC,CAFsB,CAAxB;AAAA,QAMMK,IAAawT,GAAqC,CAACrT,CAAD,EAAUE,CAAV,KAAqB;AAC3ET,QACGgT,IADH,CACQxR,CAAC,IAAQ;AAEb,YADAnB,KACImB,EAAIqS,QAAR,EAAkBpT,EAAO,IAAIyO,CAAJ,CAAkB1N,EAAIwQ,OAAJ,CAAYvO,KAA9B,CAAP,EAAlB,KAAuD,IAC9CjC,EAAIsS,SAD0C,EAC/BvT,EAAQiB,EAAIwQ,OAAJ,CAAYxD,MAApB,EAD+B,KAElD,MAAMuF,IAAN;AAAM,OALf,EAOGd,KAPH,CAOSzR,CAAC,IAAQ;AACdnB,aACAI,EAAOe,CAAP,CADA;AACO,OATX;AASW,KAVM,CANnB;AAAA,QAsBMnB,IAAgB,KAAKiT,OAAL,CAAapR,EAAb,CAAgB8R,GAA2BC,kBAA3C,EAA+D1T,CAAC,IAAQ;AA5ClG;AA6CM,UAAM;AAAE2T;AAAF,UAAe3T,EAAI4T,IAAzB;;AAEA,UAAI1T,EAAS4N,EAAT,KAAgBtO,EAAQsO,EAAxB,KAA8B,OAASG,MAAT,uBAAiB4F,KAA/C,CAAJ,EAA0D;AACxD,YAAM;AAAEA,kBAAF;AAAS7F,sBAAS;AAAlB,YAAyB9N,EAAS+N,MAAxC;AACApO,UAAWmB,IAAX,CAAgBE,CAAhB,EAAuB,GAAGC,CAA1B;AAA0B;AAAA,KALR,CAtBtB;AA+BA,WAAOtB,CAAP;AAAO;;AA7Ca,CAAjB;ADGA,uBAAyBiU,CAAzB,CAAoC;AAMlCC,qBAAmBvU,CAAnB,EAAmE;AACxE,QAAM;AAAEwU,cAAF;AAASC,kBAAS,EAAlB;AAAwBC;AAAxB,QAAwC1U,CAA9C;AAAA,QAEMQ,IAAiBmU,EACrB,KAAKrB,GAAL,CAASsB,QAAT,GAAoBC,EAAmBC,0BAAvC,GAAoED,EAAmBE,kBADlE,EAErB,CAAC;AAAEP,cAAF;AAASC,eAAT;AAAiBC;AAAjB,KAAD,CAFqB,CAFvB;AAMA,WAAO,KAAKlB,OAAL,CAAsDhT,CAAtD,CAAP;AAQK;;AAAAwU,eAAahV,CAAb,EAAuD;AAC5D,QAAM;AAAEiV;AAAF,QAAkBjV,CAAxB;AAAA,QACMK,IAAiBsU,EACrB,KAAKrB,GAAL,CAASsB,QAAT,GAAoBC,EAAmBK,oBAAvC,GAA8DL,EAAmBM,YAD5D,EAErB,CAAC;AAAEF,oBAAF;AAAeR,cAAQ;AAAvB,KAAD,CAFqB,CADvB;AAKA,WAAO,KAAKjB,OAAL,CAA4BnT,CAA5B,CAAP;AAaK;;AAAA+U,sBAAoBpV,CAApB,EAAsD;AAC3D,QAAIC,IAAqBD,gBAA2B,EAApD;;AAEA,QAAI,CAACA,CAAD,IAA4B8O,EAAeyB,QAAf,KAA4B,KAA5D,EAAmE;AACjEtQ,UAAqBoV,OAAOC,QAAP,CAAgBC,MAArC;AAGA,UAAMjV,IAAkB+U,OAAOC,QAAP,CAAgBE,MAAhB,GAAyBH,OAAOC,QAAP,CAAgBG,QAAjE;AACAJ,aAAOK,OAAP,CAAeC,YAAf,CAA4B,IAA5B,EAAkC,EAAlC,EAAsCrV,CAAtC;AAGF;;AAAA,QAAMD,IAAiBsU,EACrB,KAAKrB,GAAL,CAASsB,QAAT,GAAoBC,EAAmBe,2BAAvC,GAAqEf,EAAmBgB,mBADnE,EAErB,CAAC5V,CAAD,CAFqB,CAAvB;AAKA,WAAO,KAAKuT,OAAL,CAA4BnT,CAA5B,CAAP;AAAmC;;AAxDI,CAApC;AMXP;ACAA;AAAAyV;AAAAC;AAAAC;AAAAC;AAAAC;AAAAC;AAAA9U;AAAA+U;AAAAC;AAAA;AAEA,IAAIC,EAAJ;;AAKA,WAA4EvW,CAA5E,EAAmH;AAAA;;AACjH,SAAO;AAAA,uCAAUC,CAAV;AAAUA,OAAV;AAAA;;AAAA,WAA0BuW;AAE/B,aAAKD,OAAIA,KAAK,MAAMxH,EAAe0H,gBAAf,EAAf,GACL,MAAMF,GAAGG,KAAH,EADD,EAEGH,GAAGvW,CAAH,EAAmB,GAAGC,CAAtB,CAFR;AAE8B,KAJC,CAA1B;AAAA,GAAP;AAQK;;AAAA,IAAM0W,IAAUC,EAAuB,SAAvB,CAAhB;AAAA,IACMC,IAAUD,EAAuB,SAAvB,CADhB;AAAA,IAEME,KAAaF,EAAuB,YAAvB,CAFnB;AAAA,IAGMG,KAAQH,EAAuB,OAAvB,CAHd;AAAA,IAIMI,KAASJ,EAAuB,QAAvB,CAJf;AAAA,IAKMK,KAAML,EAAuB,KAAvB,CALZ;AAAA,IAMMM,KAAON,EAAuB,MAAvB,CANb;AAAA,IAOMO,KAAUP,EAAuB,SAAvB,CAPhB;;ACfA,cAAgB;AACrB,MAAM5W,IAAIsV,OAAO8B,MAAP,CAAcC,eAAd,CAA8B,IAAIC,UAAJ,CAAe,EAAf,CAA9B,CAAV;AAGAtX,IAAE,CAAF,IAAQA,EAAE,CAAF,IAAO,EAAP,GAAe,EAAvB,EAIAA,EAAE,CAAF,IAAQA,EAAE,CAAF,IAAO,GAAP,GAAe,GAJvB;AAOA,MAAIC,IAAM,EAAV;AACA,cAAOD,EAAE,CAAF,EAAKyH,QAAL,CAAc,EAAd,CAAP,EACAxH,KAAOD,EAAE,CAAF,EAAKyH,QAAL,CAAc,EAAd,CADP,EAEAxH,KAAOD,EAAE,CAAF,EAAKyH,QAAL,CAAc,EAAd,CAFP,EAGAxH,KAAOD,EAAE,CAAF,EAAKyH,QAAL,CAAc,EAAd,CAHP,EAIAxH,KAAO,GAJP,EAMAA,KAAOD,EAAE,CAAF,EAAKyH,QAAL,CAAc,EAAd,CANP,EAOAxH,KAAOD,EAAE,CAAF,EAAKyH,QAAL,CAAc,EAAd,CAPP,EAQAxH,KAAO,GARP,EAUAA,KAAOD,EAAE,CAAF,EAAKyH,QAAL,CAAc,EAAd,CAVP,EAWAxH,KAAOD,EAAE,CAAF,EAAKyH,QAAL,CAAc,EAAd,CAXP,EAYAxH,KAAO,GAZP,EAcAA,KAAOD,EAAE,CAAF,EAAKyH,QAAL,CAAc,EAAd,CAdP,EAeAxH,KAAOD,EAAE,CAAF,EAAKyH,QAAL,CAAc,EAAd,CAfP,EAgBAxH,KAAO,GAhBP,EAkBAA,KAAOD,EAAE,EAAF,EAAMyH,QAAN,CAAe,EAAf,CAlBP,EAmBAxH,KAAOD,EAAE,EAAF,EAAMyH,QAAN,CAAe,EAAf,CAnBP,EAoBAxH,KAAOD,EAAE,EAAF,EAAMyH,QAAN,CAAe,EAAf,CApBP,EAqBAxH,KAAOD,EAAE,EAAF,EAAMyH,QAAN,CAAe,EAAf,CArBP,EAsBAxH,KAAOD,EAAE,EAAF,EAAMyH,QAAN,CAAe,EAAf,CAtBP,EAuBAxH,KAAOD,EAAE,EAAF,EAAMyH,QAAN,CAAe,EAAf,CAvBP,EAyBOxH,CAzBP;ACVK;;AAAA,IAAMsX,KAAwB,uBAA9B;AAAA,IACMC,KAAuB,sBAD7B;AAAA,IAEDC,KAAY,OAFX;AAAA,IAGDC,KAAa,OAHZ;AAAA,IAKDC,KAAgC;AACpC5H,QAAM0H,EAD8B;AAEpCG,cAAYF;AAFwB,CAL/B;AAAA,IASDG,KAAsC;AAC1C9H,QAAM0H,EADoC;AAE1CG,cAAYF;AAF8B,CATrC;;AAcA,cAAqB;AAC1BZ,KAAWU,EAAX,GACAV,GAAWS,EAAX,CADA;AAIF;;AAAA,cAAkC;AAAA;AAEhC,QAAMvX,IAAY,MAAM8X,IAAxB;;AAEA,QAAI,CAAC9X,CAAL,EAAgB;AACd0D,cAAQqU,IAAR,CAAa,yDAAb;AACA;AAGF;;AAAA,QAAM;AAAEC;AAAF,QAAa1C,OAAO8B,MAA1B;AAAA,QACMlX,IAAa,MAAMyW,EAAmBY,EAAnB,CADzB;;AAGA,QAAI,CAACrX,CAAD,IAAe,CAACD,CAApB,EAA4B;AAC1ByD,cAAQqU,IAAR,CAAa,qDAAb;AACA;AAGF;;AAAA,QAAMzX,IAAS;AACb2X,WAAKC,KAAKC,KAAL,CAAW,IAAIC,IAAJ,GAAWC,OAAX,KAAuB,GAAlC,CADQ;AAEbC,WAAKC;AAFQ,KAAf;AAAA,QAKMhY,IAAU;AACdiY,WAAK,UADS;AAEdC,WAAK,OAFS;AAGdC,WAAK1Y;AAHS,KALhB;AAAA,QAWMS,IAAM;AACVkY,iBAAWC,GAAe3K,KAAKC,SAAL,CAAe3N,CAAf,CAAf,CADD;AAEVsY,cAAQD,GAAe3K,KAAKC,SAAL,CAAe5N,CAAf,CAAf;AAFE,KAXZ;AAAA,QAgBMK,IAAOmY,GAAW,GAAGrY,EAAIkY,aAAalY,EAAIoY,QAAnC,CAhBb;AAAA,QAiBMnX,IAAU;AAAEqO,YAAM0H,EAAR;AAAmBsB,YAAM;AAAEhJ,cAAM;AAAR;AAAzB,KAjBhB;AAAA,QAmBMpO,IAAMqX,GAAiB,IAAI1B,UAAJ,CAAe,MAAMrX,EAAOgZ,IAAP,CAAYvX,CAAZ,EAAqBxB,CAArB,EAAiCS,CAAjC,CAArB,CAAjB,CAnBZ;AAoBA,WAAO,GAAGF,EAAIkY,aAAalY,EAAIoY,UAAUlX,GAAzC;AAAyC,GArCT;AAwClC;;AAAA,cAA8B;AAAA;AAC5B,QAAI,CAACuX,IAAL,EAA6B;AAC3BxV,cAAQqU,IAAR,CAAa,4BAAb;AACA;AAGF;;AAAA,WAAM,OAAMpB,EAAQa,EAAR,CAAN,MACJ,MAAM2B,IADF,GAICxC,EAAQa,EAAR,CAJP;AAIe,GAVa;AAa9B;;AAAA,cAA8B;AAAA;AAG5B,QAAIxX,IAAe,IAAnB;AAAA,QACM;AAAEgY;AAAF,QAAa1C,OAAO8B,MAD1B;AAAA,QAEMlX,IAAK,MAAMD,EAAOmZ,WAAP,CACfzB,EADe,EAEf,EAFe,EAGf,CAAC,MAAD,CAHe,CAFjB;AAAA,QASMrX,IAAgB,MAAML,EAAOoZ,SAAP,CAAiB,KAAjB,EAAwBnZ,EAAGoZ,UAA3B,CAT5B;AAUAtZ,QAAe,MAAMC,EAAOoZ,SAAP,CAAiB,KAAjB,EAAwBnZ,EAAGqZ,SAA3B,CAArB;AAGA,QAAMhZ,IAAsB,MAAMN,EAAOuZ,SAAP,CAAiB,KAAjB,EAAwBlZ,CAAxB,EAAuCuX,EAAvC,EAAyD,EAAzD,EAAgE,CAAC,MAAD,CAAhE,CAAlC;AAGA,UAAMhB,EAAQU,EAAR,EAA+BhX,CAA/B,CAAN,EAEA,MAAMsW,EAAQW,EAAR,EAA8BxX,CAA9B,CAFN;AAEoC,GArBR;AAwB9B;;AAAA,cAAgC;AAC9B,MAAMA,IAAY,OAAOsV,MAAP,IAAkB,WAAlB,IAAiC,CAAC,CAAEA,OAAO8B,MAA7D;AAAA,MACMnX,IAAkBD,KAAa,CAAC,CAAEsV,OAAO8B,MAAP,CAAcY,MADtD;AAGA,SAAOhY,KAAaC,CAApB;AAGF;;AAAA,YAAwBD,CAAxB,EAAqC;AACnC,SAAOyZ,GAAeC,GAAmB1Z,CAAnB,CAAf,CAAP;AAGF;;AAAA,YAAoBA,CAApB,EAAiC;AAC/B,SAAO,IAAI2Z,WAAJ,GAAkBC,MAAlB,CAAyB5Z,CAAzB,CAAP;AAGF;;AAAA,YAAwBA,CAAxB,EAAqC;AACnC,SAAOyN,KAAKzN,CAAL,EAAUsK,OAAV,CAAkB,KAAlB,EAAyB,GAAzB,EAA8BA,OAA9B,CAAsC,KAAtC,EAA6C,GAA7C,EAAkDA,OAAlD,CAA0D,KAA1D,EAAiE,EAAjE,CAAP;AAGF;;AAAA,YAA4BtK,CAA5B,EAAyC;AAIvC,SAHe0N,mBAAmB1N,CAAnB,EAGDsK,OAHC,CAGO,iBAHP,EAG0B,CAACpK,CAAD,EAAII,CAAJ,KAAW0M,OAAOM,YAAP,CAAoBC,SAASjN,CAAT,EAAa,EAAb,CAApB,CAHrC,CAGf;AAGF;;AAAA,YAA0BN,CAA1B,EAA6C;AAC3C,MAAIC,IAAM,EAAV;AACA,WAAMsQ,OAAN,CAAerQ,KAAS;AACtBD,SAAO+M,OAAOM,YAAP,CAAoBpN,CAApB,CAAP;AAA2B,GAD7B,GAGOuZ,GAAexZ,CAAf,CAHP;AH5GK;;AAAA,uBAAyBsU,CAAzB,CAAoC;AAElCsF,aAAW5Z,CAAX,EAAoD;AACzD,QAAMC,IAAiB0U,EACrB,KAAKrB,GAAL,CAASsB,QAAT,GAAoBiF,EAAmBC,kBAAvC,GAA4DD,EAAmBE,UAD1D,EAErB,CAAC/Z,CAAD,CAFqB,CAAvB;AAIA,WAAO,KAAKwT,OAAL,CAAqBvT,CAArB,CAAP;AAIK;;AAAA+Z,kBAAgBha,CAAhB,EAA8D;AACnE,QAAMC,IAAiB0U,EACrB,KAAKrB,GAAL,CAASsB,QAAT,GAAoBiF,EAAmBI,uBAAvC,GAAiEJ,EAAmBK,eAD/D,EAErB,CAACla,CAAD,CAFqB,CAAvB;AAIA,WAAO,KAAKwT,OAAL,CAAqBvT,CAArB,CAAP;AAIK;;AAAAka,gBAAc;AACnB,QAAMna,IAAiB2U,EACrB,KAAKrB,GAAL,CAASsB,QAAT,GAAoBiF,EAAmBO,mBAAvC,GAA6DP,EAAmBQ,WAD3D,CAAvB;AAGA,WAAO,KAAK7G,OAAL,CAAgCxT,CAAhC,CAAP;AAIK;;AAAAsa,cAAYta,CAAZ,EAAqD;AAC1D,QAAM;AAAEwU,cAAF;AAASC,kBAAS;AAAlB,QAA2BzU,CAAjC;AAAA,QACMM,IAAiBqU,EACrB,KAAKrB,GAAL,CAASsB,QAAT,GAAoBiF,EAAmBU,mBAAvC,GAA6DV,EAAmBW,WAD3D,EAErB,CAAC;AAAEhG,cAAF;AAASC;AAAT,KAAD,CAFqB,CADvB;AAKA,WAAO,KAAKjB,OAAL,CAA+ClT,CAA/C,CAAP;AAIK;;AAAAma,eAAa;AAClB,QAAMza,IAAiB2U,EACrB,KAAKrB,GAAL,CAASsB,QAAT,GAAoBiF,EAAmBa,kBAAvC,GAA4Db,EAAmBc,UAD1D,CAAvB;AAGA,WAAO,KAAKnH,OAAL,CAAsBxT,CAAtB,CAAP;AAIK;;AAAA4a,WAAS;AACdC;AACA,QAAM7a,IAAiB2U,EACrB,KAAKrB,GAAL,CAASsB,QAAT,GAAoBiF,EAAmBiB,cAAvC,GAAwDjB,EAAmBkB,MADtD,CAAvB;AAGA,WAAO,KAAKvH,OAAL,CAAsBxT,CAAtB,CAAP;AAIK;;AAAAgb,iBAAe;AACpB,QAAMhb,IAAiB2U,EACrB,KAAKrB,GAAL,CAASsB,QAAT,GAAoBiF,EAAmBoB,oBAAvC,GAA8DpB,EAAmBqB,YAD5D,CAAvB;AAGA,WAAO,KAAK1H,OAAL,CAAgCxT,CAAhC,CAAP;AAAuC;;AA3DA,CAApC;AIjBP;AAaA,IAAM;AAAE6S,8BAAF;AAA4BD;AAA5B,IAA4DI,IAAlE;AAAA,IAGOmI,mBAAgC7G,CAAhC,CAAmE;AAAnEjO,gBAlBP;AAkBO;AAIW,mBAAU,EAAV;AA2HT,cAAK+U,EAA4B,IAA5B,EAAkC,IAAlC,CAAL;AACA,gBAAOA,EAA4B,MAA5B,EAAoC,IAApC,CAAP;AACA,uBAAcA,EAA4B,aAA5B,EAA2C,IAA3C,CAAd;AAEA,eAAMA,EAA4B,KAA5B,EAAmC,IAAnC,CAAN;AACA,0BAAiBA,EAA4B,gBAA5B,EAA8C,IAA9C,CAAjB;AACA,8BAAqBA,EAA4B,oBAA5B,EAAkD,IAAlD,CAArB;AAEA,gBAAOC,GAAyB,MAAzB,CAAP;AACA,sBAAaA,GAAyB,YAAzB,CAAb;AACA,qBAAYA,GAAyB,WAAzB,CAAZ;AACA,yBAAgBA,GAAyB,eAAzB,CAAhB;AA5HA;;AAAAC,YACLtb,CADK,EAELC,CAFK,EAGC;AACN,QAAI,CAACA,CAAL,EACE,MAAMsb,GAA2B;AAC/B5K,iBAAW,6BADoB;AAE/BD,gBAAU,CAFqB;AAG/BE,gBAAU,UAHqB;AAI/BC,gBAAU5Q,MAAsB,IAAtB,GAA6B,MAA7B,GAAsC,OAAOA;AAJxB,KAA3B,CAAN;AAQF,QAAIqB,MAAMka,OAAN,CAAcxb,CAAd,CAAJ,EACE,KAAKuT,OAAL,CACGE,IADH,CAEIgI,GAA2B9H,oBAF/B,EAGI3T,EAAQoH,GAAR,CAAY/G,CAAC,IAAM;AACjB,UAAMC,IAAsBsT,EAAiCvT,CAAjC,CAA5B;AACA,kBAAKqb,8BAAL,CAAoCpb,CAApC,GACOA,CADP;AACO,KAHT,CAHJ,EASG2S,IATH,CASS5S,KAAkB;AACtBJ,QACC,IADD,EAECI,EAAc+G,GAAd,CAAkB9G,CAAC,IAAcqb,UAC5Brb,EAAS2R,OADmB;AAE/BvO,eAAOpD,EAASwT,QAAT,GAAoB,IAAI3E,CAAJ,CAAkB7O,EAAS2R,OAAT,CAAiBvO,KAAnC,CAApB,GAAgE;AAFxC,QAAjC,CAFD,CAAD;AAI2E,KAd/E,EADF,KAmBO;AACL,UAAMrD,IAAeuT,EAAiC5T,CAAjC,CAArB;AACA,WAAK0b,8BAAL,CAAoCrb,CAApC,GACA,KAAKkT,OAAL,CAAaE,IAAb,CAAkBgI,GAA2B9H,oBAA7C,EAAmEtT,CAAnE,EAAiF4S,IAAjF,CAAuF3S,KAAa;AACjGL,UACCK,EAASwT,QAAT,GAAoB,IAAI3E,CAAJ,CAAkB7O,EAAS2R,OAAT,CAAiBvO,KAAnC,CAApB,GAAgE,IADjE,EAECpD,EAAS2R,OAFV,CAAD;AAEW,OAHb,CADA;AAIa;AAcV;;AAAA2J,OACL5b,CADK,EAELC,CAFK,EAG+D;AAGpE,QAAI,OAAOD,CAAP,IAA2B,QAA/B,EAAyC;AACvC,UAAMM,IAAUqU,EACd3U,CADc,EAEdsB,MAAMka,OAAN,CAAcvb,CAAd,IAA2CA,CAA3C,GAAuE,EAFzD,CAAhB;AAIA,aAAO,KAAKuT,OAAL,CAAalT,CAAb,CAAP;AAKF;;AAAA,QAAIgB,MAAMka,OAAN,CAAcxb,CAAd,KAAkC,CAAC,CAACC,CAAxC,EAAmE;AAEjE,WAAKqb,SAAL,CAAetb,CAAf,EAAgCC,CAAhC;AACA;AAKF;;AAAA,QAAMI,IAAUwb,IAAhB;AACA,aAAQlM,GAAR,IACO,IAAIoC,CAAJ,CAAoB/R,CAApB,EAAqCsS,UAArC,CAAgD;AACrDlD,YAAM,MAD+C;AAErDE,eAASjP,EAAQgP;AAFoC,KAAhD,EAGJ4C,OAJH;AAOK;;AAAA6J,WAAS;AACd,QAAM9b,IAAiB2U,EAA4B,cAA5B,CAAvB;AACA,WAAO,KAAKnB,OAAL,CAAuBxT,CAAvB,CAAP;AAOQ;;AAAAwT,UAAkExT,CAAlE,EAA2G;AACnH,gBAAK0b,8BAAL,CAAoC1b,CAApC,GACO,MAAMwT,OAAN,CAAkCxT,CAAlC,CADP;AAQM;;AAAA0b,iCAA+B1b,CAA/B,EAAwE;AAC9E,QAAMC,IAAiB,eAAvB;AAIA,SAASqT,GAAT,CAAasB,QAAT,KAEF5U,EAAQuO,MAAR,GAAiB,GAAGtO,IAAiBD,EAAQuO,QAF3C;AAE2C;;AA3HuB,CAH1E;;ACZO,YAAmBxO,CAAnB,EAAgCC,CAAhC,EAAoD;AAGzD,SAAOA,IAAO,IAAI+b,GAAJ,CAAQhc,CAAR,EAAaC,CAAb,CAAP,GAA4B,IAAI+b,GAAJ,CAAQhc,CAAR,CAAnC;ACaF;;AAAA,IAAMic,KAAkB,CAAC,SAAD,EAAY,SAAZ,EAAuB,KAAvB,CAAxB;;AAMA,YAA4Djc,CAA5D,EAAyE;AACvE,MAAIC,IAAeR,OAAOyc,cAAP,CAAsBlc,CAAtB,CAAnB;AAAA,MACME,IAAS,CAACD,CAAD,CADf;;AAGA,SAAOA,MAAiBsU,EAAW7U,SAAnC,GACEO,IAAeR,OAAOyc,cAAP,CAAsBjc,CAAtB,CAAf,EACAC,EAAOW,IAAP,CAAYZ,CAAZ,CADA;;AAIF,SAAOC,CAAP;AAGF;;AAAA,uBAAgFqU,CAAhF,CAA2F;AAmBzFjO,gBAAc;AACZ,UAAM,MAAN;AAjBM,4CAAmC,IAAI6V,GAAJ,EAAnC;AAIA,8BAAqB,EAArB;AAEE,iBAAQ;AAChBC,0BADgB;AAEhBC,sBAFgB;AAGhBC,mBAHgB;AAIhBC,oBAJgB;AAKhBC,oCALgB;AAMhBC,yCANgB;AAOhBC;AAPgB,KAAR;AAeR,QAAMzc,IAAa,CAAC,IAAD,EAAO,GAAG0c,GAAkB,IAAlB,CAAV,CAAnB;AAEAV,OAAgB1L,OAAhB,CAAwBrQ,CAAC,IAAS;AAChC,UAAMI,IAAiBL,EAAWoH,GAAX,CAAe3F,CAAC,IAAWjC,OAAOmd,wBAAP,CAAgClb,CAAhC,EAAwCxB,CAAxC,CAA3B,CAAvB;AAAA,UACMK,IAAcD,EAAeuc,SAAf,CAAyBnb,CAAC,IAAM,CAAC,CAACA,CAAlC,CADpB;AAAA,UAEMjB,IAAmBF,IAAc,CAFvC;AAAA,UAGMI,IAAaL,EAAeC,CAAf,CAHnB;AAMAI,OAAI,KACF,KAAKmc,gCAAL,CAAsChT,GAAtC,CAA0C5J,CAA1C,EAAgD;AAAE6c,qBAAF;AAAcC;AAAd,OAAhD,GAEAvd,OAAOkS,cAAP,CAAsB,IAAtB,EAA4BzR,CAA5B,EAAkC;AAChC+c,sBAAc,EADkB;AAEhCC,aAAK,MAAM;AACT,gBAAMC,GAAmCjd,CAAnC,CAAN;AAAyC;AAHX,OAAlC,CAHE,CAAJ;AAM+C,KAbjD;AAyBK;;AAAAkd,OAAKnd,CAAL,EAAmB;AACxB,SAASod,kBAAL,KAIJpB,GAAgB1L,OAAhB,CAAwBrQ,CAAC,IAAS;AAEhC,UAAI,KAAK4c,gCAAL,CAAsCQ,GAAtC,CAA0Cpd,CAA1C,CAAJ,EAAqD;AACnD,YAAM;AAAE6c,uBAAF;AAAcC;AAAd,YAAmC,KAAKF,gCAAL,CAAsCI,GAAtC,CAA0Chd,CAA1C,CAAzC;;AAEIK,YAGF,OAAO,KAAKL,CAAL,CAHL,GAKFT,OAAOkS,cAAP,CAAsB,IAAtB,EAA4BzR,CAA5B,EAAkCI,CAAlC,CALF;AAKoC;AAAA,KAVxC,GAeA,KAAKiT,GAAL,GAAWtT,CAfX,EAgBA,KAAKod,kBAAL,GAA0B,EApB1B;AA6BQ;;AAAAE,2BAAyBtd,CAAzB,EAIgB;AACxB,QAAM;AAAEuO,eAAF;AAAUgP,uBAAV;AAA0BnM;AAA1B,QAAyCpR,CAA/C;AAAA,QAEMQ,IAAmBF,IAAa,UAAUA,cAAvB,GAAiD,EAF1E;AAAA,QAGMI,IAAU,KAAKT,wDAA6DI,OAAoBG,GAHtG;AAIA,WAAO,IAAIsD,EAAJ,CAA0B,IAA1B,EAAgC,oBAAhC,EAAsDpD,CAAtD,CAAP;AAQQ;;AAAA8c,gBAAcxd,CAAd,EAAqCC,CAArC,EAA6E;AACrF,WAAO,IAAI6D,EAAJ,CAA0B,IAA1B,EAAgC9D,CAAhC,EAAsCC,CAAtC,CAAP;AAQQ;;AAAAwd,cAAyBzd,CAAzB,EAAgDC,CAAhD,EAAiEI,CAAjE,EAA0G;AAClH,WAAO,IAAIwP,CAAJ,CAA+B,IAA/B,EAAqC7P,CAArC,EAA2CC,CAA3C,EAAoDI,CAApD,CAAP;AAA2D;;AA5G4B,CAA3F;AAAA,IAgHAqd,mBAA0FC,EAA1F,CAA+G,EAhH/G;AAAA,IAwHOC,kBAA4ED,EAA5E,CAAiG,EAxHxG;AAkIgBC,CAVT,CAUSC,QAVT,GAUoBH,EAAX,EAVTE,EAWSE,SAXT,GAWyC,qBAXzC;;ACrIP,YAA8B/d,CAA9B,EAAsD;AACpD,SAAIA,EAAIsQ,MAAJ,IAActQ,EAAIsQ,MAAJ,CAAWvB,EAAesB,OAA1B,KAAsC,IAApD,GACK,OAAOrQ,EAAIsQ,MAAJ,CAAWvB,EAAesB,OAA1B,CAAP,IAA8C,QAA9C,GACH9D,GAAUQ,GAAOgC,EAAetI,OAAtB,CAAV,EAA0CzG,EAAIsQ,MAAJ,CAAWvB,EAAesB,OAA1B,CAA1C,CADG,GAEH,CAAC,CAACrQ,EAAIsQ,MAAJ,CAAWvB,EAAesB,OAA1B,CAHJ,GAQG,EARP;AAeF;;AAAA,YAA0CrQ,CAA1C,EAA0G;AAxC1G;AAyCE,MAAMC,IAAyE,4BAAS+d,UAAT,gBAAuB,EAAtG;AAAA,MACM9d,IAAiB,EADvB;AAAA,MAEMI,IAA8C,EAFpD;AAkCA,MA9BAiB,KAAI,CAAMka,OAAN,CAAcxb,CAAlB,IACEA,EAAWsQ,OAAX,CAAoB9P,KAAQ;AACtBwd,OAAqBxd,CAArB,CAAJ,IACEA,EAAI2c,IAAJ,CAAS,IAAT,GACI,GAAIrN,IAAJ,IAAYtP,EAAIsP,IAAJ,KAAa8N,EAAUE,SAAnC,MAED,KAAatd,EAAIsP,IAAjB,IAAyBtP,CAFxB,CADJ,EAKIA,aAAeod,EAAUC,QAAzB,KACGI,GAAQzd,EAAI0d,MAAZ,MAAqBje,EAAUO,EAAIsP,IAAd,IAAsBtP,EAAI0d,MAA/C,CADH,CANF,IAUF7d,EAAuBO,IAAvB,CAA4BJ,CAA5B,CAVF;AAU8B,GAXhC,CADE,GAgBFhB,OAAO2W,IAAP,CAAYnW,CAAZ,EAAwBsQ,OAAxB,CAAgC9P,CAAC,IAAS;AACxC,QAAIwd,GAAqBhe,EAAWQ,CAAX,CAArB,CAAJ,EAA4C;AAC1CR,QAAWQ,CAAX,EAAiB2c,IAAjB,CAAsB,IAAtB;AACA,UAAMzc,IAAMV,EAAWQ,CAAX,CAAZ;AACA,WAAcA,CAAb,IAAqBE,CAAtB,EACIA,aAAekd,EAAUC,QAAzB,KACGI,GAAQvd,EAAIwd,MAAZ,MAAqBje,EAAUD,EAAWQ,CAAX,EAAiBsP,IAA3B,IAAmCpP,EAAIwd,MAA5D,CADH,CADH;AAEkE,KALrE,MAQE7d,EAAuBO,IAAvB,CAA4BZ,EAAWQ,CAAX,CAA5B;AAAuC,GAT3C,CAhBE,EA8BAH,EAAuBgB,MAA3B,EACE,MAAM8c,GAAkC9d,CAAlC,CAAN;AAGF,SAAOJ,CAAP;AAkBK;;AAAA,cAAc;AA2BnBoG,cAA4BrG,CAA5B,EAA4CC,CAA5C,EAAuF;AAA3D;AA5H9B;AA6HI,QAAI,CAACD,CAAL,EAAa,MAAMoe,IAAN;AAEbtP,KAAI,CAAeyB,QAAf,KAA4B,cAAhC,KAAkDtQ,uBAASoe,QAA3D,KACEC,KAAgD3O,GAAhD,EADE;AAIJ,QAAM;AAAEuB,wBAAF;AAAmB1K;AAAnB,QAA+BsI,CAArC;AACA,SAAK8F,QAAL,GAAgB,CAAC,EAAC3U,uBAAS2U,QAAV,CAAjB,EACA,KAAKyJ,QAAL,GAAgBE,GAAU,4BAASF,QAAT,gBAAqBhe,CAA/B,EAAgDmV,MADhE,EAIA,KAAKgJ,IAAL,GAAY,IAAIC,EAAJ,CAAe,IAAf,CAJZ,EAKA,KAAKC,IAAL,GAAY,IAAIC,EAAJ,CAAe,IAAf,CALZ,EAMA,KAAKC,WAAL,GAAmB,IAAIzD,EAAJ,CAAsB,IAAtB,CANnB;AASA,QAAM3a,IAAiBqe,GAAkB7d,IAAlB,CAAuB,IAAvB,EAA6Bf,CAA7B,CAAvB;AAGA,SAAK6e,UAAL,GAAkBC,EAA4B;AAC5CC,eAAS,KAAKC,MAD8B;AAE5CC,qBAAe7J,OAAOC,QAAP,GAAkBD,OAAOC,QAAP,CAAgBE,MAAlC,GAA2C,EAFd;AAG5C2J,mBAAalf,uBAASmf,OAHsB;AAI5CC,YAAMd,GAAU,KAAKF,QAAf,EAAyBgB,IAJa;AAK5C/L,WAAKtE,GAAiBF,EAAesB,OAAhC,CALuC;AAM5C5J,gBAN4C;AAO5C8Y,WAAKrB,GAAQzd,CAAR,IAAqB,MAArB,GAAiCA,CAPM;AAQ5C+e,cAAQ,wBAASA,MAAT,KAAmB;AARiB,KAA5B,CAAlB;AAQ6B;;AAOjB,gBAA0B;AACtC,QAAI,CAACC,EAAQC,YAAR,CAAqBpC,GAArB,CAAyB,KAAKyB,UAA9B,CAAL,EAAgD;AAC9C,UAAM9e,IAAa,IAAI8O,EAAe4Q,cAAnB,CAAkC,KAAKrB,QAAvC,EAAiD,KAAKS,UAAtD,CAAnB;AAKA9e,QAAWmd,IAAX,IAEAqC,EAAQC,YAAR,CAAqB5V,GAArB,CAAyB,KAAKiV,UAA9B,EAA0C9e,CAA1C,CAFA;AAKF;;AAAA,WAAOwf,EAAQC,YAAR,CAAqBxC,GAArB,CAAyB,KAAK6B,UAA9B,CAAP;AAQW;;AAAAa,YAAU;AAAA;AACrB,YAAM,KAAKpM,OAAL,CAAakD,KAAnB;AAAmB,KADE;AACF;;AAnFF,CAAd;AAAA;AACmBmJ,EADnB,CACmBH,YADnB,GAC+D,IAAIvD,GAAJ,EAA5C;AClG1B;;AAyBA,YACEnc,CADF,EAEEC,CAFF,EAGqC;AACnC,SAAOA,KAAMsB,MAAMka,OAAN,CAAczb,CAAd,CAAN,GACHA,EAAe8f,IAAf,CAAqB5f,KAAMA,EAAEqO,EAAF,KAAStO,CAApC,CADG,GAEFD,CAFL;AASF;;AAAA,YACEA,CADF,EAEEC,CAFF,EAGwB;AAzCxB;AA0CE,MAAMC,IAAK,OAAMmU,IAAN,CAAWD,QAAX,uBAAqB7F,EAAhC;AAAA,MACMjO,IAAyByf,GAA2B/f,CAA3B,EAA2CE,CAA3C,CAD/B;;AAGA,MAAIA,KAAMI,CAAV,EAAkC;AAEhC,QAAMG,IAAW,IAAIuR,CAAJ,CAAoB1R,CAApB,EACdkS,WADc,CACFvS,EAAMoU,IAAN,CAAWD,QAAX,CAAoB1F,MADlB,EAEd6D,UAFc,CAEHtS,EAAMoU,IAAN,CAAWD,QAAX,CAAoBzQ,KAFjB,CAAjB;AAIA,WAAO;AAAE4K,WAAF;AAAM6F;AAAN,KAAP;AAGF;;AAAA,SAAO,EAAP;AAGF;;AAAA,YAAkCpU,CAAlC,EAAmDC,CAAnD,EAA6G;AAAA;AAC3G,QAAMC,IAAK,MAAMyW,EAAgB,IAAhB,CAAjB;AAAA,QACIrW,CADJ;AAIA,QAAIyO,EAAeyB,QAAf,KAA4B,KAAhC,EACE,IAAI;AACFlQ,UAAM,MAAM0f,IAAZ;AAAY,KADd,CACc,OACLzf,CADK,EACZ;AACAmD,cAAQC,KAAR,CAAc,iBAAd,EAAiCpD,CAAjC;AAIJ;AAAA,WAAKD,IAIAJ,IAIE;AAAE+f,gBAAF;AAAW/N,gBAAX;AAAoBgO,YAApB;AAAyBvN;AAAzB,KAJF,GACI;AAAEsN,gBAAF;AAAW/N,gBAAX;AAAoBgO;AAApB,KALJ,GACI;AAAED,gBAAF;AAAW/N;AAAX,KADT;AACoB,GAduF;AAwB7G;;AAAA,YAA6ClS,CAA7C,EAAuE;AAAA;AACrE,KAAKA,EAAMqU,IAAN,CAAW1B,EAAhB,KAIA,MAAMkE,EAAQ,IAAR,EAAc7W,EAAMqU,IAAN,CAAW1B,EAAzB,CAJN;AAI+B,GALsC;AAQhE;;AAAA,eAA8B;AAWnCrM,cAA+BrG,CAA/B,EAAoEC,CAApE,EAAwF;AAAzD;AAAqC;AATjD,2BAAkB,IAAIigB,GAAJ,EAAlB;AAUjB,SAAKzJ,KAAL,GAAa,KAAK0J,YAAL,EAAb,EACA,KAAKC,MAAL,EADA;AA0BW;;AAAA3M,OACXzT,CADW,EAEXC,CAFW,EAG2D;AAAA;AACtE,aAAO8S,GAAc1S,CAAO,IAAYkW;AACtC,cAAM,KAAKE,KAAX;AAEA,YAAMnW,IAA+B,EAArC;AAAA,YACME,IAAWc,MAAMka,OAAN,CAAcvb,CAAd,IAAyBA,EAAQmH,GAAR,CAAazF,KAAMA,EAAE2M,EAArB,CAAzB,GAAoD,EADrE;AAAA,YAEM5N,IAAM,MAAM2f,GAAmB,GAAGrgB,KAAW,KAAK8e,YAAtC,EAAoD7e,CAApD,CAFlB;AAIA,cAAM,KAAKqgB,KAAL,CAAW5f,CAAX,CAAN;;AAKA,YAAMe,IAAuBE,KAAsDE,KAA6B;AAC9G,cAAM;AAAEyM,iBAAF;AAAM6F;AAAN,cAAmBoM,GAAoBtgB,CAApB,EAA6B4B,CAA7B,CAAzB;AACA2e,aAA8B3e,CAA9B,GAEAC,CAAI,IAAMG,CAAV,IAAsBX,MAAMka,OAAN,CAAcvb,CAAd,CAAlB,IAA4CO,EAASoO,QAAT,CAAkB9M,CAAlB,CAAhD,IACExB,EAAUM,IAAV,CAAeqB,CAAf,GAGI3B,EAAUe,MAAV,KAAqBpB,EAAQoB,MAA7B,KACFM,KACAtB,EAAQC,CAAR,CAFE,CAJN,IAQWwB,KAAMG,CAAN,IAAkB,CAACX,MAAMka,OAAN,CAAcvb,CAAd,CAAnB,IAA6C6B,MAAO7B,EAAQqO,EAA5D,KACT3M,KACAtB,EAAQ4B,CAAR,CAFS,CAVX;AAYU,SAdZ;AAAA,YAmBMP,IAAyB,KAAKS,EAAL,CAC7Bse,GAA2BC,qBADE,EAE7Bjf,EAAoB,MAAMC,GAA1B,CAF6B,CAnB/B;AAqB4B,OAjCU,CAAjC,CAAP;AAiC8B,KAlCwC;AA8CjE;;AAAAS,KACLnC,CADK,EAELC,CAFK,EAGwB;AAC7B,QAAMI,IAAeJ,EAAQ0gB,IAAR,CAAatL,MAAb,CAArB;AAAA,QAMM/U,IAAYE,KAA6B;AACzCA,QAAM4T,IAAV,CAAe4L,OAAX,KAAuB,GAAGhgB,KAAW,KAAK8e,YAA1C,IAAwDze,EAAaG,CAAb,CAA5D;AAAyE,KAP3E;;AAUA,gBAAKogB,eAAL,CAAqBC,GAArB,CAAyBvgB,CAAzB,GACO,MAAM,KAAKsgB,eAAL,CAAqBE,MAArB,CAA4BxgB,CAA5B,CADb;AAIM;;AAAA6f,iBAAe;AACrB,WAAO,IAAI/M,OAAJ,CAAkBpT,CAAC,IAAY;AACpC,WAAKmC,EAAL,CAAQse,GAA2BM,mBAAnC,EAAwD,MAAM/gB,GAA9D;AAA8D,KADzD,CAAP;AAQM;;AAAAogB,WAAS;AACf,SAAKje,EAAL,CAAQse,GAA2BO,kBAAnC,EAAuD,MAAM;AAC3D,WAAKC,WAAL;AAAK,KADP,GAIA,KAAK9e,EAAL,CAAQse,GAA2BS,kBAAnC,EAAuD,MAAM;AAC3D,WAAKC,WAAL;AAAK,KADP,CAJA;AAKO;;AAxH0B,CAA9B;AAwHI","names":["$n","Object","prototype","hasOwnProperty","T","create","B","__proto__","t","e","n","fn","context","once","r","s","TypeError","o","bn","a","_events","push","_eventsCount","g","eventNames","call","slice","getOwnPropertySymbols","concat","listeners","length","Array","listenerCount","emit","i","c","p","arguments","l","u","removeListener","apply","v","M","on","tt","se","removeAllListeners","off","addListener","prefixed","EventEmitter","he","exports","St","Number","MAX_SAFE_INTEGER","de","SEMVER_SPEC_VERSION","MAX_LENGTH","MAX_SAFE_COMPONENT_LENGTH","Lt","process","env","NODE_DEBUG","test","console","error","d","K","wt","re","src","RegExp","NUMERICIDENTIFIER","NUMERICIDENTIFIERLOOSE","NONNUMERICIDENTIFIER","PRERELEASEIDENTIFIER","PRERELEASEIDENTIFIERLOOSE","BUILDIDENTIFIER","MAINVERSION","PRERELEASE","BUILD","FULLPLAIN","MAINVERSIONLOOSE","PRERELEASELOOSE","LOOSEPLAIN","XRANGEIDENTIFIER","XRANGEIDENTIFIERLOOSE","GTLT","XRANGEPLAIN","XRANGEPLAINLOOSE","COERCE","LONETILDE","tildeTrimReplace","LONECARET","caretTrimReplace","comparatorTrimReplace","we","Se","Ct","Ot","compareIdentifiers","rcompareIdentifiers","Le","z","Ce","Oe","j","E","constructor","loose","includePrerelease","version","options","trim","match","LOOSE","FULL","raw","major","minor","patch","prerelease","split","map","build","format","join","toString","compare","compareMain","comparePre","compareBuild","inc","isNaN","Error","_t","D","Dt","kt","Jt","qt","Gt","Ut","Kt","jt","Ft","Wt","Xt","Bt","Ht","me","F","Symbol","L","value","parse","semver","operator","_e","De","COMPARATORLOOSE","COMPARATOR","intersects","N","set","parseRange","filter","range","y","h","HYPHENRANGELOOSE","HYPHENRANGE","replace","cn","COMPARATORTRIM","Vt","TILDETRIM","zt","CARETTRIM","Yt","Zt","an","some","ke","every","ln","pop","tn","Qt","rn","R","toLowerCase","en","TILDELOOSE","TILDE","nn","CARETLOOSE","CARET","sn","XRANGELOOSE","XRANGE","STAR","GTE0PRE","GTE0","ANY","Je","pn","qe","Ge","un","dn","Y","Z","Ue","String","rtl","COERCERTL","exec","index","lastIndex","fromCharCode","parseInt","charCodeAt","btoa","encodeURIComponent","mn","decodeURIComponent","from","atob","En","hn","JSON","stringify","Rn","$","ee","jsonrpc","id","method","params","result","values","yn","includes","gn","m","assign","We","setPrototypeOf","b","A","code","rawMessage","message","Fe","vn","InternalError","W","log","warn","X","name","k","MissingApiKey","ModalNotReady","MalformedResponse","ExtensionNotInitialized","sdkName","compat","forEach","platform","IncompatibleExtensions","InvalidArgument","argument","procedure","expected","received","ne","DuplicateIframe","SyncWeb3Method","ReactNativeEndpointConfiguration","defaultEndpoint","removalVersions","useInstead","DeprecationNotice","In","xn","next","Qe","defineProperty","enumerable","Pn","Ee","et","O","_jsonrpc","payload","_id","_result","_error","je","applyError","applyResult","At","st","rt","emitter","createChainingEmitterMethod","createBoundEmitterMethod","ot","fe","oe","then","catch","finally","Promise","resolve","sdk","overlay","request","post","Mn","MAGIC_HANDLE_REQUEST","C","ie","hasError","hasResult","Be","Nn","MAGIC_HANDLE_EVENT","response","data","event","P","loginWithMagicLink","email","showUI","redirectURI","f","testMode","J","LoginWithMagicLinkTestMode","LoginWithMagicLink","loginWithSMS","phoneNumber","LoginWithSmsTestMode","LoginWithSms","loginWithCredential","window","location","search","origin","pathname","history","replaceState","LoginWithCredentialTestMode","LoginWithCredential","Mt","clear","getItem","iterate","key","keys","removeItem","setItem","ae","I","configureStorage","ready","_","w","q","ce","An","wn","Sn","Ln","Cn","crypto","getRandomValues","Uint8Array","ge","le","Re","ct","On","namedCurve","_n","Dn","info","subtle","iat","Math","floor","Date","getTime","jti","at","typ","alg","jwk","protected","ut","claims","qn","hash","Un","sign","Jn","kn","generateKey","exportKey","privateKey","publicKey","importKey","dt","Gn","TextEncoder","encode","getIdToken","x","GetIdTokenTestMode","GetIdToken","generateIdToken","GenerateIdTokenTestMode","GenerateIdToken","getMetadata","GetMetadataTestMode","GetMetadata","updateEmail","UpdateEmailTestMode","UpdateEmail","isLoggedIn","IsLoggedInTestMode","IsLoggedIn","logout","lt","LogoutTestMode","Logout","showSettings","UserSettingsTestMode","UserSettings","ve","G","pe","sendAsync","ze","isArray","mt","prefixPayloadMethodForTestMode","Ae","send","Ye","enable","URL","Et","getPrototypeOf","Map","createPromiEvent","isPromiEvent","encodeJSON","decodeJSON","createJsonRpcRequestPayload","standardizeJsonRpcRequestPayload","storage","Kn","getOwnPropertyDescriptor","findIndex","__sdk_access_field_descriptors__","descriptor","isPrototypeField","configurable","get","He","init","__is_initialized__","has","createDeprecationWarning","removalVersion","createWarning","createError","ht","Ie","S","Internal","Anonymous","extensions","ft","te","config","Ve","Xe","endpoint","Ze","xe","auth","ye","user","Te","rpcProvider","jn","parameters","Q","API_KEY","apiKey","DOMAIN_ORIGIN","ETH_NETWORK","network","host","ext","locale","V","__overlays__","ViewController","preload","Pe","find","Fn","pt","msgType","jwt","Set","waitForReady","listen","Xn","_post","Wn","Bn","ue","MAGIC_HANDLE_RESPONSE","bind","messageHandlers","add","delete","MAGIC_OVERLAY_READY","MAGIC_HIDE_OVERLAY","hideOverlay","MAGIC_SHOW_OVERLAY","showOverlay"],"sources":["../../node_modules/eventemitter3/index.js","../../src/util/semver.js","../../src/util/base64-json.ts","../../src/core/sdk-exceptions.ts","../../src/util/type-guards.ts","../../src/core/sdk-environment.ts","../../src/modules/auth.ts","../../src/modules/base-module.ts","../../src/util/get-payload-id.ts","../../src/core/json-rpc.ts","../../src/util/events.ts","../../src/util/promise-tools.ts","../../src/modules/user.ts","../../src/util/storage.ts","../../src/util/uuid.ts","../../src/util/web-crypto.ts","../../src/modules/rpc-provider.ts","../../src/util/url.ts","../../src/modules/base-extension.ts","../../src/core/sdk.ts","../../src/core/view-controller.ts"],"sourcesContent":["'use strict';\n\nvar has = Object.prototype.hasOwnProperty\n  , prefix = '~';\n\n/**\n * Constructor to create a storage for our `EE` objects.\n * An `Events` instance is a plain object whose properties are event names.\n *\n * @constructor\n * @private\n */\nfunction Events() {}\n\n//\n// We try to not inherit from `Object.prototype`. In some engines creating an\n// instance in this way is faster than calling `Object.create(null)` directly.\n// If `Object.create(null)` is not supported we prefix the event names with a\n// character to make sure that the built-in object properties are not\n// overridden or used as an attack vector.\n//\nif (Object.create) {\n  Events.prototype = Object.create(null);\n\n  //\n  // This hack is needed because the `__proto__` property is still inherited in\n  // some old browsers like Android 4, iPhone 5.1, Opera 11 and Safari 5.\n  //\n  if (!new Events().__proto__) prefix = false;\n}\n\n/**\n * Representation of a single event listener.\n *\n * @param {Function} fn The listener function.\n * @param {*} context The context to invoke the listener with.\n * @param {Boolean} [once=false] Specify if the listener is a one-time listener.\n * @constructor\n * @private\n */\nfunction EE(fn, context, once) {\n  this.fn = fn;\n  this.context = context;\n  this.once = once || false;\n}\n\n/**\n * Add a listener for a given event.\n *\n * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} context The context to invoke the listener with.\n * @param {Boolean} once Specify if the listener is a one-time listener.\n * @returns {EventEmitter}\n * @private\n */\nfunction addListener(emitter, event, fn, context, once) {\n  if (typeof fn !== 'function') {\n    throw new TypeError('The listener must be a function');\n  }\n\n  var listener = new EE(fn, context || emitter, once)\n    , evt = prefix ? prefix + event : event;\n\n  if (!emitter._events[evt]) emitter._events[evt] = listener, emitter._eventsCount++;\n  else if (!emitter._events[evt].fn) emitter._events[evt].push(listener);\n  else emitter._events[evt] = [emitter._events[evt], listener];\n\n  return emitter;\n}\n\n/**\n * Clear event by name.\n *\n * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.\n * @param {(String|Symbol)} evt The Event name.\n * @private\n */\nfunction clearEvent(emitter, evt) {\n  if (--emitter._eventsCount === 0) emitter._events = new Events();\n  else delete emitter._events[evt];\n}\n\n/**\n * Minimal `EventEmitter` interface that is molded against the Node.js\n * `EventEmitter` interface.\n *\n * @constructor\n * @public\n */\nfunction EventEmitter() {\n  this._events = new Events();\n  this._eventsCount = 0;\n}\n\n/**\n * Return an array listing the events for which the emitter has registered\n * listeners.\n *\n * @returns {Array}\n * @public\n */\nEventEmitter.prototype.eventNames = function eventNames() {\n  var names = []\n    , events\n    , name;\n\n  if (this._eventsCount === 0) return names;\n\n  for (name in (events = this._events)) {\n    if (has.call(events, name)) names.push(prefix ? name.slice(1) : name);\n  }\n\n  if (Object.getOwnPropertySymbols) {\n    return names.concat(Object.getOwnPropertySymbols(events));\n  }\n\n  return names;\n};\n\n/**\n * Return the listeners registered for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Array} The registered listeners.\n * @public\n */\nEventEmitter.prototype.listeners = function listeners(event) {\n  var evt = prefix ? prefix + event : event\n    , handlers = this._events[evt];\n\n  if (!handlers) return [];\n  if (handlers.fn) return [handlers.fn];\n\n  for (var i = 0, l = handlers.length, ee = new Array(l); i < l; i++) {\n    ee[i] = handlers[i].fn;\n  }\n\n  return ee;\n};\n\n/**\n * Return the number of listeners listening to a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Number} The number of listeners.\n * @public\n */\nEventEmitter.prototype.listenerCount = function listenerCount(event) {\n  var evt = prefix ? prefix + event : event\n    , listeners = this._events[evt];\n\n  if (!listeners) return 0;\n  if (listeners.fn) return 1;\n  return listeners.length;\n};\n\n/**\n * Calls each of the listeners registered for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Boolean} `true` if the event had listeners, else `false`.\n * @public\n */\nEventEmitter.prototype.emit = function emit(event, a1, a2, a3, a4, a5) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events[evt]) return false;\n\n  var listeners = this._events[evt]\n    , len = arguments.length\n    , args\n    , i;\n\n  if (listeners.fn) {\n    if (listeners.once) this.removeListener(event, listeners.fn, undefined, true);\n\n    switch (len) {\n      case 1: return listeners.fn.call(listeners.context), true;\n      case 2: return listeners.fn.call(listeners.context, a1), true;\n      case 3: return listeners.fn.call(listeners.context, a1, a2), true;\n      case 4: return listeners.fn.call(listeners.context, a1, a2, a3), true;\n      case 5: return listeners.fn.call(listeners.context, a1, a2, a3, a4), true;\n      case 6: return listeners.fn.call(listeners.context, a1, a2, a3, a4, a5), true;\n    }\n\n    for (i = 1, args = new Array(len -1); i < len; i++) {\n      args[i - 1] = arguments[i];\n    }\n\n    listeners.fn.apply(listeners.context, args);\n  } else {\n    var length = listeners.length\n      , j;\n\n    for (i = 0; i < length; i++) {\n      if (listeners[i].once) this.removeListener(event, listeners[i].fn, undefined, true);\n\n      switch (len) {\n        case 1: listeners[i].fn.call(listeners[i].context); break;\n        case 2: listeners[i].fn.call(listeners[i].context, a1); break;\n        case 3: listeners[i].fn.call(listeners[i].context, a1, a2); break;\n        case 4: listeners[i].fn.call(listeners[i].context, a1, a2, a3); break;\n        default:\n          if (!args) for (j = 1, args = new Array(len -1); j < len; j++) {\n            args[j - 1] = arguments[j];\n          }\n\n          listeners[i].fn.apply(listeners[i].context, args);\n      }\n    }\n  }\n\n  return true;\n};\n\n/**\n * Add a listener for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} [context=this] The context to invoke the listener with.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.on = function on(event, fn, context) {\n  return addListener(this, event, fn, context, false);\n};\n\n/**\n * Add a one-time listener for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} [context=this] The context to invoke the listener with.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.once = function once(event, fn, context) {\n  return addListener(this, event, fn, context, true);\n};\n\n/**\n * Remove the listeners of a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn Only remove the listeners that match this function.\n * @param {*} context Only remove the listeners that have this context.\n * @param {Boolean} once Only remove one-time listeners.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.removeListener = function removeListener(event, fn, context, once) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events[evt]) return this;\n  if (!fn) {\n    clearEvent(this, evt);\n    return this;\n  }\n\n  var listeners = this._events[evt];\n\n  if (listeners.fn) {\n    if (\n      listeners.fn === fn &&\n      (!once || listeners.once) &&\n      (!context || listeners.context === context)\n    ) {\n      clearEvent(this, evt);\n    }\n  } else {\n    for (var i = 0, events = [], length = listeners.length; i < length; i++) {\n      if (\n        listeners[i].fn !== fn ||\n        (once && !listeners[i].once) ||\n        (context && listeners[i].context !== context)\n      ) {\n        events.push(listeners[i]);\n      }\n    }\n\n    //\n    // Reset the array, or remove it completely if we have no more listeners.\n    //\n    if (events.length) this._events[evt] = events.length === 1 ? events[0] : events;\n    else clearEvent(this, evt);\n  }\n\n  return this;\n};\n\n/**\n * Remove all listeners, or those of the specified event.\n *\n * @param {(String|Symbol)} [event] The event name.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.removeAllListeners = function removeAllListeners(event) {\n  var evt;\n\n  if (event) {\n    evt = prefix ? prefix + event : event;\n    if (this._events[evt]) clearEvent(this, evt);\n  } else {\n    this._events = new Events();\n    this._eventsCount = 0;\n  }\n\n  return this;\n};\n\n//\n// Alias methods names because people roll like that.\n//\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\nEventEmitter.prototype.addListener = EventEmitter.prototype.on;\n\n//\n// Expose the prefix.\n//\nEventEmitter.prefixed = prefix;\n\n//\n// Allow `EventEmitter` to be imported as module namespace.\n//\nEventEmitter.EventEmitter = EventEmitter;\n\n//\n// Expose the module.\n//\nif ('undefined' !== typeof module) {\n  module.exports = EventEmitter;\n}\n","/* eslint-disable */\n/* istanbul ignore file */\n\n// DO NOT CHANGE THIS FILE.\n//\n// We have to bundle `semver` ourselves due to a long-standing cyclic dependency\n// which causes Rollup to break the `satisfies` function.\n//\n// See:\n//   - https://github.com/magiclabs/magic-js/issues/198\n//   - https://github.com/rollup/plugins/issues/879\n//   - https://github.com/npm/node-semver/issues/318\n//   - https://github.com/npm/node-semver/issues/381\n\nfunction createCommonjsModule(e){const r={exports:{}};return e(r,r.exports),r.exports}const SEMVER_SPEC_VERSION=\"2.0.0\",MAX_LENGTH$2=256,MAX_SAFE_INTEGER$1=Number.MAX_SAFE_INTEGER||9007199254740991,MAX_SAFE_COMPONENT_LENGTH=16,constants={SEMVER_SPEC_VERSION:\"2.0.0\",MAX_LENGTH:256,MAX_SAFE_INTEGER:MAX_SAFE_INTEGER$1,MAX_SAFE_COMPONENT_LENGTH:16},debug=\"object\"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\\bsemver\\b/i.test(process.env.NODE_DEBUG)?(...e)=>console.error(\"SEMVER\",...e):()=>{},debug_1=debug,re_1=createCommonjsModule(function(e,r){const{MAX_SAFE_COMPONENT_LENGTH:t}=constants,s=(r=e.exports={}).re=[],i=r.src=[],o=r.t={};let a=0;const n=(e,r,t)=>{const n=a++;debug_1(n,r),o[e]=n,i[n]=r,s[n]=new RegExp(r,t?\"g\":void 0)};n(\"NUMERICIDENTIFIER\",\"0|[1-9]\\\\d*\"),n(\"NUMERICIDENTIFIERLOOSE\",\"[0-9]+\"),n(\"NONNUMERICIDENTIFIER\",\"\\\\d*[a-zA-Z-][a-zA-Z0-9-]*\"),n(\"MAINVERSION\",`(${i[o.NUMERICIDENTIFIER]})\\\\.`+`(${i[o.NUMERICIDENTIFIER]})\\\\.`+`(${i[o.NUMERICIDENTIFIER]})`),n(\"MAINVERSIONLOOSE\",`(${i[o.NUMERICIDENTIFIERLOOSE]})\\\\.`+`(${i[o.NUMERICIDENTIFIERLOOSE]})\\\\.`+`(${i[o.NUMERICIDENTIFIERLOOSE]})`),n(\"PRERELEASEIDENTIFIER\",`(?:${i[o.NUMERICIDENTIFIER]}|${i[o.NONNUMERICIDENTIFIER]})`),n(\"PRERELEASEIDENTIFIERLOOSE\",`(?:${i[o.NUMERICIDENTIFIERLOOSE]}|${i[o.NONNUMERICIDENTIFIER]})`),n(\"PRERELEASE\",`(?:-(${i[o.PRERELEASEIDENTIFIER]}(?:\\\\.${i[o.PRERELEASEIDENTIFIER]})*))`),n(\"PRERELEASELOOSE\",`(?:-?(${i[o.PRERELEASEIDENTIFIERLOOSE]}(?:\\\\.${i[o.PRERELEASEIDENTIFIERLOOSE]})*))`),n(\"BUILDIDENTIFIER\",\"[0-9A-Za-z-]+\"),n(\"BUILD\",`(?:\\\\+(${i[o.BUILDIDENTIFIER]}(?:\\\\.${i[o.BUILDIDENTIFIER]})*))`),n(\"FULLPLAIN\",`v?${i[o.MAINVERSION]}${i[o.PRERELEASE]}?${i[o.BUILD]}?`),n(\"FULL\",`^${i[o.FULLPLAIN]}$`),n(\"LOOSEPLAIN\",`[v=\\\\s]*${i[o.MAINVERSIONLOOSE]}${i[o.PRERELEASELOOSE]}?${i[o.BUILD]}?`),n(\"LOOSE\",`^${i[o.LOOSEPLAIN]}$`),n(\"GTLT\",\"((?:<|>)?=?)\"),n(\"XRANGEIDENTIFIERLOOSE\",`${i[o.NUMERICIDENTIFIERLOOSE]}|x|X|\\\\*`),n(\"XRANGEIDENTIFIER\",`${i[o.NUMERICIDENTIFIER]}|x|X|\\\\*`),n(\"XRANGEPLAIN\",`[v=\\\\s]*(${i[o.XRANGEIDENTIFIER]})`+`(?:\\\\.(${i[o.XRANGEIDENTIFIER]})`+`(?:\\\\.(${i[o.XRANGEIDENTIFIER]})`+`(?:${i[o.PRERELEASE]})?${i[o.BUILD]}?`+\")?)?\"),n(\"XRANGEPLAINLOOSE\",`[v=\\\\s]*(${i[o.XRANGEIDENTIFIERLOOSE]})`+`(?:\\\\.(${i[o.XRANGEIDENTIFIERLOOSE]})`+`(?:\\\\.(${i[o.XRANGEIDENTIFIERLOOSE]})`+`(?:${i[o.PRERELEASELOOSE]})?${i[o.BUILD]}?`+\")?)?\"),n(\"XRANGE\",`^${i[o.GTLT]}\\\\s*${i[o.XRANGEPLAIN]}$`),n(\"XRANGELOOSE\",`^${i[o.GTLT]}\\\\s*${i[o.XRANGEPLAINLOOSE]}$`),n(\"COERCE\",`(^|[^\\\\d])(\\\\d{1,${t}})`+`(?:\\\\.(\\\\d{1,${t}}))?`+`(?:\\\\.(\\\\d{1,${t}}))?`+\"(?:$|[^\\\\d])\"),n(\"COERCERTL\",i[o.COERCE],!0),n(\"LONETILDE\",\"(?:~>?)\"),n(\"TILDETRIM\",`(\\\\s*)${i[o.LONETILDE]}\\\\s+`,!0),r.tildeTrimReplace=\"$1~\",n(\"TILDE\",`^${i[o.LONETILDE]}${i[o.XRANGEPLAIN]}$`),n(\"TILDELOOSE\",`^${i[o.LONETILDE]}${i[o.XRANGEPLAINLOOSE]}$`),n(\"LONECARET\",\"(?:\\\\^)\"),n(\"CARETTRIM\",`(\\\\s*)${i[o.LONECARET]}\\\\s+`,!0),r.caretTrimReplace=\"$1^\",n(\"CARET\",`^${i[o.LONECARET]}${i[o.XRANGEPLAIN]}$`),n(\"CARETLOOSE\",`^${i[o.LONECARET]}${i[o.XRANGEPLAINLOOSE]}$`),n(\"COMPARATORLOOSE\",`^${i[o.GTLT]}\\\\s*(${i[o.LOOSEPLAIN]})$|^$`),n(\"COMPARATOR\",`^${i[o.GTLT]}\\\\s*(${i[o.FULLPLAIN]})$|^$`),n(\"COMPARATORTRIM\",`(\\\\s*)${i[o.GTLT]}\\\\s*(${i[o.LOOSEPLAIN]}|${i[o.XRANGEPLAIN]})`,!0),r.comparatorTrimReplace=\"$1$2$3\",n(\"HYPHENRANGE\",`^\\\\s*(${i[o.XRANGEPLAIN]})`+\"\\\\s+-\\\\s+\"+`(${i[o.XRANGEPLAIN]})`+\"\\\\s*$\"),n(\"HYPHENRANGELOOSE\",`^\\\\s*(${i[o.XRANGEPLAINLOOSE]})`+\"\\\\s+-\\\\s+\"+`(${i[o.XRANGEPLAINLOOSE]})`+\"\\\\s*$\"),n(\"STAR\",\"(<|>)?=?\\\\s*\\\\*\"),n(\"GTE0\",\"^\\\\s*>=\\\\s*0.0.0\\\\s*$\"),n(\"GTE0PRE\",\"^\\\\s*>=\\\\s*0.0.0-0\\\\s*$\")}),numeric=/^[0-9]+$/,compareIdentifiers$1=(e,r)=>{const t=numeric.test(e),s=numeric.test(r);return t&&s&&(e=+e,r=+r),e===r?0:t&&!s?-1:s&&!t?1:e<r?-1:1},rcompareIdentifiers=(e,r)=>compareIdentifiers$1(r,e),identifiers={compareIdentifiers:compareIdentifiers$1,rcompareIdentifiers:rcompareIdentifiers},{MAX_LENGTH:MAX_LENGTH$1,MAX_SAFE_INTEGER:MAX_SAFE_INTEGER}=constants,{re:re$4,t:t$4}=re_1,{compareIdentifiers:compareIdentifiers}=identifiers;class SemVer{constructor(e,r){if(r&&\"object\"==typeof r||(r={loose:!!r,includePrerelease:!1}),e instanceof SemVer){if(e.loose===!!r.loose&&e.includePrerelease===!!r.includePrerelease)return e;e=e.version}else if(\"string\"!=typeof e)throw new TypeError(`Invalid Version: ${e}`);if(e.length>MAX_LENGTH$1)throw new TypeError(`version is longer than ${MAX_LENGTH$1} characters`);debug_1(\"SemVer\",e,r),this.options=r,this.loose=!!r.loose,this.includePrerelease=!!r.includePrerelease;const t=e.trim().match(r.loose?re$4[t$4.LOOSE]:re$4[t$4.FULL]);if(!t)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+t[1],this.minor=+t[2],this.patch=+t[3],this.major>MAX_SAFE_INTEGER||this.major<0)throw new TypeError(\"Invalid major version\");if(this.minor>MAX_SAFE_INTEGER||this.minor<0)throw new TypeError(\"Invalid minor version\");if(this.patch>MAX_SAFE_INTEGER||this.patch<0)throw new TypeError(\"Invalid patch version\");t[4]?this.prerelease=t[4].split(\".\").map(e=>{if(/^[0-9]+$/.test(e)){const r=+e;if(r>=0&&r<MAX_SAFE_INTEGER)return r}return e}):this.prerelease=[],this.build=t[5]?t[5].split(\".\"):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(\".\")}`),this.version}toString(){return this.version}compare(e){if(debug_1(\"SemVer.compare\",this.version,this.options,e),!(e instanceof SemVer)){if(\"string\"==typeof e&&e===this.version)return 0;e=new SemVer(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof SemVer||(e=new SemVer(e,this.options)),compareIdentifiers(this.major,e.major)||compareIdentifiers(this.minor,e.minor)||compareIdentifiers(this.patch,e.patch)}comparePre(e){if(e instanceof SemVer||(e=new SemVer(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let r=0;do{const t=this.prerelease[r],s=e.prerelease[r];if(debug_1(\"prerelease compare\",r,t,s),void 0===t&&void 0===s)return 0;if(void 0===s)return 1;if(void 0===t)return-1;if(t!==s)return compareIdentifiers(t,s)}while(++r)}compareBuild(e){e instanceof SemVer||(e=new SemVer(e,this.options));let r=0;do{const t=this.build[r],s=e.build[r];if(debug_1(\"prerelease compare\",r,t,s),void 0===t&&void 0===s)return 0;if(void 0===s)return 1;if(void 0===t)return-1;if(t!==s)return compareIdentifiers(t,s)}while(++r)}inc(e,r){switch(e){case\"premajor\":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc(\"pre\",r);break;case\"preminor\":this.prerelease.length=0,this.patch=0,this.minor++,this.inc(\"pre\",r);break;case\"prepatch\":this.prerelease.length=0,this.inc(\"patch\",r),this.inc(\"pre\",r);break;case\"prerelease\":0===this.prerelease.length&&this.inc(\"patch\",r),this.inc(\"pre\",r);break;case\"major\":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case\"minor\":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case\"patch\":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case\"pre\":if(0===this.prerelease.length)this.prerelease=[0];else{let e=this.prerelease.length;for(;--e>=0;)\"number\"==typeof this.prerelease[e]&&(this.prerelease[e]++,e=-2);-1===e&&this.prerelease.push(0)}r&&(this.prerelease[0]===r?isNaN(this.prerelease[1])&&(this.prerelease=[r,0]):this.prerelease=[r,0]);break;default:throw new Error(`invalid increment argument: ${e}`)}return this.format(),this.raw=this.version,this}}const compare=(e,r,t)=>new SemVer(e,t).compare(new SemVer(r,t)),compare_1=compare,eq=(e,r,t)=>0===compare_1(e,r,t),eq_1=eq,neq=(e,r,t)=>0!==compare_1(e,r,t),neq_1=neq,gt=(e,r,t)=>compare_1(e,r,t)>0,gt_1=gt,gte=(e,r,t)=>compare_1(e,r,t)>=0,gte_1=gte,lt=(e,r,t)=>compare_1(e,r,t)<0,lt_1=lt,lte=(e,r,t)=>compare_1(e,r,t)<=0,lte_1=lte,cmp=(e,r,t,s)=>{switch(r){case\"===\":return\"object\"==typeof e&&(e=e.version),\"object\"==typeof t&&(t=t.version),e===t;case\"!==\":return\"object\"==typeof e&&(e=e.version),\"object\"==typeof t&&(t=t.version),e!==t;case\"\":case\"=\":case\"==\":return eq_1(e,t,s);case\"!=\":return neq_1(e,t,s);case\">\":return gt_1(e,t,s);case\">=\":return gte_1(e,t,s);case\"<\":return lt_1(e,t,s);case\"<=\":return lte_1(e,t,s);default:throw new TypeError(`Invalid operator: ${r}`)}},cmp_1=cmp,ANY=Symbol(\"SemVer ANY\");class Comparator{static get ANY(){return ANY}constructor(e,r){if(r&&\"object\"==typeof r||(r={loose:!!r,includePrerelease:!1}),e instanceof Comparator){if(e.loose===!!r.loose)return e;e=e.value}debug_1(\"comparator\",e,r),this.options=r,this.loose=!!r.loose,this.parse(e),this.semver===ANY?this.value=\"\":this.value=this.operator+this.semver.version,debug_1(\"comp\",this)}parse(e){const r=this.options.loose?re$3[t$3.COMPARATORLOOSE]:re$3[t$3.COMPARATOR],t=e.match(r);if(!t)throw new TypeError(`Invalid comparator: ${e}`);this.operator=void 0!==t[1]?t[1]:\"\",\"=\"===this.operator&&(this.operator=\"\"),t[2]?this.semver=new SemVer(t[2],this.options.loose):this.semver=ANY}toString(){return this.value}test(e){if(debug_1(\"Comparator.test\",e,this.options.loose),this.semver===ANY||e===ANY)return!0;if(\"string\"==typeof e)try{e=new SemVer(e,this.options)}catch(e){return!1}return cmp_1(e,this.operator,this.semver,this.options)}intersects(e,r){if(!(e instanceof Comparator))throw new TypeError(\"a Comparator is required\");if(r&&\"object\"==typeof r||(r={loose:!!r,includePrerelease:!1}),\"\"===this.operator)return\"\"===this.value||new Range(e.value,r).test(this.value);if(\"\"===e.operator)return\"\"===e.value||new Range(this.value,r).test(e.semver);const t=!(\">=\"!==this.operator&&\">\"!==this.operator||\">=\"!==e.operator&&\">\"!==e.operator),s=!(\"<=\"!==this.operator&&\"<\"!==this.operator||\"<=\"!==e.operator&&\"<\"!==e.operator),i=this.semver.version===e.semver.version,o=!(\">=\"!==this.operator&&\"<=\"!==this.operator||\">=\"!==e.operator&&\"<=\"!==e.operator),a=cmp_1(this.semver,\"<\",e.semver,r)&&(\">=\"===this.operator||\">\"===this.operator)&&(\"<=\"===e.operator||\"<\"===e.operator),n=cmp_1(this.semver,\">\",e.semver,r)&&(\"<=\"===this.operator||\"<\"===this.operator)&&(\">=\"===e.operator||\">\"===e.operator);return t||s||i&&o||a||n}}const{re:re$3,t:t$3}=re_1;class Range{constructor(e,r){if(r&&\"object\"==typeof r||(r={loose:!!r,includePrerelease:!1}),e instanceof Range)return e.loose===!!r.loose&&e.includePrerelease===!!r.includePrerelease?e:new Range(e.raw,r);if(e instanceof Comparator)return this.raw=e.value,this.set=[[e]],this.format(),this;if(this.options=r,this.loose=!!r.loose,this.includePrerelease=!!r.includePrerelease,this.raw=e,this.set=e.split(/\\s*\\|\\|\\s*/).map(e=>this.parseRange(e.trim())).filter(e=>e.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${e}`);this.format()}format(){return this.range=this.set.map(e=>e.join(\" \").trim()).join(\"||\").trim(),this.range}toString(){return this.range}parseRange(e){const{loose:r}=this.options;e=e.trim();const t=r?re$2[t$2.HYPHENRANGELOOSE]:re$2[t$2.HYPHENRANGE];e=e.replace(t,hyphenReplace(this.options.includePrerelease)),debug_1(\"hyphen replace\",e),e=e.replace(re$2[t$2.COMPARATORTRIM],comparatorTrimReplace),debug_1(\"comparator trim\",e,re$2[t$2.COMPARATORTRIM]),e=(e=(e=e.replace(re$2[t$2.TILDETRIM],tildeTrimReplace)).replace(re$2[t$2.CARETTRIM],caretTrimReplace)).split(/\\s+/).join(\" \");const s=r?re$2[t$2.COMPARATORLOOSE]:re$2[t$2.COMPARATOR];return e.split(\" \").map(e=>parseComparator(e,this.options)).join(\" \").split(/\\s+/).map(e=>replaceGTE0(e,this.options)).filter(this.options.loose?e=>!!e.match(s):()=>!0).map(e=>new Comparator(e,this.options))}intersects(e,r){if(!(e instanceof Range))throw new TypeError(\"a Range is required\");return this.set.some(t=>isSatisfiable(t,r)&&e.set.some(e=>isSatisfiable(e,r)&&t.every(t=>e.every(e=>t.intersects(e,r)))))}test(e){if(!e)return!1;if(\"string\"==typeof e)try{e=new SemVer(e,this.options)}catch(e){return!1}for(let r=0;r<this.set.length;r++)if(testSet(this.set[r],e,this.options))return!0;return!1}}const{re:re$2,t:t$2,comparatorTrimReplace:comparatorTrimReplace,tildeTrimReplace:tildeTrimReplace,caretTrimReplace:caretTrimReplace}=re_1,isSatisfiable=(e,r)=>{let t=!0;const s=e.slice();let i=s.pop();for(;t&&s.length;)t=s.every(e=>i.intersects(e,r)),i=s.pop();return t},parseComparator=(e,r)=>(debug_1(\"comp\",e,r),e=replaceCarets(e,r),debug_1(\"caret\",e),e=replaceTildes(e,r),debug_1(\"tildes\",e),e=replaceXRanges(e,r),debug_1(\"xrange\",e),e=replaceStars(e,r),debug_1(\"stars\",e),e),isX=e=>!e||\"x\"===e.toLowerCase()||\"*\"===e,replaceTildes=(e,r)=>e.trim().split(/\\s+/).map(e=>replaceTilde(e,r)).join(\" \"),replaceTilde=(e,r)=>{const t=r.loose?re$2[t$2.TILDELOOSE]:re$2[t$2.TILDE];return e.replace(t,(r,t,s,i,o)=>{let a;return debug_1(\"tilde\",e,r,t,s,i,o),isX(t)?a=\"\":isX(s)?a=`>=${t}.0.0 <${+t+1}.0.0-0`:isX(i)?a=`>=${t}.${s}.0 <${t}.${+s+1}.0-0`:o?(debug_1(\"replaceTilde pr\",o),a=`>=${t}.${s}.${i}-${o} <${t}.${+s+1}.0-0`):a=`>=${t}.${s}.${i} <${t}.${+s+1}.0-0`,debug_1(\"tilde return\",a),a})},replaceCarets=(e,r)=>e.trim().split(/\\s+/).map(e=>replaceCaret(e,r)).join(\" \"),replaceCaret=(e,r)=>{debug_1(\"caret\",e,r);const t=r.loose?re$2[t$2.CARETLOOSE]:re$2[t$2.CARET],s=r.includePrerelease?\"-0\":\"\";return e.replace(t,(r,t,i,o,a)=>{let n;return debug_1(\"caret\",e,r,t,i,o,a),isX(t)?n=\"\":isX(i)?n=`>=${t}.0.0${s} <${+t+1}.0.0-0`:isX(o)?n=\"0\"===t?`>=${t}.${i}.0${s} <${t}.${+i+1}.0-0`:`>=${t}.${i}.0${s} <${+t+1}.0.0-0`:a?(debug_1(\"replaceCaret pr\",a),n=\"0\"===t?\"0\"===i?`>=${t}.${i}.${o}-${a} <${t}.${i}.${+o+1}-0`:`>=${t}.${i}.${o}-${a} <${t}.${+i+1}.0-0`:`>=${t}.${i}.${o}-${a} <${+t+1}.0.0-0`):(debug_1(\"no pr\"),n=\"0\"===t?\"0\"===i?`>=${t}.${i}.${o}${s} <${t}.${i}.${+o+1}-0`:`>=${t}.${i}.${o}${s} <${t}.${+i+1}.0-0`:`>=${t}.${i}.${o} <${+t+1}.0.0-0`),debug_1(\"caret return\",n),n})},replaceXRanges=(e,r)=>(debug_1(\"replaceXRanges\",e,r),e.split(/\\s+/).map(e=>replaceXRange(e,r)).join(\" \")),replaceXRange=(e,r)=>{e=e.trim();const t=r.loose?re$2[t$2.XRANGELOOSE]:re$2[t$2.XRANGE];return e.replace(t,(t,s,i,o,a,n)=>{debug_1(\"xRange\",e,t,s,i,o,a,n);const E=isX(i),p=E||isX(o),l=p||isX(a),c=l;return\"=\"===s&&c&&(s=\"\"),n=r.includePrerelease?\"-0\":\"\",E?t=\">\"===s||\"<\"===s?\"<0.0.0-0\":\"*\":s&&c?(p&&(o=0),a=0,\">\"===s?(s=\">=\",p?(i=+i+1,o=0,a=0):(o=+o+1,a=0)):\"<=\"===s&&(s=\"<\",p?i=+i+1:o=+o+1),\"<\"===s&&(n=\"-0\"),t=`${s+i}.${o}.${a}${n}`):p?t=`>=${i}.0.0${n} <${+i+1}.0.0-0`:l&&(t=`>=${i}.${o}.0${n} <${i}.${+o+1}.0-0`),debug_1(\"xRange return\",t),t})},replaceStars=(e,r)=>(debug_1(\"replaceStars\",e,r),e.trim().replace(re$2[t$2.STAR],\"\")),replaceGTE0=(e,r)=>(debug_1(\"replaceGTE0\",e,r),e.trim().replace(re$2[r.includePrerelease?t$2.GTE0PRE:t$2.GTE0],\"\")),hyphenReplace=e=>(r,t,s,i,o,a,n,E,p,l,c,$,h)=>`${t=isX(s)?\"\":isX(i)?`>=${s}.0.0${e?\"-0\":\"\"}`:isX(o)?`>=${s}.${i}.0${e?\"-0\":\"\"}`:a?`>=${t}`:`>=${t}${e?\"-0\":\"\"}`} ${E=isX(p)?\"\":isX(l)?`<${+p+1}.0.0-0`:isX(c)?`<${p}.${+l+1}.0-0`:$?`<=${p}.${l}.${c}-${$}`:e?`<${p}.${l}.${+c+1}-0`:`<=${E}`}`.trim(),testSet=(e,r,t)=>{for(let t=0;t<e.length;t++)if(!e[t].test(r))return!1;if(r.prerelease.length&&!t.includePrerelease){for(let t=0;t<e.length;t++)if(debug_1(e[t].semver),e[t].semver!==Comparator.ANY&&e[t].semver.prerelease.length>0){const s=e[t].semver;if(s.major===r.major&&s.minor===r.minor&&s.patch===r.patch)return!0}return!1}return!0};export const satisfies=(e,r,t)=>{try{r=new Range(r,t)}catch(e){return!1}return r.test(e)};const satisfies_1=satisfies,{MAX_LENGTH:MAX_LENGTH}=constants,{re:re$1,t:t$1}=re_1,parse=(e,r)=>{if(r&&\"object\"==typeof r||(r={loose:!!r,includePrerelease:!1}),e instanceof SemVer)return e;if(\"string\"!=typeof e)return null;if(e.length>MAX_LENGTH)return null;if(!(r.loose?re$1[t$1.LOOSE]:re$1[t$1.FULL]).test(e))return null;try{return new SemVer(e,r)}catch(e){return null}},parse_1=parse,{re:re,t:t}=re_1;export const coerce=(e,r)=>{if(e instanceof SemVer)return e;if(\"number\"==typeof e&&(e=String(e)),\"string\"!=typeof e)return null;let s=null;if((r=r||{}).rtl){let r;for(;(r=re[t.COERCERTL].exec(e))&&(!s||s.index+s[0].length!==e.length);)s&&r.index+r[0].length===s.index+s[0].length||(s=r),re[t.COERCERTL].lastIndex=r.index+r[1].length+r[2].length;re[t.COERCERTL].lastIndex=-1}else s=e.match(re[t.COERCE]);return null===s?null:parse_1(`${s[2]}.${s[3]||\"0\"}.${s[4]||\"0\"}`,r)};\n","function percentToByte(p: string) {\n  return String.fromCharCode(parseInt(p.slice(1), 16));\n}\n\nfunction byteToPercent(b: string) {\n  return `%${`00${b.charCodeAt(0).toString(16)}`.slice(-2)}`;\n}\n\n/**\n * Encodes a Base64 string. Safe for UTF-8 characters.\n * Original source is from the `universal-base64` NPM package.\n *\n * @source https://github.com/blakeembrey/universal-base64/blob/master/src/browser.ts\n */\nfunction btoaUTF8(str: string): string {\n  return btoa(encodeURIComponent(str).replace(/%[0-9A-F]{2}/g, percentToByte));\n}\n\n/**\n * Decodes a Base64 string. Safe for UTF-8 characters.\n * Original source is from the `universal-base64` NPM package.\n *\n * @source https://github.com/blakeembrey/universal-base64/blob/master/src/browser.ts\n */\nfunction atobUTF8(str: string): string {\n  return decodeURIComponent(Array.from(atob(str), byteToPercent).join(''));\n}\n\n/**\n * Given a JSON-serializable object, encode as a Base64 string.\n */\nexport function encodeJSON<T>(options: T): string {\n  return btoaUTF8(JSON.stringify(options));\n}\n\n/**\n * Given a Base64 JSON string, decode a JavaScript object.\n */\nexport function decodeJSON<T>(queryString: string): T {\n  return JSON.parse(atobUTF8(queryString));\n}\n","import { JsonRpcError, RPCErrorCode, SDKErrorCode, SDKWarningCode } from '@magic-sdk/types';\nimport { isJsonRpcErrorCode } from '../util/type-guards';\nimport { SDKEnvironment } from './sdk-environment';\nimport { Extension } from '../modules/base-extension';\n\n// --- Error/warning classes\n\n/**\n * This error type represents internal SDK errors. This could be developer\n * mistakes (or Magic's mistakes), or execution errors unrelated to standard\n * JavaScript exceptions.\n */\nexport class MagicSDKError extends Error {\n  __proto__ = Error;\n\n  constructor(public code: SDKErrorCode, public rawMessage: string) {\n    super(`Magic SDK Error: [${code}] ${rawMessage}`);\n    Object.setPrototypeOf(this, MagicSDKError.prototype);\n  }\n}\n\n/**\n * This error type communicates exceptions that occur during execution in the\n * Magic `<iframe>` context.\n */\nexport class MagicRPCError extends Error {\n  __proto__ = Error;\n\n  public code: RPCErrorCode | number;\n  public rawMessage: string;\n\n  constructor(sourceError?: JsonRpcError | null) {\n    super();\n\n    const codeNormalized = Number(sourceError?.code);\n    this.rawMessage = sourceError?.message || 'Internal error';\n    this.code = isJsonRpcErrorCode(codeNormalized) ? codeNormalized : RPCErrorCode.InternalError;\n    this.message = `Magic RPC Error: [${this.code}] ${this.rawMessage}`;\n\n    Object.setPrototypeOf(this, MagicRPCError.prototype);\n  }\n}\n\n/**\n * In contrast to `SDKError` objects, this \"warning\" type communicates important\n * context that does not rise to the level of an exception. These should be\n * logged rather than thrown.\n */\nexport class MagicSDKWarning {\n  public message: string;\n\n  constructor(public code: SDKWarningCode, public rawMessage: string) {\n    this.message = `Magic SDK Warning: [${code}] ${rawMessage}`;\n  }\n\n  /**\n   * Logs this warning to the console.\n   */\n  public log() {\n    console.warn(this.message);\n  }\n}\n\n/**\n * This error type is reserved for communicating errors that arise during\n * execution of Magic SDK Extension methods. Compare this to the `SDKError`\n * type, specifically in context of Extensions.\n */\nexport class MagicExtensionError<TData = any> extends Error {\n  __proto__ = Error;\n\n  constructor(ext: Extension<string>, public code: string | number, public rawMessage: string, public data: TData) {\n    super(`Magic Extension Error (${ext.name}): [${code}] ${rawMessage}`);\n    Object.setPrototypeOf(this, MagicExtensionError.prototype);\n  }\n}\n\n/**\n * In contrast to `MagicExtensionError` objects, this \"warning\" type\n * communicates important context that does not rise to the level of an\n * exception. These should be logged rather than thrown.\n */\nexport class MagicExtensionWarning {\n  public message: string;\n\n  constructor(ext: Extension<string>, public code: string | number, public rawMessage: string) {\n    this.message = `Magic Extension Warning (${ext.name}): [${code}] ${rawMessage}`;\n  }\n\n  /**\n   * Logs this warning to the console.\n   */\n  public log() {\n    console.warn(this.message);\n  }\n}\n\n// --- SDK error factories\n\nexport function createMissingApiKeyError() {\n  return new MagicSDKError(\n    SDKErrorCode.MissingApiKey,\n    'Please provide an API key that you acquired from the Magic developer dashboard.',\n  );\n}\n\nexport function createModalNotReadyError() {\n  return new MagicSDKError(SDKErrorCode.ModalNotReady, 'Modal is not ready.');\n}\n\nexport function createMalformedResponseError() {\n  return new MagicSDKError(SDKErrorCode.MalformedResponse, 'Response from the Magic iframe is malformed.');\n}\n\nexport function createExtensionNotInitializedError(member: string) {\n  return new MagicSDKError(\n    SDKErrorCode.ExtensionNotInitialized,\n    `Extensions must be initialized with a Magic SDK instance before \\`Extension.${member}\\` can be accessed. Do not invoke \\`Extension.${member}\\` inside an extension constructor.`,\n  );\n}\n\nexport function createIncompatibleExtensionsError(extensions: Extension<string>[]) {\n  let msg = `Some extensions are incompatible with \\`${SDKEnvironment.sdkName}@${SDKEnvironment.version}\\`:`;\n\n  extensions\n    .filter((ext) => typeof ext.compat !== 'undefined' && ext.compat !== null)\n    .forEach((ext) => {\n      const compat = ext.compat![SDKEnvironment.sdkName];\n\n      /* istanbul ignore else */\n      if (typeof compat === 'string') {\n        msg += `\\n  - Extension \\`${ext.name}\\` supports version(s) \\`${compat}\\``;\n      } else if (!compat) {\n        msg += `\\n  - Extension \\`${ext.name}\\` does not support ${SDKEnvironment.platform} environments.`;\n      }\n\n      // Else case is irrelevant here here\n      // (we filter out extensions with missing `compat` field)\n    });\n\n  return new MagicSDKError(SDKErrorCode.IncompatibleExtensions, msg);\n}\n\nexport function createInvalidArgumentError(options: {\n  procedure: string;\n  argument: number;\n  expected: string;\n  received: string;\n}) {\n  /**\n   * Parses the argument index (given by `argument`) to attach the correct ordinal suffix.\n   * (i.e.: 1st, 2nd, 3rd, 4th, etc.)\n   */\n  const ordinalSuffix = (i: number) => {\n    const iAdjusted = i + 1; // Argument is zero-indexed.\n    const j = iAdjusted % 10;\n    const k = iAdjusted % 100;\n    if (j === 1 && k !== 11) return `${iAdjusted}st`;\n    if (j === 2 && k !== 12) return `${iAdjusted}nd`;\n    if (j === 3 && k !== 13) return `${iAdjusted}rd`;\n    return `${iAdjusted}th`;\n  };\n\n  return new MagicSDKError(\n    SDKErrorCode.InvalidArgument,\n    `Invalid ${ordinalSuffix(options.argument)} argument given to \\`${options.procedure}\\`.\\n` +\n      `  Expected: \\`${options.expected}\\`\\n` +\n      `  Received: \\`${options.received}\\``,\n  );\n}\n\n// --- SDK warning factories\n\nexport function createDuplicateIframeWarning() {\n  return new MagicSDKWarning(SDKWarningCode.DuplicateIframe, 'Duplicate iframes found.');\n}\n\nexport function createSynchronousWeb3MethodWarning() {\n  return new MagicSDKWarning(\n    SDKWarningCode.SyncWeb3Method,\n    'Non-async web3 methods are deprecated in web3 > 1.0 and are not supported by the Magic web3 provider. Please use an async method instead.',\n  );\n}\n\nexport function createReactNativeEndpointConfigurationWarning() {\n  return new MagicSDKWarning(\n    SDKWarningCode.ReactNativeEndpointConfiguration,\n    `CUSTOM DOMAINS ARE NOT SUPPORTED WHEN USING MAGIC SDK WITH REACT NATIVE! The \\`endpoint\\` parameter SHOULD NOT be provided. The Magic \\`<iframe>\\` is automatically wrapped by a WebView pointed at \\`${SDKEnvironment.defaultEndpoint}\\`. Changing this default behavior will lead to unexpected results and potentially security-threatening bugs.`,\n  );\n}\n\nexport function createDeprecationWarning(options: {\n  method: string;\n  removalVersions: { [P in 'magic-sdk' | '@magic-sdk/react-native']: string };\n  useInstead?: string;\n}) {\n  const { method, removalVersions, useInstead } = options;\n\n  const removalVersion = removalVersions[SDKEnvironment.sdkName];\n  const useInsteadSuffix = useInstead ? ` Use \\`${useInstead}\\` instead.` : '';\n  const message = `\\`${method}\\` will be removed from \\`${SDKEnvironment.sdkName}\\` in version \\`${removalVersion}\\`.${useInsteadSuffix}`;\n\n  return new MagicSDKWarning(SDKWarningCode.DeprecationNotice, message);\n}\n","/**\n * This file contains our type guards.\n *\n * Type guards are a feature of TypeScript which narrow the type signature of\n * intesection types (types that can be one thing or another).\n *\n * @see\n * https://www.typescriptlang.org/docs/handbook/advanced-types.html#type-guards-and-differentiating-types\n */\n\nimport { JsonRpcRequestPayload, JsonRpcResponsePayload, MagicPayloadMethod, RPCErrorCode } from '@magic-sdk/types';\n\n/**\n * Assert `value` is `undefined`.\n */\nfunction isUndefined(value: any): value is undefined {\n  return typeof value === 'undefined';\n}\n\n/**\n * Assert `value` is `null`.\n */\nfunction isNull(value: any): value is null {\n  return value === null;\n}\n\n/**\n * Assert `value` is `null` or `undefined`.\n */\nfunction isNil(value: any): value is null | undefined {\n  return isNull(value) || isUndefined(value);\n}\n\n/**\n * Assert `value` is a `JsonRpcRequestPayload` object.\n */\nexport function isJsonRpcRequestPayload(value?: JsonRpcRequestPayload): value is JsonRpcRequestPayload {\n  if (isNil(value)) return false;\n  return (\n    !isUndefined(value.jsonrpc) && !isUndefined(value.id) && !isUndefined(value.method) && !isUndefined(value.params)\n  );\n}\n\n/**\n * Assert `value` is a `JsonRpcResponsePayload` object.\n */\nexport function isJsonRpcResponsePayload(value: any): value is JsonRpcResponsePayload {\n  if (isNil(value)) return false;\n  return (\n    !isUndefined(value.jsonrpc) && !isUndefined(value.id) && (!isUndefined(value.result) || !isUndefined(value.error))\n  );\n}\n\n/**\n * Assert `value` is a Magic SDK payload method identifier.\n */\nexport function isMagicPayloadMethod(value?: any): value is MagicPayloadMethod {\n  if (isNil(value)) return false;\n  return typeof value === 'string' && Object.values(MagicPayloadMethod).includes(value as any);\n}\n\n/**\n * Assert `value` is an expected JSON RPC error code.\n */\nexport function isJsonRpcErrorCode(value?: any): value is RPCErrorCode {\n  if (isNil(value)) return false;\n  return typeof value === 'number' && Object.values(RPCErrorCode).includes(value);\n}\n\n/**\n * Assert `value` is an empty, plain object.\n */\nexport function isEmpty(value?: any): value is {} {\n  if (!value) return true;\n\n  for (const key in value) {\n    /* istanbul ignore else */\n    if (Object.hasOwnProperty.call(value, key)) {\n      return false;\n    }\n  }\n\n  return true;\n}\n","import type localForage from 'localforage';\nimport type { ViewController } from './view-controller';\nimport type { SDKBase } from './sdk';\nimport type { WithExtensions } from '../modules/base-extension';\n\ntype ConstructorOf<C> = { new (...args: any[]): C };\n\n/**\n * A structure containing details about the current environment.\n * This is guaranteed to be populated before the SDK is instantiated.\n */\nexport interface SDKEnvironment {\n  sdkName: 'magic-sdk' | '@magic-sdk/react-native';\n  version: string;\n  platform: 'web' | 'react-native';\n  defaultEndpoint: string;\n  ViewController: ConstructorOf<ViewController>;\n  configureStorage: () => Promise<typeof localForage>;\n}\n\nexport const SDKEnvironment: SDKEnvironment = {} as any;\n\nexport function createSDK<SDK extends SDKBase>(\n  SDKBaseCtor: ConstructorOf<SDK>,\n  environment: SDKEnvironment,\n): WithExtensions<SDK> {\n  Object.assign(SDKEnvironment, environment);\n  return SDKBaseCtor as any;\n}\n\nexport const sdkNameToEnvName = {\n  'magic-sdk': 'magic-sdk' as const,\n  '@magic-sdk/react-native': 'magic-sdk-rn' as const,\n};\n","import { MagicPayloadMethod, LoginWithMagicLinkConfiguration, LoginWithSmsConfiguration } from '@magic-sdk/types';\nimport { BaseModule } from './base-module';\nimport { createJsonRpcRequestPayload } from '../core/json-rpc';\nimport { SDKEnvironment } from '../core/sdk-environment';\n\ntype LoginWithMagicLinkEvents = {\n  'email-sent': () => void;\n  'email-not-deliverable': () => void;\n  retry: () => void;\n};\n\nexport class AuthModule extends BaseModule {\n  /**\n   * Initiate the \"magic link\" login flow for a user. If the flow is successful,\n   * this method will return a Decentralized ID token (with a default lifespan\n   * of 15 minutes).\n   */\n  public loginWithMagicLink(configuration: LoginWithMagicLinkConfiguration) {\n    const { email, showUI = true, redirectURI } = configuration;\n\n    const requestPayload = createJsonRpcRequestPayload(\n      this.sdk.testMode ? MagicPayloadMethod.LoginWithMagicLinkTestMode : MagicPayloadMethod.LoginWithMagicLink,\n      [{ email, showUI, redirectURI }],\n    );\n    return this.request<string | null, LoginWithMagicLinkEvents>(requestPayload);\n  }\n\n  /**\n   * Initiate an SMS login flow for a user. If successful,\n   * this method will return a Decenteralized ID token (with a default lifespan\n   * of 15 minutes)\n   */\n  public loginWithSMS(configuration: LoginWithSmsConfiguration) {\n    const { phoneNumber } = configuration;\n    const requestPayload = createJsonRpcRequestPayload(\n      this.sdk.testMode ? MagicPayloadMethod.LoginWithSmsTestMode : MagicPayloadMethod.LoginWithSms,\n      [{ phoneNumber, showUI: true }],\n    );\n    return this.request<string | null>(requestPayload);\n  }\n\n  /**\n   * Log a user in with a special one-time-use credential token. This is\n   * currently used during magic link flows with a configured redirect to\n   * hydrate the user session at the end of the flow. If the flow is successful,\n   * this method will return a Decentralized ID token (with a default lifespan\n   * of 15 minutes).\n   *\n   * If no argument is provided, a credential is automatically parsed from\n   * `window.location.search`.\n   */\n  public loginWithCredential(credentialOrQueryString?: string) {\n    let credentialResolved = credentialOrQueryString ?? '';\n\n    if (!credentialOrQueryString && SDKEnvironment.platform === 'web') {\n      credentialResolved = window.location.search;\n\n      // Remove the query from the redirect callback as a precaution.\n      const urlWithoutQuery = window.location.origin + window.location.pathname;\n      window.history.replaceState(null, '', urlWithoutQuery);\n    }\n\n    const requestPayload = createJsonRpcRequestPayload(\n      this.sdk.testMode ? MagicPayloadMethod.LoginWithCredentialTestMode : MagicPayloadMethod.LoginWithCredential,\n      [credentialResolved],\n    );\n\n    return this.request<string | null>(requestPayload);\n  }\n}\n","import { JsonRpcRequestPayload, MagicOutgoingWindowMessage, MagicIncomingWindowMessage } from '@magic-sdk/types';\nimport { createMalformedResponseError, MagicRPCError } from '../core/sdk-exceptions';\nimport type { SDKBase } from '../core/sdk';\nimport { standardizeJsonRpcRequestPayload } from '../core/json-rpc';\nimport { createPromiEvent } from '../util/promise-tools';\nimport type { ViewController } from '../core/view-controller';\nimport type { EventsDefinition } from '../util/events';\n\nexport class BaseModule {\n  constructor(protected sdk: SDKBase) {}\n\n  /**\n   * The `ViewController` for the SDK instance registered to this module.\n   */\n  protected get overlay(): ViewController {\n    return (this.sdk as any).overlay;\n  }\n\n  /**\n   * Emits promisified requests to the Magic `<iframe>` context.\n   */\n  protected request<ResultType = any, Events extends EventsDefinition = void>(payload: Partial<JsonRpcRequestPayload>) {\n    const responsePromise = this.overlay.post<ResultType>(\n      MagicOutgoingWindowMessage.MAGIC_HANDLE_REQUEST,\n      standardizeJsonRpcRequestPayload(payload),\n    );\n\n    // PromiEvent-ify the response.\n    const promiEvent = createPromiEvent<ResultType, Events>((resolve, reject) => {\n      responsePromise\n        .then((res) => {\n          cleanupEvents();\n          if (res.hasError) reject(new MagicRPCError(res.payload.error));\n          else if (res.hasResult) resolve(res.payload.result as ResultType);\n          else throw createMalformedResponseError();\n        })\n        .catch((err) => {\n          cleanupEvents();\n          reject(err);\n        });\n    });\n\n    // Listen for events from the `<iframe>` associated with the current payload\n    // and emit those to `PromiEvent` subscribers.\n    const cleanupEvents = this.overlay.on(MagicIncomingWindowMessage.MAGIC_HANDLE_EVENT, (evt) => {\n      const { response } = evt.data;\n\n      if (response.id === payload.id && response.result?.event) {\n        const { event, params = [] } = response.result;\n        promiEvent.emit(event, ...params);\n      }\n    });\n\n    return promiEvent;\n  }\n}\n","function* createIntGenerator(): Generator<number, number, void> {\n  let index = 0;\n\n  while (true) {\n    /* istanbul ignore next */\n    if (index < Number.MAX_SAFE_INTEGER) yield ++index;\n    else index = 0;\n  }\n}\n\nconst intGenerator = createIntGenerator();\n\n/**\n * Get an integer ID for attaching to a JSON RPC request payload.\n */\nexport function getPayloadId(): number {\n  return intGenerator.next().value;\n}\n","/* eslint-disable no-param-reassign */\n\nimport { JsonRpcRequestPayload, JsonRpcResponsePayload, JsonRpcError } from '@magic-sdk/types';\nimport { isJsonRpcResponsePayload } from '../util/type-guards';\nimport { getPayloadId } from '../util/get-payload-id';\n\nconst payloadPreprocessedSymbol = Symbol('Payload pre-processed by Magic SDK');\n\n/**\n * To avoid \"pre-processing\" a payload more than once (and needlessly\n * incrementing our payload ID generator), we attach a symbol to detect a\n * payloads we've already visited.\n */\nfunction markPayloadAsPreprocessed<T extends Partial<JsonRpcRequestPayload>>(payload: T): T {\n  Object.defineProperty(payload, payloadPreprocessedSymbol, {\n    value: true,\n    enumerable: false,\n  });\n\n  return payload;\n}\n\n/**\n * Returns `true` if the payload has been visited by our \"pre-processing,\" in\n * `standardizeJsonRpcRequestPayload(...)`.\n */\nfunction isPayloadPreprocessed<T extends Partial<JsonRpcRequestPayload>>(payload: T) {\n  return !!(payload as any)[payloadPreprocessedSymbol];\n}\n\n/**\n * Returns a full `JsonRpcRequestPayload` from a potentially incomplete payload\n * object. This method mutates the given `payload` to preserve compatibility\n * with external libraries that perform their own `JsonRpcRequestPayload.id`\n * check to associate responses (such as `web3`).\n *\n * This function is no-op if the payload has already been processed before.\n */\nexport function standardizeJsonRpcRequestPayload(payload: Partial<JsonRpcRequestPayload>) {\n  if (!isPayloadPreprocessed(payload)) {\n    payload.jsonrpc = payload.jsonrpc ?? '2.0';\n    payload.id = getPayloadId();\n    payload.method = payload.method ?? 'noop';\n    payload.params = payload.params ?? [];\n\n    markPayloadAsPreprocessed(payload);\n  }\n\n  /* eslint-disable-next-line @typescript-eslint/no-unnecessary-type-assertion */\n  return payload as JsonRpcRequestPayload;\n}\n\n/**\n * Build a valid JSON RPC payload for emitting to the Magic SDK iframe relayer.\n */\nexport function createJsonRpcRequestPayload(method: string, params: any[] = []): JsonRpcRequestPayload {\n  return markPayloadAsPreprocessed({\n    params,\n    method,\n    jsonrpc: '2.0',\n    id: getPayloadId(),\n  });\n}\n\n/**\n * Formats and standardizes a JSON RPC 2.0 response from a number of potential\n * sources.\n */\nexport class JsonRpcResponse<ResultType = any> {\n  private readonly _jsonrpc: string;\n  private readonly _id: string | number | null;\n  private _result?: ResultType | null;\n  private _error?: JsonRpcError | null;\n\n  constructor(responsePayload: JsonRpcResponsePayload);\n  constructor(response: JsonRpcResponse<ResultType>);\n  constructor(requestPayload: JsonRpcRequestPayload);\n  constructor(responseOrPayload: JsonRpcResponsePayload | JsonRpcResponse<ResultType> | JsonRpcRequestPayload) {\n    if (responseOrPayload instanceof JsonRpcResponse) {\n      this._jsonrpc = responseOrPayload.payload.jsonrpc;\n      this._id = responseOrPayload.payload.id;\n      this._result = responseOrPayload.payload.result;\n      this._error = responseOrPayload.payload.error;\n    } else if (isJsonRpcResponsePayload(responseOrPayload)) {\n      this._jsonrpc = responseOrPayload.jsonrpc;\n      this._id = responseOrPayload.id;\n      this._result = responseOrPayload.result;\n      this._error = responseOrPayload.error;\n    } else {\n      this._jsonrpc = responseOrPayload.jsonrpc;\n      this._id = responseOrPayload.id;\n      this._result = undefined;\n      this._error = undefined;\n    }\n  }\n\n  public applyError(error?: JsonRpcError | null) {\n    this._error = error;\n    return this;\n  }\n\n  public applyResult(result?: ResultType | null) {\n    this._result = result;\n    return this;\n  }\n\n  public get hasError() {\n    return typeof this._error !== 'undefined' && this._error !== null;\n  }\n\n  public get hasResult() {\n    return typeof this._result !== 'undefined';\n  }\n\n  public get payload(): JsonRpcResponsePayload {\n    return {\n      jsonrpc: this._jsonrpc,\n      id: this._id,\n      result: this._result,\n      error: this._error,\n    };\n  }\n}\n","import EventEmitter from 'eventemitter3';\n\nexport type EventsDefinition = { [K in string | symbol]: (...args: any[]) => void } | void;\n\n/**\n * An extension of `EventEmitter` (provided by `eventemitter3`) with an adjusted\n * type interface that supports the unique structure of Magic SDK modules.\n */\nexport class TypedEmitter<Events extends EventsDefinition = void> extends EventEmitter<\n  Events extends void ? string | symbol : Events\n> {}\n\ntype ChainingMethods = 'on' | 'once' | 'addListener' | 'off' | 'removeListener' | 'removeAllListeners';\ntype NonChainingMethods = 'emit' | 'eventNames' | 'listeners' | 'listenerCount';\n\ntype ReplaceReturnType<T extends (...a: any) => any, TNewReturn> = (...a: Parameters<T>) => TNewReturn;\n\n/**\n * Creates a `TypedEmitter` instance and returns helper functions for easily\n * mixing `TypedEmitter` methods into other objects.\n */\nexport function createTypedEmitter<Events extends EventsDefinition = void>() {\n  const emitter = new TypedEmitter<Events>();\n\n  const createChainingEmitterMethod = <T1 extends ChainingMethods, T2>(\n    method: T1,\n    source: T2,\n  ): ReplaceReturnType<TypedEmitter[T1], T2> => {\n    return (...args: any[]) => {\n      (emitter as any)[method].apply(emitter, args);\n      return source;\n    };\n  };\n\n  const createBoundEmitterMethod = <T extends NonChainingMethods>(method: T): TypedEmitter[T] => {\n    return (...args: any[]) => {\n      return (emitter as any)[method].apply(emitter, args);\n    };\n  };\n\n  return {\n    emitter,\n    createChainingEmitterMethod,\n    createBoundEmitterMethod,\n  };\n}\n","import { TypedEmitter, EventsDefinition, createTypedEmitter } from './events';\n\n/**\n * Extends `Promise` with a polymorphic `this` type to accomodate arbitrary\n * `Promise` API extensions.\n */\ninterface ExtendedPromise<T> extends Promise<T> {\n  then<TResult1 = T, TResult2 = never>(\n    onfulfilled?: ((value: T) => TResult1 | PromiseLike<TResult1>) | undefined | null,\n    onrejected?: ((reason: any) => TResult2 | PromiseLike<TResult2>) | undefined | null,\n  ): ExtendedPromise<TResult1 | TResult2> & this;\n\n  catch<TResult = never>(\n    onrejected?: ((reason: any) => TResult | PromiseLike<TResult>) | undefined | null,\n  ): ExtendedPromise<T | TResult> & this;\n\n  finally(onfinally?: (() => void) | undefined | null): ExtendedPromise<T> & this;\n}\n\n/**\n * A `Promise` and `EventEmitter` all in one!\n */\nexport type PromiEvent<TResult, TEvents extends EventsDefinition = void> = ExtendedPromise<TResult> &\n  TypedEmitter<TEvents extends void ? DefaultEvents<TResult> : TEvents & DefaultEvents<TResult>>;\n\n/**\n * Default events attached to every `PromiEvent`.\n */\ntype DefaultEvents<TResult> = {\n  done: (result: TResult) => void;\n  error: (reason: any) => void;\n  settled: () => void;\n};\n\n/**\n * A `Promise` executor with can be optionally asynchronous.\n */\ntype AsyncPromiseExecutor<TResult> = (\n  resolve: (value: TResult | PromiseLike<TResult>) => void,\n  reject: (reason?: any) => void,\n) => void | Promise<void>;\n\nconst promiEventBrand = Symbol('isPromiEvent');\n\n/**\n * Returns `true` if the given `value` is a `PromiEvent`.\n */\nexport function isPromiEvent(value: any): value is PromiEvent<any> {\n  return !!value[promiEventBrand];\n}\n\n/**\n * Create a native JavaScript `Promise` overloaded with strongly-typed methods\n * from `EventEmitter`.\n */\nexport function createPromiEvent<TResult, TEvents extends EventsDefinition = void>(\n  executor: AsyncPromiseExecutor<TResult>,\n): PromiEvent<TResult, TEvents extends void ? DefaultEvents<TResult> : TEvents & DefaultEvents<TResult>> {\n  const promise = createPromise(executor);\n  const { createBoundEmitterMethod, createChainingEmitterMethod } = createTypedEmitter<\n    TEvents & DefaultEvents<TResult>\n  >();\n\n  // We save the original `Promise` methods to the following symbols so we can\n  // access them internally.\n  const thenSymbol = Symbol('Promise.then');\n  const catchSymbol = Symbol('Promise.catch');\n  const finallySymbol = Symbol('Promise.finally');\n\n  /**\n   * Ensures the next object in the `PromiEvent` chain is overloaded with\n   * `EventEmitter` methods.\n   */\n  const createChainingPromiseMethod =\n    (method: typeof thenSymbol | typeof catchSymbol | typeof finallySymbol, source: Promise<any>) =>\n    (...args: any[]) => {\n      const nextPromise = (source as any)[method].apply(source, args);\n      return promiEvent(nextPromise);\n    };\n\n  /**\n   * Builds a `PromiEvent` by assigning `EventEmitter` methods to a native\n   * `Promise` object.\n   */\n  const promiEvent = (source: any) => {\n    return Object.assign(source, {\n      [promiEventBrand]: true,\n\n      [thenSymbol]: source[thenSymbol] || source.then,\n      [catchSymbol]: source[catchSymbol] || source.catch,\n      [finallySymbol]: source[finallySymbol] || source.finally,\n\n      then: createChainingPromiseMethod(thenSymbol, source),\n      catch: createChainingPromiseMethod(catchSymbol, source),\n      finally: createChainingPromiseMethod(finallySymbol, source),\n\n      on: createChainingEmitterMethod('on', source),\n      once: createChainingEmitterMethod('once', source),\n      addListener: createChainingEmitterMethod('addListener', source),\n\n      off: createChainingEmitterMethod('off', source),\n      removeListener: createChainingEmitterMethod('removeListener', source),\n      removeAllListeners: createChainingEmitterMethod('removeAllListeners', source),\n\n      emit: createBoundEmitterMethod('emit'),\n      eventNames: createBoundEmitterMethod('eventNames'),\n      listeners: createBoundEmitterMethod('listeners'),\n      listenerCount: createBoundEmitterMethod('listenerCount'),\n    });\n  };\n\n  const result = promiEvent(\n    promise.then(\n      (resolved) => {\n        // Emit default completion events and resolve result.\n        result.emit('done', resolved);\n        result.emit('settled');\n        return resolved;\n      },\n\n      (err) => {\n        // Emit default error events and re-throw.\n        result.emit('error', err);\n        result.emit('settled');\n        throw err;\n      },\n    ),\n  );\n\n  return result;\n}\n\n/**\n * Creates a `Promise` with an **async executor** that automatically catches\n * errors occurring within the executor. Nesting promises in this way is usually\n * deemed an _anti-pattern_, but it's useful and clean when promisifying the\n * event-based code that's inherent to JSON RPC.\n *\n * So, here we solve the issue of nested promises by ensuring that no errors\n * mistakenly go unhandled!\n */\nexport function createPromise<TResult>(executor: AsyncPromiseExecutor<TResult>) {\n  return new Promise<TResult>((resolve, reject) => {\n    const result = executor(resolve, reject);\n    Promise.resolve(result).catch(reject);\n  });\n}\n","import {\n  GetIdTokenConfiguration,\n  MagicPayloadMethod,\n  MagicUserMetadata,\n  GenerateIdTokenConfiguration,\n  UpdateEmailConfiguration,\n} from '@magic-sdk/types';\nimport { BaseModule } from './base-module';\nimport { createJsonRpcRequestPayload } from '../core/json-rpc';\nimport { clearKeys } from '../util/web-crypto';\n\ntype UpdateEmailEvents = {\n  'email-sent': () => void;\n  'email-not-deliverable': () => void;\n  'old-email-confirmed': () => void;\n  'new-email-confirmed': () => void;\n  retry: () => void;\n};\n\nexport class UserModule extends BaseModule {\n  /** */\n  public getIdToken(configuration?: GetIdTokenConfiguration) {\n    const requestPayload = createJsonRpcRequestPayload(\n      this.sdk.testMode ? MagicPayloadMethod.GetIdTokenTestMode : MagicPayloadMethod.GetIdToken,\n      [configuration],\n    );\n    return this.request<string>(requestPayload);\n  }\n\n  /** */\n  public generateIdToken(configuration?: GenerateIdTokenConfiguration) {\n    const requestPayload = createJsonRpcRequestPayload(\n      this.sdk.testMode ? MagicPayloadMethod.GenerateIdTokenTestMode : MagicPayloadMethod.GenerateIdToken,\n      [configuration],\n    );\n    return this.request<string>(requestPayload);\n  }\n\n  /** */\n  public getMetadata() {\n    const requestPayload = createJsonRpcRequestPayload(\n      this.sdk.testMode ? MagicPayloadMethod.GetMetadataTestMode : MagicPayloadMethod.GetMetadata,\n    );\n    return this.request<MagicUserMetadata>(requestPayload);\n  }\n\n  /** */\n  public updateEmail(configuration: UpdateEmailConfiguration) {\n    const { email, showUI = true } = configuration;\n    const requestPayload = createJsonRpcRequestPayload(\n      this.sdk.testMode ? MagicPayloadMethod.UpdateEmailTestMode : MagicPayloadMethod.UpdateEmail,\n      [{ email, showUI }],\n    );\n    return this.request<string | null, UpdateEmailEvents>(requestPayload);\n  }\n\n  /** */\n  public isLoggedIn() {\n    const requestPayload = createJsonRpcRequestPayload(\n      this.sdk.testMode ? MagicPayloadMethod.IsLoggedInTestMode : MagicPayloadMethod.IsLoggedIn,\n    );\n    return this.request<boolean>(requestPayload);\n  }\n\n  /** */\n  public logout() {\n    clearKeys();\n    const requestPayload = createJsonRpcRequestPayload(\n      this.sdk.testMode ? MagicPayloadMethod.LogoutTestMode : MagicPayloadMethod.Logout,\n    );\n    return this.request<boolean>(requestPayload);\n  }\n\n  /** */\n  public showSettings() {\n    const requestPayload = createJsonRpcRequestPayload(\n      this.sdk.testMode ? MagicPayloadMethod.UserSettingsTestMode : MagicPayloadMethod.UserSettings,\n    );\n    return this.request<MagicUserMetadata>(requestPayload);\n  }\n}\n","import { SDKEnvironment } from '../core/sdk-environment';\n\nlet lf: LocalForage;\n\n/**\n * Proxies `localforage` methods with strong-typing.\n */\nfunction proxyLocalForageMethod<TMethod extends keyof LocalForageDbMethods>(method: TMethod): LocalForage[TMethod] {\n  return async (...args: any[]) => {\n    /* istanbul ignore else */\n    if (!lf) lf = await SDKEnvironment.configureStorage();\n    await lf.ready();\n    return (lf[method] as any)(...args);\n  };\n}\n\nexport const getItem = proxyLocalForageMethod('getItem');\nexport const setItem = proxyLocalForageMethod('setItem');\nexport const removeItem = proxyLocalForageMethod('removeItem');\nexport const clear = proxyLocalForageMethod('clear');\nexport const length = proxyLocalForageMethod('length');\nexport const key = proxyLocalForageMethod('key');\nexport const keys = proxyLocalForageMethod('keys');\nexport const iterate = proxyLocalForageMethod('iterate');\n","/* eslint-disable no-bitwise */\nexport function uuid() {\n  const u = window.crypto.getRandomValues(new Uint8Array(16));\n\n  // set the version bit to v4\n  u[6] = (u[6] & 0x0f) | 0x40;\n\n  // set the variant bit to \"don't care\" (yes, the RFC\n  // calls it that)\n  u[8] = (u[8] & 0xbf) | 0x80;\n\n  // hex encode them and add the dashes\n  let uid = '';\n  uid += u[0].toString(16);\n  uid += u[1].toString(16);\n  uid += u[2].toString(16);\n  uid += u[3].toString(16);\n  uid += '-';\n\n  uid += u[4].toString(16);\n  uid += u[5].toString(16);\n  uid += '-';\n\n  uid += u[6].toString(16);\n  uid += u[7].toString(16);\n  uid += '-';\n\n  uid += u[8].toString(16);\n  uid += u[9].toString(16);\n  uid += '-';\n\n  uid += u[10].toString(16);\n  uid += u[11].toString(16);\n  uid += u[12].toString(16);\n  uid += u[13].toString(16);\n  uid += u[14].toString(16);\n  uid += u[15].toString(16);\n\n  return uid;\n}\n","import { setItem, getItem, removeItem } from './storage';\nimport { uuid } from './uuid';\n\nexport const STORE_KEY_PRIVATE_KEY = 'STORE_KEY_PRIVATE_KEY';\nexport const STORE_KEY_PUBLIC_JWK = 'STORE_KEY_PUBLIC_JWK';\nconst ALGO_NAME = 'ECDSA';\nconst ALGO_CURVE = 'P-256';\n\nconst EC_GEN_PARAMS: EcKeyGenParams = {\n  name: ALGO_NAME,\n  namedCurve: ALGO_CURVE,\n};\nconst EC_IMPORT_PARAMS: EcKeyImportParams = {\n  name: ALGO_NAME,\n  namedCurve: ALGO_CURVE,\n};\n\nexport function clearKeys() {\n  removeItem(STORE_KEY_PUBLIC_JWK);\n  removeItem(STORE_KEY_PRIVATE_KEY);\n}\n\nexport async function createJwt() {\n  // will return undefiend is webcrypto is not supported\n  const publicJwk = await getPublicKey();\n\n  if (!publicJwk) {\n    console.info('unable to create public key or webcrypto is unsupported');\n    return undefined;\n  }\n\n  const { subtle } = window.crypto;\n  const privateJwk = await getItem<CryptoKey>(STORE_KEY_PRIVATE_KEY);\n\n  if (!privateJwk || !subtle) {\n    console.info('unable to find private key or webcrypto unsupported');\n    return undefined;\n  }\n\n  const claims = {\n    iat: Math.floor(new Date().getTime() / 1000),\n    jti: uuid(),\n  };\n\n  const headers = {\n    typ: 'dpop+jwt',\n    alg: 'ES256',\n    jwk: publicJwk,\n  };\n\n  const jws = {\n    protected: strToUrlBase64(JSON.stringify(headers)),\n    claims: strToUrlBase64(JSON.stringify(claims)),\n  };\n\n  const data = strToUint8(`${jws.protected}.${jws.claims}`);\n  const sigType = { name: ALGO_NAME, hash: { name: 'SHA-256' } };\n\n  const sig = uint8ToUrlBase64(new Uint8Array(await subtle.sign(sigType, privateJwk, data)));\n  return `${jws.protected}.${jws.claims}.${sig}`;\n}\n\nasync function getPublicKey() {\n  if (!isWebCryptoSupported()) {\n    console.info('webcrypto is not supported');\n    return undefined;\n  }\n\n  if (!(await getItem(STORE_KEY_PUBLIC_JWK))) {\n    await generateWCKP();\n  }\n\n  return getItem(STORE_KEY_PUBLIC_JWK) as JsonWebKey;\n}\n\nasync function generateWCKP() {\n  // to avoid a nasty babel bug we have to hoist this above the await ourselves\n  // https://github.com/rpetrich/babel-plugin-transform-async-to-promises/issues/20\n  let jwkPublicKey = null;\n  const { subtle } = window.crypto;\n  const kp = await subtle.generateKey(\n    EC_GEN_PARAMS,\n    true, // need to export the public key which means private exports too\n    ['sign'],\n  );\n\n  // export keys so we can send the public key.\n  const jwkPrivateKey = await subtle.exportKey('jwk', kp.privateKey!);\n  jwkPublicKey = await subtle.exportKey('jwk', kp.publicKey!);\n\n  // reimport the private key so it becomes non exportable when persisting.\n  const nonExportPrivateKey = await subtle.importKey('jwk', jwkPrivateKey, EC_IMPORT_PARAMS, false, ['sign']);\n\n  // persist keys\n  await setItem(STORE_KEY_PRIVATE_KEY, nonExportPrivateKey);\n  // persist the jwk public key since it needs to be exported anyways\n  await setItem(STORE_KEY_PUBLIC_JWK, jwkPublicKey);\n}\n\nfunction isWebCryptoSupported() {\n  const hasCrypto = typeof window !== 'undefined' && !!(window.crypto as any);\n  const hasSubtleCrypto = hasCrypto && !!(window.crypto.subtle as any);\n\n  return hasCrypto && hasSubtleCrypto;\n}\n\nfunction strToUrlBase64(str: string) {\n  return binToUrlBase64(utf8ToBinaryString(str));\n}\n\nfunction strToUint8(str: string) {\n  return new TextEncoder().encode(str);\n}\n\nfunction binToUrlBase64(bin: string) {\n  return btoa(bin).replace(/\\+/g, '-').replace(/\\//g, '_').replace(/=+/g, '');\n}\n\nfunction utf8ToBinaryString(str: string) {\n  const escstr = encodeURIComponent(str);\n  // replaces any uri escape sequence, such as %0A,\n  // with binary escape, such as 0x0A\n  return escstr.replace(/%([0-9A-F]{2})/g, (_, p1) => String.fromCharCode(parseInt(p1, 16)));\n}\n\nfunction uint8ToUrlBase64(uint8: Uint8Array) {\n  let bin = '';\n  uint8.forEach((code) => {\n    bin += String.fromCharCode(code);\n  });\n  return binToUrlBase64(bin);\n}\n","/* eslint-disable consistent-return, prefer-spread */\n\nimport {\n  JsonRpcRequestPayload,\n  JsonRpcRequestCallback,\n  MagicOutgoingWindowMessage,\n  JsonRpcBatchRequestCallback,\n  JsonRpcResponsePayload,\n} from '@magic-sdk/types';\nimport { BaseModule } from './base-module';\nimport { createInvalidArgumentError, MagicRPCError, createSynchronousWeb3MethodWarning } from '../core/sdk-exceptions';\nimport { createJsonRpcRequestPayload, standardizeJsonRpcRequestPayload, JsonRpcResponse } from '../core/json-rpc';\nimport { PromiEvent } from '../util/promise-tools';\nimport { createTypedEmitter, EventsDefinition, TypedEmitter } from '../util/events';\n\nconst { createBoundEmitterMethod, createChainingEmitterMethod } = createTypedEmitter();\n\n/** */\nexport class RPCProviderModule extends BaseModule implements TypedEmitter {\n  // Implements EIP 1193:\n  // https://github.com/ethereum/EIPs/blob/master/EIPS/eip-1193.md\n\n  public readonly isMagic = true;\n\n  /* eslint-disable prettier/prettier */\n  public sendAsync(payload: Partial<JsonRpcRequestPayload>, onRequestComplete: JsonRpcRequestCallback): void;\n  public sendAsync(payload: Partial<JsonRpcRequestPayload>[], onRequestComplete: JsonRpcBatchRequestCallback): void;\n  public sendAsync(\n    payload: Partial<JsonRpcRequestPayload> | Partial<JsonRpcRequestPayload>[],\n    onRequestComplete: JsonRpcRequestCallback | JsonRpcBatchRequestCallback,\n  ): void;\n  /* eslint-enable prettier/prettier */\n  public sendAsync(\n    payload: Partial<JsonRpcRequestPayload> | Partial<JsonRpcRequestPayload>[],\n    onRequestComplete: JsonRpcRequestCallback | JsonRpcBatchRequestCallback,\n  ): void {\n    if (!onRequestComplete) {\n      throw createInvalidArgumentError({\n        procedure: 'Magic.rpcProvider.sendAsync',\n        argument: 1,\n        expected: 'function',\n        received: onRequestComplete === null ? 'null' : typeof onRequestComplete,\n      });\n    }\n\n    if (Array.isArray(payload)) {\n      this.overlay\n        .post(\n          MagicOutgoingWindowMessage.MAGIC_HANDLE_REQUEST,\n          payload.map((p) => {\n            const standardizedPayload = standardizeJsonRpcRequestPayload(p);\n            this.prefixPayloadMethodForTestMode(standardizedPayload);\n            return standardizedPayload;\n          }),\n        )\n        .then((batchResponse) => {\n          (onRequestComplete as JsonRpcBatchRequestCallback)(\n            null,\n            batchResponse.map((response) => ({\n              ...response.payload,\n              error: response.hasError ? new MagicRPCError(response.payload.error) : null,\n            })),\n          );\n        });\n    } else {\n      const finalPayload = standardizeJsonRpcRequestPayload(payload);\n      this.prefixPayloadMethodForTestMode(finalPayload);\n      this.overlay.post(MagicOutgoingWindowMessage.MAGIC_HANDLE_REQUEST, finalPayload).then((response) => {\n        (onRequestComplete as JsonRpcRequestCallback)(\n          response.hasError ? new MagicRPCError(response.payload.error) : null,\n          response.payload,\n        );\n      });\n    }\n  }\n\n  /* eslint-disable prettier/prettier */\n  public send<ResultType = any>(method: string, params?: any[]): PromiEvent<ResultType>;\n  public send(\n    payload: JsonRpcRequestPayload | JsonRpcRequestPayload[],\n    onRequestComplete: JsonRpcRequestCallback,\n  ): void;\n  public send<ResultType>(payload: JsonRpcRequestPayload, none: void): JsonRpcResponsePayload<ResultType>;\n  /* eslint-enable prettier/prettier */\n  public send<ResultType = any>(\n    payloadOrMethod: string | JsonRpcRequestPayload | JsonRpcRequestPayload[],\n    onRequestCompleteOrParams: JsonRpcRequestCallback | any[] | void,\n  ): PromiEvent<ResultType> | JsonRpcResponsePayload<ResultType> | void {\n    // Case #1\n    // Web3 >= 1.0.0-beta.38 calls `send` with method and parameters.\n    if (typeof payloadOrMethod === 'string') {\n      const payload = createJsonRpcRequestPayload(\n        payloadOrMethod,\n        Array.isArray(onRequestCompleteOrParams) ? onRequestCompleteOrParams : [],\n      );\n      return this.request(payload) as any;\n    }\n\n    // Case #2\n    // Web3 <= 1.0.0-beta.37 uses `send` with a callback for async queries.\n    if (Array.isArray(payloadOrMethod) || !!onRequestCompleteOrParams) {\n      /* eslint-disable-next-line @typescript-eslint/no-unnecessary-type-assertion */\n      this.sendAsync(payloadOrMethod, onRequestCompleteOrParams as any);\n      return;\n    }\n\n    // Case #3\n    // Legacy synchronous methods (unsupported).\n    const warning = createSynchronousWeb3MethodWarning();\n    warning.log();\n    return new JsonRpcResponse(payloadOrMethod).applyError({\n      code: -32603,\n      message: warning.rawMessage,\n    }).payload;\n  }\n\n  public enable() {\n    const requestPayload = createJsonRpcRequestPayload('eth_accounts');\n    return this.request<string[]>(requestPayload);\n  }\n\n  /**\n   * Here, we wrap `BaseModule.request` with an additional check\n   * to determine if the RPC method requires a test-mode prefix.\n   */\n  protected request<ResultType = any, Events extends EventsDefinition = void>(payload: Partial<JsonRpcRequestPayload>) {\n    this.prefixPayloadMethodForTestMode(payload);\n    return super.request<ResultType, Events>(payload);\n  }\n\n  /**\n   * Prefixes Ethereum RPC methods with a `testMode` identifier. This is done so\n   * that Magic's <iframe> can handle signing methods using test-specific keys.\n   */\n  private prefixPayloadMethodForTestMode(payload: Partial<JsonRpcRequestPayload>) {\n    const testModePrefix = 'testMode/eth/';\n\n    // In test mode, we prefix all RPC methods with `test/` so that the\n    // Magic <iframe> can handle them without requiring network calls.\n    if (this.sdk.testMode) {\n      // eslint-disable-next-line no-param-reassign\n      payload.method = `${testModePrefix}${payload.method}`;\n    }\n  }\n\n  public on = createChainingEmitterMethod('on', this);\n  public once = createChainingEmitterMethod('once', this);\n  public addListener = createChainingEmitterMethod('addListener', this);\n\n  public off = createChainingEmitterMethod('off', this);\n  public removeListener = createChainingEmitterMethod('removeListener', this);\n  public removeAllListeners = createChainingEmitterMethod('removeAllListeners', this);\n\n  public emit = createBoundEmitterMethod('emit');\n  public eventNames = createBoundEmitterMethod('eventNames');\n  public listeners = createBoundEmitterMethod('listeners');\n  public listenerCount = createBoundEmitterMethod('listenerCount');\n}\n","/**\n * Builds a `URL` object safely.\n */\nexport function createURL(url: string, base?: string): URL {\n  // Safari raises an error if `undefined` is given to the second argument of\n  // the `URL` constructor.\n  return base ? new URL(url, base) : new URL(url);\n}\n","import { createJsonRpcRequestPayload, standardizeJsonRpcRequestPayload } from '../core/json-rpc';\nimport { BaseModule } from './base-module';\nimport { SDKBase, MagicSDKAdditionalConfiguration, MagicSDKExtensionsOption } from '../core/sdk';\nimport { createExtensionNotInitializedError, MagicExtensionError, MagicExtensionWarning } from '../core/sdk-exceptions';\nimport { createPromiEvent, encodeJSON, decodeJSON, storage, isPromiEvent } from '../util';\n\ntype AnonymousExtension = 'anonymous extension';\n\ninterface BaseExtension<TName extends string = AnonymousExtension> extends BaseModule {\n  /**\n   * A structure describing the platform and version compatiblity of this\n   * extension.\n   */\n  compat?: {\n    'magic-sdk': boolean | string;\n    '@magic-sdk/react-native': boolean | string;\n  };\n}\n\nconst sdkAccessFields = ['request', 'overlay', 'sdk'];\n\n/**\n * From the `BaseExtension`-derived instance, get the prototype\n * chain up to and including the `BaseModule` class.\n */\nfunction getPrototypeChain<T extends BaseExtension<string>>(instance: T) {\n  let currentProto = Object.getPrototypeOf(instance);\n  const protos = [currentProto];\n\n  while (currentProto !== BaseModule.prototype) {\n    currentProto = Object.getPrototypeOf(currentProto);\n    protos.push(currentProto);\n  }\n\n  return protos;\n}\n\nabstract class BaseExtension<TName extends string = AnonymousExtension> extends BaseModule {\n  public abstract readonly name: TName;\n\n  private __sdk_access_field_descriptors__ = new Map<\n    string,\n    { descriptor: PropertyDescriptor; isPrototypeField: boolean }\n  >();\n  private __is_initialized__ = false;\n\n  protected utils = {\n    createPromiEvent,\n    isPromiEvent,\n    encodeJSON,\n    decodeJSON,\n    createJsonRpcRequestPayload,\n    standardizeJsonRpcRequestPayload,\n    storage,\n  };\n\n  constructor() {\n    super(undefined as any);\n\n    // Disallow SDK access before initialization...\n\n    const allSources = [this, ...getPrototypeChain(this)];\n\n    sdkAccessFields.forEach((prop) => {\n      const allDescriptors = allSources.map((source) => Object.getOwnPropertyDescriptor(source, prop));\n      const sourceIndex = allDescriptors.findIndex((x) => !!x);\n      const isPrototypeField = sourceIndex > 0;\n      const descriptor = allDescriptors[sourceIndex];\n\n      /* istanbul ignore else */\n      if (descriptor) {\n        this.__sdk_access_field_descriptors__.set(prop, { descriptor, isPrototypeField });\n\n        Object.defineProperty(this, prop, {\n          configurable: true,\n          get: () => {\n            throw createExtensionNotInitializedError(prop);\n          },\n        });\n      }\n    });\n  }\n\n  /**\n   * Registers a Magic SDK instance with this Extension.\n   *\n   * @internal\n   */\n  public init(sdk: SDKBase) {\n    if (this.__is_initialized__) return;\n\n    // Replace original property descriptors\n    // for SDK access fields post-initialization.\n    sdkAccessFields.forEach((prop) => {\n      /* istanbul ignore else */\n      if (this.__sdk_access_field_descriptors__.has(prop)) {\n        const { descriptor, isPrototypeField } = this.__sdk_access_field_descriptors__.get(prop)!;\n\n        if (isPrototypeField) {\n          // For prototype fields, we just need the `delete` operator so that\n          // the instance will fallback to the prototype chain itself.\n          delete this[prop as keyof this];\n        } else {\n          Object.defineProperty(this, prop, descriptor);\n        }\n      }\n    });\n\n    this.sdk = sdk;\n    this.__is_initialized__ = true;\n  }\n\n  /**\n   * Creates a deprecation warning wrapped with a native Magic SDK warning type.\n   * Best practice is to warn users of upcoming deprecations at least one major\n   * version before the change is implemented. You can use this method to\n   * communicate deprecations in a manner consistent with Magic SDK core code.\n   */\n  protected createDeprecationWarning(options: {\n    method: string;\n    removalVersion: string;\n    useInstead?: string;\n  }): MagicExtensionWarning {\n    const { method, removalVersion, useInstead } = options;\n\n    const useInsteadSuffix = useInstead ? ` Use \\`${useInstead}\\` instead.` : '';\n    const message = `\\`${method}\\` will be removed from this Extension in version \\`${removalVersion}\\`.${useInsteadSuffix}`;\n    return new MagicExtensionWarning(this, 'DEPRECATION_NOTICE', message);\n  }\n\n  /**\n   * Creates a warning wrapped with a native Magic SDK warning type. This\n   * maintains consistency in warning messaging for consumers of Magic SDK and\n   * this Extension.\n   */\n  protected createWarning(code: string | number, message: string): MagicExtensionWarning {\n    return new MagicExtensionWarning(this, code, message);\n  }\n\n  /**\n   * Creates an error wrapped with a native Magic SDK error type. This maintains\n   * consistency in error handling for consumers of Magic SDK and this\n   * Extension.\n   */\n  protected createError<TData = any>(code: string | number, message: string, data: TData): MagicExtensionError<TData> {\n    return new MagicExtensionError<TData>(this, code, message, data);\n  }\n}\n\nabstract class InternalExtension<TName extends string, TConfig extends any = any> extends BaseExtension<TName> {\n  public abstract readonly config: TConfig;\n}\n\n/**\n * A base class representing \"extensions\" to the core Magic JS APIs. Extensions\n * enable new functionality by composing Magic endpoints methods together.\n */\nexport abstract class Extension<TName extends string = AnonymousExtension> extends BaseExtension<TName> {\n  /**\n   * This is a special constructor used to mark \"official\" extensions. These\n   * extensions are designed for special interaction with the Magic iframe using\n   * custom JSON RPC methods, business logic, and global configurations. This is\n   * intended for internal-use only (and provides no useful advantage to\n   * open-source extension developers over the regular `Extension` class).\n   *\n   * @internal\n   */\n  public static Internal = InternalExtension;\n  public static Anonymous: AnonymousExtension = 'anonymous extension';\n}\n\n/**\n * These fields are exposed on the `Extension` type,\n * but should be hidden from the public interface.\n */\ntype HiddenExtensionFields = 'name' | 'init' | 'config' | 'compat';\n\n/**\n * Gets the type contained in an array type.\n */\ntype UnwrapArray<T extends any[]> = T extends Array<infer P> ? P : never;\n\n/**\n * Create a union type of Extension names from an\n * array of Extension types given by `TExt`.\n */\ntype ExtensionNames<TExt extends Extension<string>[]> = UnwrapArray<TExt> extends Extension<infer R> ? R : never;\n\n/**\n * From the literal Extension name type given by `TExtName`,\n * extract a dictionary of Extension types.\n */\ntype GetExtensionFromName<TExt extends Extension<string>[], TExtName extends string> = {\n  [P in TExtName]: Extract<UnwrapArray<TExt>, Extension<TExtName>>;\n}[TExtName];\n\n/**\n * Wraps a Magic SDK constructor with the necessary type\n * information to support a strongly-typed `Extension` interface.\n */\nexport type WithExtensions<SDK extends SDKBase> = {\n  new <TCustomExtName extends string, TExt extends MagicSDKExtensionsOption<TCustomExtName>>(\n    apiKey: string,\n    options?: MagicSDKAdditionalConfiguration<TCustomExtName, TExt>,\n  ): InstanceWithExtensions<SDK, TExt>;\n};\n\nexport type InstanceWithExtensions<SDK extends SDKBase, TExt extends MagicSDKExtensionsOption> = SDK &\n  {\n    [P in Exclude<\n      TExt extends Extension<string>[] ? ExtensionNames<TExt> : keyof TExt,\n      number | AnonymousExtension\n    >]: TExt extends Extension<string>[]\n      ? Omit<GetExtensionFromName<TExt, P>, HiddenExtensionFields>\n      : TExt extends {\n          [P in Exclude<\n            TExt extends Extension<string>[] ? ExtensionNames<TExt> : keyof TExt,\n            number | AnonymousExtension\n          >]: Extension<string>;\n        }\n      ? Omit<TExt[P], HiddenExtensionFields>\n      : never;\n  };\n","/* eslint-disable no-param-reassign  */\n\nimport { EthNetworkConfiguration, QueryParameters, SupportedLocale } from '@magic-sdk/types';\nimport type { AbstractProvider } from 'web3-core';\nimport { coerce, satisfies } from '../util/semver';\nimport { encodeJSON } from '../util/base64-json';\nimport {\n  createMissingApiKeyError,\n  createReactNativeEndpointConfigurationWarning,\n  createIncompatibleExtensionsError,\n} from './sdk-exceptions';\nimport { AuthModule } from '../modules/auth';\nimport { UserModule } from '../modules/user';\nimport { RPCProviderModule } from '../modules/rpc-provider';\nimport { ViewController } from './view-controller';\nimport { createURL } from '../util/url';\nimport { Extension } from '../modules/base-extension';\nimport { isEmpty } from '../util/type-guards';\nimport { SDKEnvironment, sdkNameToEnvName } from './sdk-environment';\n\n/**\n * Checks if the given `ext` is compatible with the platform & version of Magic\n * SDK currently in use.\n */\nfunction checkExtensionCompat(ext: Extension<string>) {\n  if (ext.compat && ext.compat[SDKEnvironment.sdkName] != null) {\n    return typeof ext.compat[SDKEnvironment.sdkName] === 'string'\n      ? satisfies(coerce(SDKEnvironment.version), ext.compat[SDKEnvironment.sdkName] as string)\n      : !!ext.compat[SDKEnvironment.sdkName];\n  }\n\n  // To gracefully support older extensions, we assume\n  // compatibility when the `compat` field is missing.\n  return true;\n}\n\n/**\n * Initializes SDK extensions, checks for platform/version compatiblity issues,\n * then consolidates any global configurations provided by those extensions.\n */\nfunction prepareExtensions(this: SDKBase, options?: MagicSDKAdditionalConfiguration): Record<string, any> {\n  const extensions: Extension<string>[] | { [key: string]: Extension<string> } = options?.extensions ?? [];\n  const extConfig: any = {};\n  const incompatibleExtensions: Extension<string>[] = [];\n\n  if (Array.isArray(extensions)) {\n    extensions.forEach((ext) => {\n      if (checkExtensionCompat(ext)) {\n        ext.init(this);\n        if (ext.name || ext.name !== Extension.Anonymous) {\n          // Only apply extensions with a known, defined `name` parameter.\n          (this as any)[ext.name] = ext;\n        }\n        if (ext instanceof Extension.Internal) {\n          if (!isEmpty(ext.config)) extConfig[ext.name] = ext.config;\n        }\n      } else {\n        incompatibleExtensions.push(ext);\n      }\n    });\n  } else {\n    Object.keys(extensions).forEach((name) => {\n      if (checkExtensionCompat(extensions[name])) {\n        extensions[name].init(this);\n        const ext = extensions[name];\n        (this as any)[name] = ext;\n        if (ext instanceof Extension.Internal) {\n          if (!isEmpty(ext.config)) extConfig[extensions[name].name] = ext.config;\n        }\n      } else {\n        incompatibleExtensions.push(extensions[name]);\n      }\n    });\n  }\n\n  if (incompatibleExtensions.length) {\n    throw createIncompatibleExtensionsError(incompatibleExtensions);\n  }\n\n  return extConfig;\n}\n\nexport type MagicSDKExtensionsOption<TCustomExtName extends string = string> =\n  | Extension<string>[]\n  | { [P in TCustomExtName]: Extension<string> };\n\nexport interface MagicSDKAdditionalConfiguration<\n  TCustomExtName extends string = string,\n  TExt extends MagicSDKExtensionsOption<TCustomExtName> = any,\n> {\n  endpoint?: string;\n  locale?: SupportedLocale;\n  network?: EthNetworkConfiguration;\n  extensions?: TExt;\n  testMode?: boolean;\n}\n\nexport class SDKBase {\n  private static readonly __overlays__: Map<string, ViewController> = new Map();\n\n  protected readonly endpoint: string;\n  protected readonly parameters: string;\n  public readonly testMode: boolean;\n\n  /**\n   * Contains methods for starting a Magic SDK authentication flow.\n   */\n  public readonly auth: AuthModule;\n\n  /**\n   * Contains methods for interacting with user data, checking login\n   * status, generating cryptographically-secure ID tokens, and more.\n   */\n  public readonly user: UserModule;\n\n  /**\n   * Contains a Web3-compliant provider. Pass this module to your Web3/Ethers\n   * instance for automatic compatibility with Ethereum methods.\n   */\n  public readonly rpcProvider: RPCProviderModule & AbstractProvider;\n\n  /**\n   * Creates an instance of Magic SDK.\n   */\n  constructor(public readonly apiKey: string, options?: MagicSDKAdditionalConfiguration) {\n    if (!apiKey) throw createMissingApiKeyError();\n\n    if (SDKEnvironment.platform === 'react-native' && options?.endpoint) {\n      createReactNativeEndpointConfigurationWarning().log();\n    }\n\n    const { defaultEndpoint, version } = SDKEnvironment;\n    this.testMode = !!options?.testMode;\n    this.endpoint = createURL(options?.endpoint ?? defaultEndpoint).origin;\n\n    // Prepare built-in modules\n    this.auth = new AuthModule(this);\n    this.user = new UserModule(this);\n    this.rpcProvider = new RPCProviderModule(this) as any;\n\n    // Prepare extensions\n    const extConfig: any = prepareExtensions.call(this, options);\n\n    // Encode parameters as base64-JSON\n    this.parameters = encodeJSON<QueryParameters>({\n      API_KEY: this.apiKey,\n      DOMAIN_ORIGIN: window.location ? window.location.origin : '',\n      ETH_NETWORK: options?.network,\n      host: createURL(this.endpoint).host,\n      sdk: sdkNameToEnvName[SDKEnvironment.sdkName],\n      version,\n      ext: isEmpty(extConfig) ? undefined : extConfig,\n      locale: options?.locale || 'en_US',\n    });\n  }\n\n  /**\n   * Represents the view controller associated with this `MagicSDK` instance.\n   */\n  protected get overlay(): ViewController {\n    if (!SDKBase.__overlays__.has(this.parameters)) {\n      const controller = new SDKEnvironment.ViewController(this.endpoint, this.parameters);\n\n      // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n      // @ts-ignore - We don't want to expose this method to the user, but we\n      // need to invoke in here so that the `ViewController` is ready for use.\n      controller.init();\n\n      SDKBase.__overlays__.set(this.parameters, controller);\n    }\n\n    return SDKBase.__overlays__.get(this.parameters)!;\n  }\n\n  /**\n   * Preloads the Magic view, allowing for faster initial requests in browser\n   * environments. Awaiting the returned promise will signal when the Magic view\n   * has completed loading and is ready for requests.\n   */\n  public async preload() {\n    await this.overlay.ready;\n  }\n}\n","import {\n  MagicIncomingWindowMessage,\n  MagicOutgoingWindowMessage,\n  JsonRpcRequestPayload,\n  MagicMessageEvent,\n  MagicMessageRequest,\n} from '@magic-sdk/types';\nimport { JsonRpcResponse } from './json-rpc';\nimport { createPromise } from '../util/promise-tools';\nimport { getItem, setItem } from '../util/storage';\nimport { createJwt } from '../util/web-crypto';\nimport { SDKEnvironment } from './sdk-environment';\n\ninterface RemoveEventListenerFunction {\n  (): void;\n}\n\ninterface StandardizedResponse {\n  id?: string | number;\n  response?: JsonRpcResponse;\n}\n\n/**\n * Get the originating payload from a batch request using the specified `id`.\n */\nfunction getRequestPayloadFromBatch(\n  requestPayload: JsonRpcRequestPayload | JsonRpcRequestPayload[],\n  id?: string | number | null,\n): JsonRpcRequestPayload | undefined {\n  return id && Array.isArray(requestPayload)\n    ? requestPayload.find((p) => p.id === id)\n    : (requestPayload as JsonRpcRequestPayload);\n}\n\n/**\n * Ensures the incoming response follows the expected schema and parses for a\n * JSON RPC payload ID.\n */\nfunction standardizeResponse(\n  requestPayload: JsonRpcRequestPayload | JsonRpcRequestPayload[],\n  event: MagicMessageEvent,\n): StandardizedResponse {\n  const id = event.data.response?.id;\n  const requestPayloadResolved = getRequestPayloadFromBatch(requestPayload, id);\n\n  if (id && requestPayloadResolved) {\n    // Build a standardized response object\n    const response = new JsonRpcResponse(requestPayloadResolved)\n      .applyResult(event.data.response.result)\n      .applyError(event.data.response.error);\n\n    return { id, response };\n  }\n\n  return {};\n}\n\nasync function createMagicRequest(msgType: string, payload: JsonRpcRequestPayload | JsonRpcRequestPayload[]) {\n  const rt = await getItem<string>('rt');\n  let jwt;\n\n  // only for webcrypto platforms\n  if (SDKEnvironment.platform === 'web') {\n    try {\n      jwt = await createJwt();\n    } catch (e) {\n      console.error('webcrypto error', e);\n    }\n  }\n\n  if (!jwt) {\n    return { msgType, payload };\n  }\n\n  if (!rt) {\n    return { msgType, payload, jwt };\n  }\n\n  return { msgType, payload, jwt, rt };\n}\n\nasync function persistMagicEventRefreshToken(event: MagicMessageEvent) {\n  if (!event.data.rt) {\n    return;\n  }\n\n  await setItem('rt', event.data.rt);\n}\n\nexport abstract class ViewController {\n  public ready: Promise<void>;\n  protected readonly messageHandlers = new Set<(event: MagicMessageEvent) => any>();\n\n  /**\n   * Create an instance of `ViewController`\n   *\n   * @param endpoint - The URL for the relevant iframe context.\n   * @param parameters - The unique, encoded query parameters for the\n   * relevant iframe context.\n   */\n  constructor(protected readonly endpoint: string, protected readonly parameters: string) {\n    this.ready = this.waitForReady();\n    this.listen();\n  }\n\n  protected abstract init(): void;\n  protected abstract _post(data: MagicMessageRequest): Promise<void>;\n  protected abstract hideOverlay(): void;\n  protected abstract showOverlay(): void;\n\n  /**\n   * Send a payload to the Magic `<iframe>` for processing and automatically\n   * handle the acknowledging follow-up event(s).\n   *\n   * @param msgType - The type of message to encode with the data.\n   * @param payload - The JSON RPC payload to emit via `window.postMessage`.\n   */\n  public async post<ResultType = any>(\n    msgType: MagicOutgoingWindowMessage,\n    payload: JsonRpcRequestPayload[],\n  ): Promise<JsonRpcResponse<ResultType>[]>;\n\n  public async post<ResultType = any>(\n    msgType: MagicOutgoingWindowMessage,\n    payload: JsonRpcRequestPayload,\n  ): Promise<JsonRpcResponse<ResultType>>;\n\n  public async post<ResultType = any>(\n    msgType: MagicOutgoingWindowMessage,\n    payload: JsonRpcRequestPayload | JsonRpcRequestPayload[],\n  ): Promise<JsonRpcResponse<ResultType> | JsonRpcResponse<ResultType>[]> {\n    return createPromise(async (resolve) => {\n      await this.ready;\n\n      const batchData: JsonRpcResponse[] = [];\n      const batchIds = Array.isArray(payload) ? payload.map((p) => p.id) : [];\n      const msg = await createMagicRequest(`${msgType}-${this.parameters}`, payload);\n\n      await this._post(msg);\n\n      /**\n       * Collect successful RPC responses and resolve.\n       */\n      const acknowledgeResponse = (removeEventListener: RemoveEventListenerFunction) => (event: MagicMessageEvent) => {\n        const { id, response } = standardizeResponse(payload, event);\n        persistMagicEventRefreshToken(event);\n\n        if (id && response && Array.isArray(payload) && batchIds.includes(id)) {\n          batchData.push(response);\n\n          // For batch requests, we wait for all responses before resolving.\n          if (batchData.length === payload.length) {\n            removeEventListener();\n            resolve(batchData);\n          }\n        } else if (id && response && !Array.isArray(payload) && id === payload.id) {\n          removeEventListener();\n          resolve(response);\n        }\n      };\n\n      // Listen for and handle responses.\n      const removeResponseListener = this.on(\n        MagicIncomingWindowMessage.MAGIC_HANDLE_RESPONSE,\n        acknowledgeResponse(() => removeResponseListener()),\n      );\n    });\n  }\n\n  /**\n   * Listen for events received with the given `msgType`.\n   *\n   * @param msgType - The `msgType` encoded with the event data.\n   * @param handler - A handler function to execute on each event received.\n   * @return A `void` function to remove the attached event.\n   */\n  public on(\n    msgType: MagicIncomingWindowMessage,\n    handler: (this: Window, event: MagicMessageEvent) => any,\n  ): RemoveEventListenerFunction {\n    const boundHandler = handler.bind(window);\n\n    // We cannot effectively cover this function because it never gets reference\n    // by value. The functionality of this callback is tested within\n    // `initMessageListener`.\n    /* istanbul ignore next */\n    const listener = (event: MagicMessageEvent) => {\n      if (event.data.msgType === `${msgType}-${this.parameters}`) boundHandler(event);\n    };\n\n    this.messageHandlers.add(listener);\n    return () => this.messageHandlers.delete(listener);\n  }\n\n  private waitForReady() {\n    return new Promise<void>((resolve) => {\n      this.on(MagicIncomingWindowMessage.MAGIC_OVERLAY_READY, () => resolve());\n    });\n  }\n\n  /**\n   * Listen for messages sent from the underlying Magic `<WebView>`.\n   */\n  private listen() {\n    this.on(MagicIncomingWindowMessage.MAGIC_HIDE_OVERLAY, () => {\n      this.hideOverlay();\n    });\n\n    this.on(MagicIncomingWindowMessage.MAGIC_SHOW_OVERLAY, () => {\n      this.showOverlay();\n    });\n  }\n}\n"]},"metadata":{},"sourceType":"module"}