{"ast":null,"code":"\"use strict\"; // Copyright (c) 2018-2022 Coinbase, Inc. <https://www.coinbase.com/>\n// Licensed under the Apache License, version 2.0\n\nvar _slicedToArray = require(\"C:\\\\Users\\\\seins\\\\Documents\\\\GitHub\\\\react-website-v1\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/slicedToArray\");\n\nvar _classCallCheck = require(\"C:\\\\Users\\\\seins\\\\Documents\\\\GitHub\\\\react-website-v1\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/classCallCheck\");\n\nvar _createClass = require(\"C:\\\\Users\\\\seins\\\\Documents\\\\GitHub\\\\react-website-v1\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/createClass\");\n\nvar _inherits = require(\"C:\\\\Users\\\\seins\\\\Documents\\\\GitHub\\\\react-website-v1\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/inherits\");\n\nvar _createSuper = require(\"C:\\\\Users\\\\seins\\\\Documents\\\\GitHub\\\\react-website-v1\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/createSuper\");\n\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  Object.defineProperty(o, k2, {\n    enumerable: true,\n    get: function get() {\n      return m[k];\n    }\n  });\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\n\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) {\n    if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  }\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) {\n    if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n  }\n\n  __setModuleDefault(result, mod);\n\n  return result;\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.WalletSDKRelay = void 0;\n\nvar bind_decorator_1 = __importDefault(require(\"bind-decorator\"));\n\nvar eth_rpc_errors_1 = require(\"eth-rpc-errors\");\n\nvar rxjs_1 = require(\"rxjs\");\n\nvar operators_1 = require(\"rxjs/operators\");\n\nvar DiagnosticLogger_1 = require(\"../connection/DiagnosticLogger\");\n\nvar WalletSDKConnection_1 = require(\"../connection/WalletSDKConnection\");\n\nvar WalletUIError_1 = require(\"../provider/WalletUIError\");\n\nvar types_1 = require(\"../types\");\n\nvar util_1 = require(\"../util\");\n\nvar aes256gcm = __importStar(require(\"./aes256gcm\"));\n\nvar Session_1 = require(\"./Session\");\n\nvar WalletSDKRelayAbstract_1 = require(\"./WalletSDKRelayAbstract\");\n\nvar Web3Method_1 = require(\"./Web3Method\");\n\nvar Web3RequestCanceledMessage_1 = require(\"./Web3RequestCanceledMessage\");\n\nvar Web3RequestMessage_1 = require(\"./Web3RequestMessage\");\n\nvar Web3Response_1 = require(\"./Web3Response\");\n\nvar Web3ResponseMessage_1 = require(\"./Web3ResponseMessage\");\n\nvar WalletSDKRelay = /*#__PURE__*/function (_WalletSDKRelayAbstra) {\n  _inherits(WalletSDKRelay, _WalletSDKRelayAbstra);\n\n  var _super = _createSuper(WalletSDKRelay);\n\n  function WalletSDKRelay(options) {\n    var _this;\n\n    _classCallCheck(this, WalletSDKRelay);\n\n    var _a;\n\n    _this = _super.call(this);\n    _this.accountsCallback = null;\n    _this.chainCallback = null;\n    _this.appName = \"\";\n    _this.appLogoUrl = null;\n    _this.subscriptions = new rxjs_1.Subscription();\n    _this.linkAPIUrl = options.linkAPIUrl;\n    _this.storage = options.storage;\n    _this.options = options;\n\n    var _this$subscribe = _this.subscribe(),\n        session = _this$subscribe.session,\n        ui = _this$subscribe.ui,\n        connection = _this$subscribe.connection;\n\n    _this._session = session;\n    _this.connection = connection;\n    _this.relayEventManager = options.relayEventManager;\n\n    if (options.diagnosticLogger && options.eventListener) {\n      throw new Error(\"Can't have both eventListener and diagnosticLogger options, use only diagnosticLogger\");\n    }\n\n    if (options.eventListener) {\n      _this.diagnostic = {\n        // eslint-disable-next-line @typescript-eslint/unbound-method\n        log: options.eventListener.onEvent\n      };\n    } else {\n      _this.diagnostic = options.diagnosticLogger;\n    }\n\n    _this._reloadOnDisconnect = (_a = options.reloadOnDisconnect) !== null && _a !== void 0 ? _a : true;\n    _this.ui = ui;\n    return _this;\n  }\n\n  _createClass(WalletSDKRelay, [{\n    key: \"subscribe\",\n    value: function subscribe() {\n      var _this2 = this;\n\n      var session = Session_1.Session.load(this.storage) || new Session_1.Session(this.storage).save();\n      var connection = new WalletSDKConnection_1.WalletSDKConnection(session.id, session.key, this.linkAPIUrl, this.diagnostic);\n      this.subscriptions.add(connection.sessionConfig$.subscribe({\n        next: function next(sessionConfig) {\n          _this2.onSessionConfigChanged(sessionConfig);\n        },\n        error: function error() {\n          var _a;\n\n          (_a = _this2.diagnostic) === null || _a === void 0 ? void 0 : _a.log(DiagnosticLogger_1.EVENTS.GENERAL_ERROR, {\n            message: \"error while invoking session config callback\"\n          });\n        }\n      }));\n      this.subscriptions.add(connection.incomingEvent$.pipe((0, operators_1.filter)(function (m) {\n        return m.event === \"Web3Response\";\n      })).subscribe({\n        next: this.handleIncomingEvent\n      }));\n      this.subscriptions.add(connection.linked$.pipe((0, operators_1.skip)(1), (0, operators_1.tap)(function (linked) {\n        var _a;\n\n        _this2.isLinked = linked;\n\n        var cachedAddresses = _this2.storage.getItem(WalletSDKRelayAbstract_1.LOCAL_STORAGE_ADDRESSES_KEY);\n\n        if (linked) {\n          // Only set linked session variable one way\n          _this2.session.linked = linked;\n        }\n\n        _this2.isUnlinkedErrorState = false;\n\n        if (cachedAddresses) {\n          var addresses = cachedAddresses.split(\" \");\n          var wasConnectedViaStandalone = _this2.storage.getItem(\"IsStandaloneSigning\") === \"true\";\n\n          if (addresses[0] !== \"\" && !linked && _this2.session.linked && !wasConnectedViaStandalone) {\n            _this2.isUnlinkedErrorState = true;\n\n            var sessionIdHash = _this2.getSessionIdHash();\n\n            (_a = _this2.diagnostic) === null || _a === void 0 ? void 0 : _a.log(DiagnosticLogger_1.EVENTS.UNLINKED_ERROR_STATE, {\n              sessionIdHash: sessionIdHash\n            });\n          }\n        }\n      })).subscribe()); // if session is marked destroyed, reset and reload\n\n      this.subscriptions.add(connection.sessionConfig$.pipe((0, operators_1.filter)(function (c) {\n        return !!c.metadata && c.metadata.__destroyed === \"1\";\n      })).subscribe(function () {\n        var _a;\n\n        var alreadyDestroyed = connection.isDestroyed;\n        (_a = _this2.diagnostic) === null || _a === void 0 ? void 0 : _a.log(DiagnosticLogger_1.EVENTS.METADATA_DESTROYED, {\n          alreadyDestroyed: alreadyDestroyed,\n          sessionIdHash: _this2.getSessionIdHash()\n        });\n        return _this2.resetAndReload();\n      }));\n      this.subscriptions.add(connection.sessionConfig$.pipe((0, operators_1.filter)(function (c) {\n        return c.metadata && c.metadata.WalletUsername !== undefined;\n      })).pipe((0, operators_1.mergeMap)(function (c) {\n        return aes256gcm.decrypt(c.metadata.WalletUsername, session.secret);\n      })).subscribe({\n        next: function next(walletUsername) {\n          _this2.storage.setItem(WalletSDKRelayAbstract_1.WALLET_USER_NAME_KEY, walletUsername);\n        },\n        error: function error() {\n          var _a;\n\n          (_a = _this2.diagnostic) === null || _a === void 0 ? void 0 : _a.log(DiagnosticLogger_1.EVENTS.GENERAL_ERROR, {\n            message: \"Had error decrypting\",\n            value: \"username\"\n          });\n        }\n      }));\n      this.subscriptions.add(connection.sessionConfig$.pipe((0, operators_1.filter)(function (c) {\n        return c.metadata && c.metadata.AppVersion !== undefined;\n      })).pipe((0, operators_1.mergeMap)(function (c) {\n        return aes256gcm.decrypt(c.metadata.AppVersion, session.secret);\n      })).subscribe({\n        next: function next(appVersion) {\n          _this2.storage.setItem(WalletSDKRelayAbstract_1.APP_VERSION_KEY, appVersion);\n        },\n        error: function error() {\n          var _a;\n\n          (_a = _this2.diagnostic) === null || _a === void 0 ? void 0 : _a.log(DiagnosticLogger_1.EVENTS.GENERAL_ERROR, {\n            message: \"Had error decrypting\",\n            value: \"appversion\"\n          });\n        }\n      }));\n      this.subscriptions.add(connection.sessionConfig$.pipe((0, operators_1.filter)(function (c) {\n        return c.metadata && c.metadata.ChainId !== undefined && c.metadata.JsonRpcUrl !== undefined;\n      })).pipe((0, operators_1.mergeMap)(function (c) {\n        return (0, rxjs_1.zip)(aes256gcm.decrypt(c.metadata.ChainId, session.secret), aes256gcm.decrypt(c.metadata.JsonRpcUrl, session.secret));\n      })).pipe((0, operators_1.distinctUntilChanged)()).subscribe({\n        next: function next(_ref) {\n          var _ref2 = _slicedToArray(_ref, 2),\n              chainId = _ref2[0],\n              jsonRpcUrl = _ref2[1];\n\n          if (_this2.chainCallback) {\n            _this2.chainCallback(chainId, jsonRpcUrl);\n          }\n        },\n        error: function error() {\n          var _a;\n\n          (_a = _this2.diagnostic) === null || _a === void 0 ? void 0 : _a.log(DiagnosticLogger_1.EVENTS.GENERAL_ERROR, {\n            message: \"Had error decrypting\",\n            value: \"chainId|jsonRpcUrl\"\n          });\n        }\n      }));\n      this.subscriptions.add(connection.sessionConfig$.pipe((0, operators_1.filter)(function (c) {\n        return c.metadata && c.metadata.EthereumAddress !== undefined;\n      })).pipe((0, operators_1.mergeMap)(function (c) {\n        return aes256gcm.decrypt(c.metadata.EthereumAddress, session.secret);\n      })).subscribe({\n        next: function next(selectedAddress) {\n          if (_this2.accountsCallback) {\n            _this2.accountsCallback([selectedAddress]);\n          }\n\n          if (WalletSDKRelay.accountRequestCallbackIds.size > 0) {\n            // We get the ethereum address from the metadata.  If for whatever\n            // reason we don't get a response via an explicit web3 message\n            // we can still fulfill the eip1102 request.\n            Array.from(WalletSDKRelay.accountRequestCallbackIds.values()).forEach(function (id) {\n              var message = (0, Web3ResponseMessage_1.Web3ResponseMessage)({\n                id: id,\n                response: (0, Web3Response_1.RequestEthereumAccountsResponse)([selectedAddress])\n              });\n\n              _this2.invokeCallback(Object.assign(Object.assign({}, message), {\n                id: id\n              }));\n            });\n            WalletSDKRelay.accountRequestCallbackIds.clear();\n          }\n        },\n        error: function error() {\n          var _a;\n\n          (_a = _this2.diagnostic) === null || _a === void 0 ? void 0 : _a.log(DiagnosticLogger_1.EVENTS.GENERAL_ERROR, {\n            message: \"Had error decrypting\",\n            value: \"selectedAddress\"\n          });\n        }\n      }));\n      var ui = this.options.uiConstructor({\n        linkAPIUrl: this.options.linkAPIUrl,\n        version: this.options.version,\n        darkMode: this.options.darkMode,\n        session: session,\n        connected$: connection.connected$\n      });\n      connection.connect();\n      return {\n        session: session,\n        ui: ui,\n        connection: connection\n      };\n    }\n  }, {\n    key: \"attachUI\",\n    value: function attachUI() {\n      this.ui.attach();\n    }\n  }, {\n    key: \"resetAndReload\",\n    value: function resetAndReload() {\n      var _this3 = this;\n\n      this.connection.setSessionMetadata(\"__destroyed\", \"1\").pipe((0, operators_1.timeout)(1000), (0, operators_1.catchError)(function (_) {\n        return (0, rxjs_1.of)(null);\n      })).subscribe(function (_) {\n        var _a, _b, _c;\n\n        var isStandalone = _this3.ui.isStandalone();\n\n        try {\n          _this3.subscriptions.unsubscribe();\n        } catch (err) {\n          (_a = _this3.diagnostic) === null || _a === void 0 ? void 0 : _a.log(DiagnosticLogger_1.EVENTS.GENERAL_ERROR, {\n            message: \"Had error unsubscribing\"\n          });\n        }\n\n        (_b = _this3.diagnostic) === null || _b === void 0 ? void 0 : _b.log(DiagnosticLogger_1.EVENTS.SESSION_STATE_CHANGE, {\n          method: \"relay::resetAndReload\",\n          sessionMetadataChange: \"__destroyed, 1\",\n          sessionIdHash: _this3.getSessionIdHash()\n        });\n\n        _this3.connection.destroy();\n        /**\n         * Only clear storage if the session id we have in memory matches the one on disk\n         * Otherwise, in the case where we have 2 tabs, another tab might have cleared\n         * storage already.  In that case if we clear storage again, the user will be in\n         * a state where the first tab allows the user to connect but the session that\n         * was used isn't persisted.  This leaves the user in a state where they aren't\n         * connected to the mobile app.\n         */\n\n\n        var storedSession = Session_1.Session.load(_this3.storage);\n\n        if ((storedSession === null || storedSession === void 0 ? void 0 : storedSession.id) === _this3._session.id) {\n          _this3.storage.clear();\n        } else if (storedSession) {\n          (_c = _this3.diagnostic) === null || _c === void 0 ? void 0 : _c.log(DiagnosticLogger_1.EVENTS.SKIPPED_CLEARING_SESSION, {\n            sessionIdHash: _this3.getSessionIdHash(),\n            storedSessionIdHash: Session_1.Session.hash(storedSession.id)\n          });\n        }\n\n        if (_this3._reloadOnDisconnect) {\n          _this3.ui.reloadUI();\n\n          return;\n        }\n\n        if (_this3.accountsCallback) {\n          _this3.accountsCallback([], true);\n        }\n\n        var _this3$subscribe = _this3.subscribe(),\n            session = _this3$subscribe.session,\n            ui = _this3$subscribe.ui,\n            connection = _this3$subscribe.connection;\n\n        _this3._session = session;\n        _this3.connection = connection;\n        _this3.ui = ui;\n        if (isStandalone && _this3.ui.setStandalone) _this3.ui.setStandalone(true);\n\n        _this3.attachUI();\n      }, function (err) {\n        var _a;\n\n        (_a = _this3.diagnostic) === null || _a === void 0 ? void 0 : _a.log(DiagnosticLogger_1.EVENTS.FAILURE, {\n          method: \"relay::resetAndReload\",\n          message: \"failed to reset and reload with \".concat(err),\n          sessionIdHash: _this3.getSessionIdHash()\n        });\n      });\n    }\n  }, {\n    key: \"setAppInfo\",\n    value: function setAppInfo(appName, appLogoUrl) {\n      this.appName = appName;\n      this.appLogoUrl = appLogoUrl;\n    }\n  }, {\n    key: \"getStorageItem\",\n    value: function getStorageItem(key) {\n      return this.storage.getItem(key);\n    }\n  }, {\n    key: \"session\",\n    get: function get() {\n      return this._session;\n    }\n  }, {\n    key: \"setStorageItem\",\n    value: function setStorageItem(key, value) {\n      this.storage.setItem(key, value);\n    }\n  }, {\n    key: \"signEthereumMessage\",\n    value: function signEthereumMessage(message, address, addPrefix, typedDataJson) {\n      return this.sendRequest({\n        method: Web3Method_1.Web3Method.signEthereumMessage,\n        params: {\n          message: (0, util_1.hexStringFromBuffer)(message, true),\n          address: address,\n          addPrefix: addPrefix,\n          typedDataJson: typedDataJson || null\n        }\n      });\n    }\n  }, {\n    key: \"ethereumAddressFromSignedMessage\",\n    value: function ethereumAddressFromSignedMessage(message, signature, addPrefix) {\n      return this.sendRequest({\n        method: Web3Method_1.Web3Method.ethereumAddressFromSignedMessage,\n        params: {\n          message: (0, util_1.hexStringFromBuffer)(message, true),\n          signature: (0, util_1.hexStringFromBuffer)(signature, true),\n          addPrefix: addPrefix\n        }\n      });\n    }\n  }, {\n    key: \"signEthereumTransaction\",\n    value: function signEthereumTransaction(params) {\n      return this.sendRequest({\n        method: Web3Method_1.Web3Method.signEthereumTransaction,\n        params: {\n          fromAddress: params.fromAddress,\n          toAddress: params.toAddress,\n          weiValue: (0, util_1.bigIntStringFromBN)(params.weiValue),\n          data: (0, util_1.hexStringFromBuffer)(params.data, true),\n          nonce: params.nonce,\n          gasPriceInWei: params.gasPriceInWei ? (0, util_1.bigIntStringFromBN)(params.gasPriceInWei) : null,\n          maxFeePerGas: params.gasPriceInWei ? (0, util_1.bigIntStringFromBN)(params.gasPriceInWei) : null,\n          maxPriorityFeePerGas: params.gasPriceInWei ? (0, util_1.bigIntStringFromBN)(params.gasPriceInWei) : null,\n          gasLimit: params.gasLimit ? (0, util_1.bigIntStringFromBN)(params.gasLimit) : null,\n          chainId: params.chainId,\n          shouldSubmit: false\n        }\n      });\n    }\n  }, {\n    key: \"signAndSubmitEthereumTransaction\",\n    value: function signAndSubmitEthereumTransaction(params) {\n      return this.sendRequest({\n        method: Web3Method_1.Web3Method.signEthereumTransaction,\n        params: {\n          fromAddress: params.fromAddress,\n          toAddress: params.toAddress,\n          weiValue: (0, util_1.bigIntStringFromBN)(params.weiValue),\n          data: (0, util_1.hexStringFromBuffer)(params.data, true),\n          nonce: params.nonce,\n          gasPriceInWei: params.gasPriceInWei ? (0, util_1.bigIntStringFromBN)(params.gasPriceInWei) : null,\n          maxFeePerGas: params.maxFeePerGas ? (0, util_1.bigIntStringFromBN)(params.maxFeePerGas) : null,\n          maxPriorityFeePerGas: params.maxPriorityFeePerGas ? (0, util_1.bigIntStringFromBN)(params.maxPriorityFeePerGas) : null,\n          gasLimit: params.gasLimit ? (0, util_1.bigIntStringFromBN)(params.gasLimit) : null,\n          chainId: params.chainId,\n          shouldSubmit: true\n        }\n      });\n    }\n  }, {\n    key: \"submitEthereumTransaction\",\n    value: function submitEthereumTransaction(signedTransaction, chainId) {\n      return this.sendRequest({\n        method: Web3Method_1.Web3Method.submitEthereumTransaction,\n        params: {\n          signedTransaction: (0, util_1.hexStringFromBuffer)(signedTransaction, true),\n          chainId: chainId\n        }\n      });\n    }\n  }, {\n    key: \"scanQRCode\",\n    value: function scanQRCode(regExp) {\n      return this.sendRequest({\n        method: Web3Method_1.Web3Method.scanQRCode,\n        params: {\n          regExp: regExp\n        }\n      });\n    }\n  }, {\n    key: \"getQRCodeUrl\",\n    value: function getQRCodeUrl() {\n      return (0, util_1.createQrUrl)(this._session.id, this._session.secret, this.linkAPIUrl, false);\n    }\n  }, {\n    key: \"genericRequest\",\n    value: function genericRequest(data, action) {\n      return this.sendRequest({\n        method: Web3Method_1.Web3Method.generic,\n        params: {\n          action: action,\n          data: data\n        }\n      });\n    }\n  }, {\n    key: \"sendGenericMessage\",\n    value: function sendGenericMessage(request) {\n      return this.sendRequest(request);\n    }\n  }, {\n    key: \"sendRequest\",\n    value: function sendRequest(request) {\n      var _this4 = this;\n\n      var hideSnackbarItem = null;\n      var id = (0, util_1.randomBytesHex)(8);\n\n      var cancel = function cancel(error) {\n        _this4.publishWeb3RequestCanceledEvent(id);\n\n        _this4.handleErrorResponse(id, request.method, error);\n\n        hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n      };\n\n      var promise = new Promise(function (resolve, reject) {\n        if (!_this4.ui.isStandalone()) {\n          hideSnackbarItem = _this4.ui.showConnecting({\n            isUnlinkedErrorState: _this4.isUnlinkedErrorState,\n            onCancel: cancel,\n            onResetConnection: _this4.resetAndReload // eslint-disable-line @typescript-eslint/unbound-method\n\n          });\n        }\n\n        _this4.relayEventManager.callbacks.set(id, function (response) {\n          hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n\n          if (response.errorMessage) {\n            return reject(new Error(response.errorMessage));\n          }\n\n          resolve(response);\n        });\n\n        if (_this4.ui.isStandalone()) {\n          _this4.sendRequestStandalone(id, request);\n        } else {\n          _this4.publishWeb3RequestEvent(id, request);\n        }\n      });\n      return {\n        promise: promise,\n        cancel: cancel\n      };\n    }\n  }, {\n    key: \"setConnectDisabled\",\n    value: function setConnectDisabled(disabled) {\n      this.ui.setConnectDisabled(disabled);\n    }\n  }, {\n    key: \"setAccountsCallback\",\n    value: function setAccountsCallback(accountsCallback) {\n      this.accountsCallback = accountsCallback;\n    }\n  }, {\n    key: \"setChainCallback\",\n    value: function setChainCallback(chainCallback) {\n      this.chainCallback = chainCallback;\n    }\n  }, {\n    key: \"publishWeb3RequestEvent\",\n    value: function publishWeb3RequestEvent(id, request) {\n      var _this5 = this;\n\n      var _a;\n\n      var message = (0, Web3RequestMessage_1.Web3RequestMessage)({\n        id: id,\n        request: request\n      });\n      var storedSession = Session_1.Session.load(this.storage);\n      (_a = this.diagnostic) === null || _a === void 0 ? void 0 : _a.log(DiagnosticLogger_1.EVENTS.WEB3_REQUEST, {\n        eventId: message.id,\n        method: \"relay::\".concat(message.request.method),\n        sessionIdHash: this.getSessionIdHash(),\n        storedSessionIdHash: storedSession ? Session_1.Session.hash(storedSession.id) : \"\",\n        isSessionMismatched: ((storedSession === null || storedSession === void 0 ? void 0 : storedSession.id) !== this._session.id).toString()\n      });\n      this.subscriptions.add(this.publishEvent(\"Web3Request\", message, true).subscribe({\n        next: function next(_) {\n          var _a;\n\n          (_a = _this5.diagnostic) === null || _a === void 0 ? void 0 : _a.log(DiagnosticLogger_1.EVENTS.WEB3_REQUEST_PUBLISHED, {\n            eventId: message.id,\n            method: \"relay::\".concat(message.request.method),\n            sessionIdHash: _this5.getSessionIdHash(),\n            storedSessionIdHash: storedSession ? Session_1.Session.hash(storedSession.id) : \"\",\n            isSessionMismatched: ((storedSession === null || storedSession === void 0 ? void 0 : storedSession.id) !== _this5._session.id).toString()\n          });\n        },\n        error: function error(err) {\n          _this5.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n            id: message.id,\n            response: {\n              method: message.request.method,\n              errorMessage: err.message\n            }\n          }));\n        }\n      }));\n    }\n  }, {\n    key: \"publishWeb3RequestCanceledEvent\",\n    value: function publishWeb3RequestCanceledEvent(id) {\n      var message = (0, Web3RequestCanceledMessage_1.Web3RequestCanceledMessage)(id);\n      this.subscriptions.add(this.publishEvent(\"Web3RequestCanceled\", message, false).subscribe());\n    }\n  }, {\n    key: \"publishEvent\",\n    value: function publishEvent(event, message, callWebhook) {\n      var _this6 = this;\n\n      var secret = this.session.secret;\n      return new rxjs_1.Observable(function (subscriber) {\n        void aes256gcm.encrypt(JSON.stringify(Object.assign(Object.assign({}, message), {\n          origin: location.origin\n        })), secret).then(function (encrypted) {\n          subscriber.next(encrypted);\n          subscriber.complete();\n        });\n      }).pipe((0, operators_1.mergeMap)(function (encrypted) {\n        return _this6.connection.publishEvent(event, encrypted, callWebhook);\n      }));\n    }\n  }, {\n    key: \"handleIncomingEvent\",\n    value: function handleIncomingEvent(event) {\n      var _this7 = this;\n\n      try {\n        this.subscriptions.add(aes256gcm.decrypt(event.data, this.session.secret).pipe((0, operators_1.map)(function (c) {\n          return JSON.parse(c);\n        })).subscribe({\n          next: function next(json) {\n            var message = (0, Web3ResponseMessage_1.isWeb3ResponseMessage)(json) ? json : null;\n\n            if (!message) {\n              return;\n            }\n\n            _this7.handleWeb3ResponseMessage(message);\n          },\n          error: function error() {\n            var _a;\n\n            (_a = _this7.diagnostic) === null || _a === void 0 ? void 0 : _a.log(DiagnosticLogger_1.EVENTS.GENERAL_ERROR, {\n              message: \"Had error decrypting\",\n              value: \"incomingEvent\"\n            });\n          }\n        }));\n      } catch (_a) {\n        return;\n      }\n    }\n  }, {\n    key: \"handleWeb3ResponseMessage\",\n    value: function handleWeb3ResponseMessage(message) {\n      var _this8 = this;\n\n      var _a;\n\n      var response = message.response;\n      (_a = this.diagnostic) === null || _a === void 0 ? void 0 : _a.log(DiagnosticLogger_1.EVENTS.WEB3_RESPONSE, {\n        eventId: message.id,\n        method: \"relay::\".concat(response.method),\n        sessionIdHash: this.getSessionIdHash()\n      });\n\n      if ((0, Web3Response_1.isRequestEthereumAccountsResponse)(response)) {\n        WalletSDKRelay.accountRequestCallbackIds.forEach(function (id) {\n          return _this8.invokeCallback(Object.assign(Object.assign({}, message), {\n            id: id\n          }));\n        });\n        WalletSDKRelay.accountRequestCallbackIds.clear();\n        return;\n      }\n\n      this.invokeCallback(message);\n    }\n  }, {\n    key: \"handleErrorResponse\",\n    value: function handleErrorResponse(id, method, error, errorCode) {\n      this.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n        id: id,\n        response: (0, Web3Response_1.ErrorResponse)(method, (error !== null && error !== void 0 ? error : WalletUIError_1.WalletUIError.UserRejectedRequest).message, errorCode)\n      }));\n    }\n  }, {\n    key: \"invokeCallback\",\n    value: function invokeCallback(message) {\n      var callback = this.relayEventManager.callbacks.get(message.id);\n\n      if (callback) {\n        callback(message.response);\n        this.relayEventManager.callbacks.delete(message.id);\n      }\n    }\n  }, {\n    key: \"requestEthereumAccounts\",\n    value: function requestEthereumAccounts() {\n      var _this9 = this;\n\n      var request = {\n        method: Web3Method_1.Web3Method.requestEthereumAccounts,\n        params: {\n          appName: this.appName,\n          appLogoUrl: this.appLogoUrl || null\n        }\n      };\n      var hideSnackbarItem = null;\n      var id = (0, util_1.randomBytesHex)(8);\n\n      var cancel = function cancel(error) {\n        _this9.publishWeb3RequestCanceledEvent(id);\n\n        _this9.handleErrorResponse(id, request.method, error); // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n        // @ts-ignore\n\n\n        hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n      };\n\n      var promise = new Promise(function (resolve, reject) {\n        var _a;\n\n        _this9.relayEventManager.callbacks.set(id, function (response) {\n          _this9.ui.hideRequestEthereumAccounts(); // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n          // @ts-ignore\n\n\n          hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n\n          if (response.errorMessage) {\n            return reject(new Error(response.errorMessage));\n          }\n\n          resolve(response);\n        });\n\n        var userAgent = ((_a = window === null || window === void 0 ? void 0 : window.navigator) === null || _a === void 0 ? void 0 : _a.userAgent) || null;\n\n        if (userAgent && /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(userAgent)) {\n          window.location.href = \"https://go.cb-w.com/xoXnYwQimhb?cb_url=\".concat(encodeURIComponent(window.location.href));\n          return;\n        }\n\n        if (_this9.ui.inlineAccountsResponse()) {\n          var onAccounts = function onAccounts(accounts) {\n            _this9.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n              id: id,\n              response: (0, Web3Response_1.RequestEthereumAccountsResponse)(accounts)\n            }));\n          };\n\n          _this9.ui.requestEthereumAccounts({\n            onCancel: cancel,\n            onAccounts: onAccounts\n          });\n        } else {\n          _this9.ui.requestEthereumAccounts({\n            onCancel: cancel\n          });\n        }\n\n        WalletSDKRelay.accountRequestCallbackIds.add(id);\n\n        if (!_this9.ui.inlineAccountsResponse() && !_this9.ui.isStandalone()) {\n          _this9.publishWeb3RequestEvent(id, request);\n        }\n      });\n      return {\n        promise: promise,\n        cancel: cancel\n      };\n    }\n  }, {\n    key: \"selectProvider\",\n    value: function selectProvider(providerOptions) {\n      var _this10 = this;\n\n      var request = {\n        method: Web3Method_1.Web3Method.selectProvider,\n        params: {\n          providerOptions: providerOptions\n        }\n      };\n      var id = (0, util_1.randomBytesHex)(8);\n\n      var cancel = function cancel(error) {\n        _this10.publishWeb3RequestCanceledEvent(id);\n\n        _this10.handleErrorResponse(id, request.method, error);\n      };\n\n      var promise = new Promise(function (resolve, reject) {\n        _this10.relayEventManager.callbacks.set(id, function (response) {\n          if (response.errorMessage) {\n            return reject(new Error(response.errorMessage));\n          }\n\n          resolve(response);\n        });\n\n        var _cancel = function _cancel(_error) {\n          _this10.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n            id: id,\n            response: (0, Web3Response_1.SelectProviderResponse)(types_1.ProviderType.Unselected)\n          }));\n        };\n\n        var approve = function approve(selectedProviderKey) {\n          _this10.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n            id: id,\n            response: (0, Web3Response_1.SelectProviderResponse)(selectedProviderKey)\n          }));\n        };\n\n        if (_this10.ui.selectProvider) _this10.ui.selectProvider({\n          onApprove: approve,\n          onCancel: _cancel,\n          providerOptions: providerOptions\n        });\n      });\n      return {\n        cancel: cancel,\n        promise: promise\n      };\n    }\n  }, {\n    key: \"watchAsset\",\n    value: function watchAsset(type, address, symbol, decimals, image, chainId) {\n      var _this11 = this;\n\n      var request = {\n        method: Web3Method_1.Web3Method.watchAsset,\n        params: {\n          type: type,\n          options: {\n            address: address,\n            symbol: symbol,\n            decimals: decimals,\n            image: image\n          },\n          chainId: chainId\n        }\n      };\n      var hideSnackbarItem = null;\n      var id = (0, util_1.randomBytesHex)(8);\n\n      var cancel = function cancel(error) {\n        _this11.publishWeb3RequestCanceledEvent(id);\n\n        _this11.handleErrorResponse(id, request.method, error);\n\n        hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n      };\n\n      if (!this.ui.inlineWatchAsset()) {\n        hideSnackbarItem = this.ui.showConnecting({\n          isUnlinkedErrorState: this.isUnlinkedErrorState,\n          onCancel: cancel,\n          onResetConnection: this.resetAndReload // eslint-disable-line @typescript-eslint/unbound-method\n\n        });\n      }\n\n      var promise = new Promise(function (resolve, reject) {\n        _this11.relayEventManager.callbacks.set(id, function (response) {\n          hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n\n          if (response.errorMessage) {\n            return reject(new Error(response.errorMessage));\n          }\n\n          resolve(response);\n        });\n\n        var _cancel = function _cancel(_error) {\n          _this11.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n            id: id,\n            response: (0, Web3Response_1.WatchAssetReponse)(false)\n          }));\n        };\n\n        var approve = function approve() {\n          _this11.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n            id: id,\n            response: (0, Web3Response_1.WatchAssetReponse)(true)\n          }));\n        };\n\n        if (_this11.ui.inlineWatchAsset()) {\n          _this11.ui.watchAsset({\n            onApprove: approve,\n            onCancel: _cancel,\n            type: type,\n            address: address,\n            symbol: symbol,\n            decimals: decimals,\n            image: image,\n            chainId: chainId\n          });\n        }\n\n        if (!_this11.ui.inlineWatchAsset() && !_this11.ui.isStandalone()) {\n          _this11.publishWeb3RequestEvent(id, request);\n        }\n      });\n      return {\n        cancel: cancel,\n        promise: promise\n      };\n    }\n  }, {\n    key: \"addEthereumChain\",\n    value: function addEthereumChain(chainId, rpcUrls, iconUrls, blockExplorerUrls, chainName, nativeCurrency) {\n      var _this12 = this;\n\n      var request = {\n        method: Web3Method_1.Web3Method.addEthereumChain,\n        params: {\n          chainId: chainId,\n          rpcUrls: rpcUrls,\n          blockExplorerUrls: blockExplorerUrls,\n          chainName: chainName,\n          iconUrls: iconUrls,\n          nativeCurrency: nativeCurrency\n        }\n      };\n      var hideSnackbarItem = null;\n      var id = (0, util_1.randomBytesHex)(8);\n\n      var cancel = function cancel(error) {\n        _this12.publishWeb3RequestCanceledEvent(id);\n\n        _this12.handleErrorResponse(id, request.method, error);\n\n        hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n      };\n\n      if (!this.ui.inlineAddEthereumChain(chainId)) {\n        hideSnackbarItem = this.ui.showConnecting({\n          isUnlinkedErrorState: this.isUnlinkedErrorState,\n          onCancel: cancel,\n          onResetConnection: this.resetAndReload // eslint-disable-line @typescript-eslint/unbound-method\n\n        });\n      }\n\n      var promise = new Promise(function (resolve, reject) {\n        _this12.relayEventManager.callbacks.set(id, function (response) {\n          hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n\n          if (response.errorMessage) {\n            return reject(new Error(response.errorMessage));\n          }\n\n          resolve(response);\n        });\n\n        var _cancel = function _cancel(_error) {\n          _this12.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n            id: id,\n            response: (0, Web3Response_1.AddEthereumChainResponse)({\n              isApproved: false,\n              rpcUrl: \"\"\n            })\n          }));\n        };\n\n        var approve = function approve(rpcUrl) {\n          _this12.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n            id: id,\n            response: (0, Web3Response_1.AddEthereumChainResponse)({\n              isApproved: true,\n              rpcUrl: rpcUrl\n            })\n          }));\n        };\n\n        if (_this12.ui.inlineAddEthereumChain(chainId)) {\n          _this12.ui.addEthereumChain({\n            onCancel: _cancel,\n            onApprove: approve,\n            chainId: request.params.chainId,\n            rpcUrls: request.params.rpcUrls,\n            blockExplorerUrls: request.params.blockExplorerUrls,\n            chainName: request.params.chainName,\n            iconUrls: request.params.iconUrls,\n            nativeCurrency: request.params.nativeCurrency\n          });\n        }\n\n        if (!_this12.ui.inlineAddEthereumChain(chainId) && !_this12.ui.isStandalone()) {\n          _this12.publishWeb3RequestEvent(id, request);\n        }\n      });\n      return {\n        promise: promise,\n        cancel: cancel\n      };\n    }\n  }, {\n    key: \"switchEthereumChain\",\n    value: function switchEthereumChain(chainId) {\n      var _this13 = this;\n\n      var request = {\n        method: Web3Method_1.Web3Method.switchEthereumChain,\n        params: {\n          chainId: chainId\n        }\n      };\n      var hideSnackbarItem = null;\n      var id = (0, util_1.randomBytesHex)(8);\n\n      var cancel = function cancel(error) {\n        _this13.publishWeb3RequestCanceledEvent(id);\n\n        _this13.handleErrorResponse(id, request.method, error);\n\n        hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n      };\n\n      if (!this.ui.inlineSwitchEthereumChain()) {\n        hideSnackbarItem = this.ui.showConnecting({\n          isUnlinkedErrorState: this.isUnlinkedErrorState,\n          onCancel: cancel,\n          onResetConnection: this.resetAndReload // eslint-disable-line @typescript-eslint/unbound-method\n\n        });\n      }\n\n      var promise = new Promise(function (resolve, reject) {\n        _this13.relayEventManager.callbacks.set(id, function (response) {\n          hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n\n          if (response.errorMessage && response.errorCode) {\n            return reject(eth_rpc_errors_1.ethErrors.provider.custom({\n              code: response.errorCode,\n              message: \"Unrecognized chain ID. Try adding the chain using addEthereumChain first.\"\n            }));\n          } else if (response.errorMessage) {\n            return reject(new Error(response.errorMessage));\n          }\n\n          resolve(response);\n        });\n\n        var _cancel = function _cancel(error) {\n          if (typeof error === \"number\") {\n            // backward compatibility\n            var errorCode = error;\n\n            _this13.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n              id: id,\n              response: (0, Web3Response_1.ErrorResponse)(Web3Method_1.Web3Method.switchEthereumChain, WalletUIError_1.WalletUIError.SwitchEthereumChainUnsupportedChainId.message, errorCode)\n            }));\n          } else if (error instanceof WalletUIError_1.WalletUIError) {\n            _this13.handleErrorResponse(id, Web3Method_1.Web3Method.switchEthereumChain, error, error.errorCode);\n          } else {\n            _this13.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n              id: id,\n              response: (0, Web3Response_1.SwitchEthereumChainResponse)({\n                isApproved: false,\n                rpcUrl: \"\"\n              })\n            }));\n          }\n        };\n\n        var approve = function approve(rpcUrl) {\n          _this13.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n            id: id,\n            response: (0, Web3Response_1.SwitchEthereumChainResponse)({\n              isApproved: true,\n              rpcUrl: rpcUrl\n            })\n          }));\n        };\n\n        _this13.ui.switchEthereumChain({\n          onCancel: _cancel,\n          onApprove: approve,\n          chainId: request.params.chainId\n        });\n\n        if (!_this13.ui.inlineSwitchEthereumChain() && !_this13.ui.isStandalone()) {\n          _this13.publishWeb3RequestEvent(id, request);\n        }\n      });\n      return {\n        promise: promise,\n        cancel: cancel\n      };\n    }\n  }, {\n    key: \"inlineAddEthereumChain\",\n    value: function inlineAddEthereumChain(chainId) {\n      return this.ui.inlineAddEthereumChain(chainId);\n    }\n  }, {\n    key: \"getSessionIdHash\",\n    value: function getSessionIdHash() {\n      return Session_1.Session.hash(this._session.id);\n    }\n  }, {\n    key: \"sendRequestStandalone\",\n    value: function sendRequestStandalone(id, request) {\n      var _this14 = this;\n\n      var _cancel = function _cancel(error) {\n        _this14.handleErrorResponse(id, request.method, error);\n      };\n\n      var onSuccess = function onSuccess(response) {\n        _this14.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n          id: id,\n          response: response\n        }));\n      };\n\n      switch (request.method) {\n        case Web3Method_1.Web3Method.signEthereumMessage:\n          this.ui.signEthereumMessage({\n            request: request,\n            onSuccess: onSuccess,\n            onCancel: _cancel\n          });\n          break;\n\n        case Web3Method_1.Web3Method.signEthereumTransaction:\n          this.ui.signEthereumTransaction({\n            request: request,\n            onSuccess: onSuccess,\n            onCancel: _cancel\n          });\n          break;\n\n        case Web3Method_1.Web3Method.submitEthereumTransaction:\n          this.ui.submitEthereumTransaction({\n            request: request,\n            onSuccess: onSuccess,\n            onCancel: _cancel\n          });\n          break;\n\n        case Web3Method_1.Web3Method.ethereumAddressFromSignedMessage:\n          this.ui.ethereumAddressFromSignedMessage({\n            request: request,\n            onSuccess: onSuccess\n          });\n          break;\n\n        default:\n          _cancel();\n\n          break;\n      }\n    }\n  }, {\n    key: \"onSessionConfigChanged\",\n    value: function onSessionConfigChanged(_nextSessionConfig) {}\n  }]);\n\n  return WalletSDKRelay;\n}(WalletSDKRelayAbstract_1.WalletSDKRelayAbstract);\n\nWalletSDKRelay.accountRequestCallbackIds = new Set();\n\n__decorate([bind_decorator_1.default], WalletSDKRelay.prototype, \"resetAndReload\", null);\n\n__decorate([bind_decorator_1.default], WalletSDKRelay.prototype, \"handleIncomingEvent\", null);\n\nexports.WalletSDKRelay = WalletSDKRelay;","map":{"version":3,"sources":["C:/Users/seins/Documents/GitHub/react-website-v1/node_modules/@coinbase/wallet-sdk/dist/relay/WalletSDKRelay.js"],"names":["__createBinding","Object","create","o","m","k","k2","undefined","defineProperty","enumerable","get","__setModuleDefault","v","value","__decorate","decorators","target","key","desc","c","arguments","length","r","getOwnPropertyDescriptor","d","Reflect","decorate","i","__importStar","mod","__esModule","result","prototype","hasOwnProperty","call","__importDefault","exports","WalletSDKRelay","bind_decorator_1","require","eth_rpc_errors_1","rxjs_1","operators_1","DiagnosticLogger_1","WalletSDKConnection_1","WalletUIError_1","types_1","util_1","aes256gcm","Session_1","WalletSDKRelayAbstract_1","Web3Method_1","Web3RequestCanceledMessage_1","Web3RequestMessage_1","Web3Response_1","Web3ResponseMessage_1","options","_a","accountsCallback","chainCallback","appName","appLogoUrl","subscriptions","Subscription","linkAPIUrl","storage","subscribe","session","ui","connection","_session","relayEventManager","diagnosticLogger","eventListener","Error","diagnostic","log","onEvent","_reloadOnDisconnect","reloadOnDisconnect","Session","load","save","WalletSDKConnection","id","add","sessionConfig$","next","sessionConfig","onSessionConfigChanged","error","EVENTS","GENERAL_ERROR","message","incomingEvent$","pipe","filter","event","handleIncomingEvent","linked$","skip","tap","linked","isLinked","cachedAddresses","getItem","LOCAL_STORAGE_ADDRESSES_KEY","isUnlinkedErrorState","addresses","split","wasConnectedViaStandalone","sessionIdHash","getSessionIdHash","UNLINKED_ERROR_STATE","metadata","__destroyed","alreadyDestroyed","isDestroyed","METADATA_DESTROYED","resetAndReload","WalletUsername","mergeMap","decrypt","secret","walletUsername","setItem","WALLET_USER_NAME_KEY","AppVersion","appVersion","APP_VERSION_KEY","ChainId","JsonRpcUrl","zip","distinctUntilChanged","chainId","jsonRpcUrl","EthereumAddress","selectedAddress","accountRequestCallbackIds","size","Array","from","values","forEach","Web3ResponseMessage","response","RequestEthereumAccountsResponse","invokeCallback","assign","clear","uiConstructor","version","darkMode","connected$","connect","attach","setSessionMetadata","timeout","catchError","_","of","_b","_c","isStandalone","unsubscribe","err","SESSION_STATE_CHANGE","method","sessionMetadataChange","destroy","storedSession","SKIPPED_CLEARING_SESSION","storedSessionIdHash","hash","reloadUI","setStandalone","attachUI","FAILURE","address","addPrefix","typedDataJson","sendRequest","Web3Method","signEthereumMessage","params","hexStringFromBuffer","signature","ethereumAddressFromSignedMessage","signEthereumTransaction","fromAddress","toAddress","weiValue","bigIntStringFromBN","data","nonce","gasPriceInWei","maxFeePerGas","maxPriorityFeePerGas","gasLimit","shouldSubmit","signedTransaction","submitEthereumTransaction","regExp","scanQRCode","createQrUrl","action","generic","request","hideSnackbarItem","randomBytesHex","cancel","publishWeb3RequestCanceledEvent","handleErrorResponse","promise","Promise","resolve","reject","showConnecting","onCancel","onResetConnection","callbacks","set","errorMessage","sendRequestStandalone","publishWeb3RequestEvent","disabled","setConnectDisabled","Web3RequestMessage","WEB3_REQUEST","eventId","isSessionMismatched","toString","publishEvent","WEB3_REQUEST_PUBLISHED","handleWeb3ResponseMessage","Web3RequestCanceledMessage","callWebhook","Observable","subscriber","encrypt","JSON","stringify","origin","location","then","encrypted","complete","map","parse","json","isWeb3ResponseMessage","WEB3_RESPONSE","isRequestEthereumAccountsResponse","errorCode","ErrorResponse","WalletUIError","UserRejectedRequest","callback","delete","requestEthereumAccounts","hideRequestEthereumAccounts","userAgent","window","navigator","test","href","encodeURIComponent","inlineAccountsResponse","onAccounts","accounts","providerOptions","selectProvider","_cancel","_error","SelectProviderResponse","ProviderType","Unselected","approve","selectedProviderKey","onApprove","type","symbol","decimals","image","watchAsset","inlineWatchAsset","WatchAssetReponse","rpcUrls","iconUrls","blockExplorerUrls","chainName","nativeCurrency","addEthereumChain","inlineAddEthereumChain","AddEthereumChainResponse","isApproved","rpcUrl","switchEthereumChain","inlineSwitchEthereumChain","ethErrors","provider","custom","code","SwitchEthereumChainUnsupportedChainId","SwitchEthereumChainResponse","onSuccess","_nextSessionConfig","WalletSDKRelayAbstract","Set","default"],"mappings":"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","sourcesContent":["\"use strict\";\n// Copyright (c) 2018-2022 Coinbase, Inc. <https://www.coinbase.com/>\n// Licensed under the Apache License, version 2.0\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.WalletSDKRelay = void 0;\nconst bind_decorator_1 = __importDefault(require(\"bind-decorator\"));\nconst eth_rpc_errors_1 = require(\"eth-rpc-errors\");\nconst rxjs_1 = require(\"rxjs\");\nconst operators_1 = require(\"rxjs/operators\");\nconst DiagnosticLogger_1 = require(\"../connection/DiagnosticLogger\");\nconst WalletSDKConnection_1 = require(\"../connection/WalletSDKConnection\");\nconst WalletUIError_1 = require(\"../provider/WalletUIError\");\nconst types_1 = require(\"../types\");\nconst util_1 = require(\"../util\");\nconst aes256gcm = __importStar(require(\"./aes256gcm\"));\nconst Session_1 = require(\"./Session\");\nconst WalletSDKRelayAbstract_1 = require(\"./WalletSDKRelayAbstract\");\nconst Web3Method_1 = require(\"./Web3Method\");\nconst Web3RequestCanceledMessage_1 = require(\"./Web3RequestCanceledMessage\");\nconst Web3RequestMessage_1 = require(\"./Web3RequestMessage\");\nconst Web3Response_1 = require(\"./Web3Response\");\nconst Web3ResponseMessage_1 = require(\"./Web3ResponseMessage\");\nclass WalletSDKRelay extends WalletSDKRelayAbstract_1.WalletSDKRelayAbstract {\n    constructor(options) {\n        var _a;\n        super();\n        this.accountsCallback = null;\n        this.chainCallback = null;\n        this.appName = \"\";\n        this.appLogoUrl = null;\n        this.subscriptions = new rxjs_1.Subscription();\n        this.linkAPIUrl = options.linkAPIUrl;\n        this.storage = options.storage;\n        this.options = options;\n        const { session, ui, connection } = this.subscribe();\n        this._session = session;\n        this.connection = connection;\n        this.relayEventManager = options.relayEventManager;\n        if (options.diagnosticLogger && options.eventListener) {\n            throw new Error(\"Can't have both eventListener and diagnosticLogger options, use only diagnosticLogger\");\n        }\n        if (options.eventListener) {\n            this.diagnostic = {\n                // eslint-disable-next-line @typescript-eslint/unbound-method\n                log: options.eventListener.onEvent,\n            };\n        }\n        else {\n            this.diagnostic = options.diagnosticLogger;\n        }\n        this._reloadOnDisconnect = (_a = options.reloadOnDisconnect) !== null && _a !== void 0 ? _a : true;\n        this.ui = ui;\n    }\n    subscribe() {\n        const session = Session_1.Session.load(this.storage) || new Session_1.Session(this.storage).save();\n        const connection = new WalletSDKConnection_1.WalletSDKConnection(session.id, session.key, this.linkAPIUrl, this.diagnostic);\n        this.subscriptions.add(connection.sessionConfig$.subscribe({\n            next: sessionConfig => {\n                this.onSessionConfigChanged(sessionConfig);\n            },\n            error: () => {\n                var _a;\n                (_a = this.diagnostic) === null || _a === void 0 ? void 0 : _a.log(DiagnosticLogger_1.EVENTS.GENERAL_ERROR, {\n                    message: \"error while invoking session config callback\",\n                });\n            },\n        }));\n        this.subscriptions.add(connection.incomingEvent$\n            .pipe((0, operators_1.filter)(m => m.event === \"Web3Response\"))\n            .subscribe({ next: this.handleIncomingEvent }));\n        this.subscriptions.add(connection.linked$\n            .pipe((0, operators_1.skip)(1), (0, operators_1.tap)((linked) => {\n            var _a;\n            this.isLinked = linked;\n            const cachedAddresses = this.storage.getItem(WalletSDKRelayAbstract_1.LOCAL_STORAGE_ADDRESSES_KEY);\n            if (linked) {\n                // Only set linked session variable one way\n                this.session.linked = linked;\n            }\n            this.isUnlinkedErrorState = false;\n            if (cachedAddresses) {\n                const addresses = cachedAddresses.split(\" \");\n                const wasConnectedViaStandalone = this.storage.getItem(\"IsStandaloneSigning\") === \"true\";\n                if (addresses[0] !== \"\" &&\n                    !linked &&\n                    this.session.linked &&\n                    !wasConnectedViaStandalone) {\n                    this.isUnlinkedErrorState = true;\n                    const sessionIdHash = this.getSessionIdHash();\n                    (_a = this.diagnostic) === null || _a === void 0 ? void 0 : _a.log(DiagnosticLogger_1.EVENTS.UNLINKED_ERROR_STATE, {\n                        sessionIdHash,\n                    });\n                }\n            }\n        }))\n            .subscribe());\n        // if session is marked destroyed, reset and reload\n        this.subscriptions.add(connection.sessionConfig$\n            .pipe((0, operators_1.filter)(c => !!c.metadata && c.metadata.__destroyed === \"1\"))\n            .subscribe(() => {\n            var _a;\n            const alreadyDestroyed = connection.isDestroyed;\n            (_a = this.diagnostic) === null || _a === void 0 ? void 0 : _a.log(DiagnosticLogger_1.EVENTS.METADATA_DESTROYED, {\n                alreadyDestroyed,\n                sessionIdHash: this.getSessionIdHash(),\n            });\n            return this.resetAndReload();\n        }));\n        this.subscriptions.add(connection.sessionConfig$\n            .pipe((0, operators_1.filter)(c => c.metadata && c.metadata.WalletUsername !== undefined))\n            .pipe((0, operators_1.mergeMap)(c => aes256gcm.decrypt(c.metadata.WalletUsername, session.secret)))\n            .subscribe({\n            next: walletUsername => {\n                this.storage.setItem(WalletSDKRelayAbstract_1.WALLET_USER_NAME_KEY, walletUsername);\n            },\n            error: () => {\n                var _a;\n                (_a = this.diagnostic) === null || _a === void 0 ? void 0 : _a.log(DiagnosticLogger_1.EVENTS.GENERAL_ERROR, {\n                    message: \"Had error decrypting\",\n                    value: \"username\",\n                });\n            },\n        }));\n        this.subscriptions.add(connection.sessionConfig$\n            .pipe((0, operators_1.filter)(c => c.metadata && c.metadata.AppVersion !== undefined))\n            .pipe((0, operators_1.mergeMap)(c => aes256gcm.decrypt(c.metadata.AppVersion, session.secret)))\n            .subscribe({\n            next: appVersion => {\n                this.storage.setItem(WalletSDKRelayAbstract_1.APP_VERSION_KEY, appVersion);\n            },\n            error: () => {\n                var _a;\n                (_a = this.diagnostic) === null || _a === void 0 ? void 0 : _a.log(DiagnosticLogger_1.EVENTS.GENERAL_ERROR, {\n                    message: \"Had error decrypting\",\n                    value: \"appversion\",\n                });\n            },\n        }));\n        this.subscriptions.add(connection.sessionConfig$\n            .pipe((0, operators_1.filter)(c => c.metadata &&\n            c.metadata.ChainId !== undefined &&\n            c.metadata.JsonRpcUrl !== undefined))\n            .pipe((0, operators_1.mergeMap)(c => (0, rxjs_1.zip)(aes256gcm.decrypt(c.metadata.ChainId, session.secret), aes256gcm.decrypt(c.metadata.JsonRpcUrl, session.secret))))\n            .pipe((0, operators_1.distinctUntilChanged)())\n            .subscribe({\n            next: ([chainId, jsonRpcUrl]) => {\n                if (this.chainCallback) {\n                    this.chainCallback(chainId, jsonRpcUrl);\n                }\n            },\n            error: () => {\n                var _a;\n                (_a = this.diagnostic) === null || _a === void 0 ? void 0 : _a.log(DiagnosticLogger_1.EVENTS.GENERAL_ERROR, {\n                    message: \"Had error decrypting\",\n                    value: \"chainId|jsonRpcUrl\",\n                });\n            },\n        }));\n        this.subscriptions.add(connection.sessionConfig$\n            .pipe((0, operators_1.filter)(c => c.metadata && c.metadata.EthereumAddress !== undefined))\n            .pipe((0, operators_1.mergeMap)(c => aes256gcm.decrypt(c.metadata.EthereumAddress, session.secret)))\n            .subscribe({\n            next: selectedAddress => {\n                if (this.accountsCallback) {\n                    this.accountsCallback([selectedAddress]);\n                }\n                if (WalletSDKRelay.accountRequestCallbackIds.size > 0) {\n                    // We get the ethereum address from the metadata.  If for whatever\n                    // reason we don't get a response via an explicit web3 message\n                    // we can still fulfill the eip1102 request.\n                    Array.from(WalletSDKRelay.accountRequestCallbackIds.values()).forEach(id => {\n                        const message = (0, Web3ResponseMessage_1.Web3ResponseMessage)({\n                            id,\n                            response: (0, Web3Response_1.RequestEthereumAccountsResponse)([\n                                selectedAddress,\n                            ]),\n                        });\n                        this.invokeCallback(Object.assign(Object.assign({}, message), { id }));\n                    });\n                    WalletSDKRelay.accountRequestCallbackIds.clear();\n                }\n            },\n            error: () => {\n                var _a;\n                (_a = this.diagnostic) === null || _a === void 0 ? void 0 : _a.log(DiagnosticLogger_1.EVENTS.GENERAL_ERROR, {\n                    message: \"Had error decrypting\",\n                    value: \"selectedAddress\",\n                });\n            },\n        }));\n        const ui = this.options.uiConstructor({\n            linkAPIUrl: this.options.linkAPIUrl,\n            version: this.options.version,\n            darkMode: this.options.darkMode,\n            session,\n            connected$: connection.connected$,\n        });\n        connection.connect();\n        return { session, ui, connection };\n    }\n    attachUI() {\n        this.ui.attach();\n    }\n    resetAndReload() {\n        this.connection\n            .setSessionMetadata(\"__destroyed\", \"1\")\n            .pipe((0, operators_1.timeout)(1000), (0, operators_1.catchError)(_ => (0, rxjs_1.of)(null)))\n            .subscribe(_ => {\n            var _a, _b, _c;\n            const isStandalone = this.ui.isStandalone();\n            try {\n                this.subscriptions.unsubscribe();\n            }\n            catch (err) {\n                (_a = this.diagnostic) === null || _a === void 0 ? void 0 : _a.log(DiagnosticLogger_1.EVENTS.GENERAL_ERROR, {\n                    message: \"Had error unsubscribing\",\n                });\n            }\n            (_b = this.diagnostic) === null || _b === void 0 ? void 0 : _b.log(DiagnosticLogger_1.EVENTS.SESSION_STATE_CHANGE, {\n                method: \"relay::resetAndReload\",\n                sessionMetadataChange: \"__destroyed, 1\",\n                sessionIdHash: this.getSessionIdHash(),\n            });\n            this.connection.destroy();\n            /**\n             * Only clear storage if the session id we have in memory matches the one on disk\n             * Otherwise, in the case where we have 2 tabs, another tab might have cleared\n             * storage already.  In that case if we clear storage again, the user will be in\n             * a state where the first tab allows the user to connect but the session that\n             * was used isn't persisted.  This leaves the user in a state where they aren't\n             * connected to the mobile app.\n             */\n            const storedSession = Session_1.Session.load(this.storage);\n            if ((storedSession === null || storedSession === void 0 ? void 0 : storedSession.id) === this._session.id) {\n                this.storage.clear();\n            }\n            else if (storedSession) {\n                (_c = this.diagnostic) === null || _c === void 0 ? void 0 : _c.log(DiagnosticLogger_1.EVENTS.SKIPPED_CLEARING_SESSION, {\n                    sessionIdHash: this.getSessionIdHash(),\n                    storedSessionIdHash: Session_1.Session.hash(storedSession.id),\n                });\n            }\n            if (this._reloadOnDisconnect) {\n                this.ui.reloadUI();\n                return;\n            }\n            if (this.accountsCallback) {\n                this.accountsCallback([], true);\n            }\n            const { session, ui, connection } = this.subscribe();\n            this._session = session;\n            this.connection = connection;\n            this.ui = ui;\n            if (isStandalone && this.ui.setStandalone)\n                this.ui.setStandalone(true);\n            this.attachUI();\n        }, (err) => {\n            var _a;\n            (_a = this.diagnostic) === null || _a === void 0 ? void 0 : _a.log(DiagnosticLogger_1.EVENTS.FAILURE, {\n                method: \"relay::resetAndReload\",\n                message: `failed to reset and reload with ${err}`,\n                sessionIdHash: this.getSessionIdHash(),\n            });\n        });\n    }\n    setAppInfo(appName, appLogoUrl) {\n        this.appName = appName;\n        this.appLogoUrl = appLogoUrl;\n    }\n    getStorageItem(key) {\n        return this.storage.getItem(key);\n    }\n    get session() {\n        return this._session;\n    }\n    setStorageItem(key, value) {\n        this.storage.setItem(key, value);\n    }\n    signEthereumMessage(message, address, addPrefix, typedDataJson) {\n        return this.sendRequest({\n            method: Web3Method_1.Web3Method.signEthereumMessage,\n            params: {\n                message: (0, util_1.hexStringFromBuffer)(message, true),\n                address,\n                addPrefix,\n                typedDataJson: typedDataJson || null,\n            },\n        });\n    }\n    ethereumAddressFromSignedMessage(message, signature, addPrefix) {\n        return this.sendRequest({\n            method: Web3Method_1.Web3Method.ethereumAddressFromSignedMessage,\n            params: {\n                message: (0, util_1.hexStringFromBuffer)(message, true),\n                signature: (0, util_1.hexStringFromBuffer)(signature, true),\n                addPrefix,\n            },\n        });\n    }\n    signEthereumTransaction(params) {\n        return this.sendRequest({\n            method: Web3Method_1.Web3Method.signEthereumTransaction,\n            params: {\n                fromAddress: params.fromAddress,\n                toAddress: params.toAddress,\n                weiValue: (0, util_1.bigIntStringFromBN)(params.weiValue),\n                data: (0, util_1.hexStringFromBuffer)(params.data, true),\n                nonce: params.nonce,\n                gasPriceInWei: params.gasPriceInWei\n                    ? (0, util_1.bigIntStringFromBN)(params.gasPriceInWei)\n                    : null,\n                maxFeePerGas: params.gasPriceInWei\n                    ? (0, util_1.bigIntStringFromBN)(params.gasPriceInWei)\n                    : null,\n                maxPriorityFeePerGas: params.gasPriceInWei\n                    ? (0, util_1.bigIntStringFromBN)(params.gasPriceInWei)\n                    : null,\n                gasLimit: params.gasLimit ? (0, util_1.bigIntStringFromBN)(params.gasLimit) : null,\n                chainId: params.chainId,\n                shouldSubmit: false,\n            },\n        });\n    }\n    signAndSubmitEthereumTransaction(params) {\n        return this.sendRequest({\n            method: Web3Method_1.Web3Method.signEthereumTransaction,\n            params: {\n                fromAddress: params.fromAddress,\n                toAddress: params.toAddress,\n                weiValue: (0, util_1.bigIntStringFromBN)(params.weiValue),\n                data: (0, util_1.hexStringFromBuffer)(params.data, true),\n                nonce: params.nonce,\n                gasPriceInWei: params.gasPriceInWei\n                    ? (0, util_1.bigIntStringFromBN)(params.gasPriceInWei)\n                    : null,\n                maxFeePerGas: params.maxFeePerGas\n                    ? (0, util_1.bigIntStringFromBN)(params.maxFeePerGas)\n                    : null,\n                maxPriorityFeePerGas: params.maxPriorityFeePerGas\n                    ? (0, util_1.bigIntStringFromBN)(params.maxPriorityFeePerGas)\n                    : null,\n                gasLimit: params.gasLimit ? (0, util_1.bigIntStringFromBN)(params.gasLimit) : null,\n                chainId: params.chainId,\n                shouldSubmit: true,\n            },\n        });\n    }\n    submitEthereumTransaction(signedTransaction, chainId) {\n        return this.sendRequest({\n            method: Web3Method_1.Web3Method.submitEthereumTransaction,\n            params: {\n                signedTransaction: (0, util_1.hexStringFromBuffer)(signedTransaction, true),\n                chainId,\n            },\n        });\n    }\n    scanQRCode(regExp) {\n        return this.sendRequest({\n            method: Web3Method_1.Web3Method.scanQRCode,\n            params: { regExp },\n        });\n    }\n    getQRCodeUrl() {\n        return (0, util_1.createQrUrl)(this._session.id, this._session.secret, this.linkAPIUrl, false);\n    }\n    genericRequest(data, action) {\n        return this.sendRequest({\n            method: Web3Method_1.Web3Method.generic,\n            params: {\n                action,\n                data,\n            },\n        });\n    }\n    sendGenericMessage(request) {\n        return this.sendRequest(request);\n    }\n    sendRequest(request) {\n        let hideSnackbarItem = null;\n        const id = (0, util_1.randomBytesHex)(8);\n        const cancel = (error) => {\n            this.publishWeb3RequestCanceledEvent(id);\n            this.handleErrorResponse(id, request.method, error);\n            hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n        };\n        const promise = new Promise((resolve, reject) => {\n            if (!this.ui.isStandalone()) {\n                hideSnackbarItem = this.ui.showConnecting({\n                    isUnlinkedErrorState: this.isUnlinkedErrorState,\n                    onCancel: cancel,\n                    onResetConnection: this.resetAndReload, // eslint-disable-line @typescript-eslint/unbound-method\n                });\n            }\n            this.relayEventManager.callbacks.set(id, response => {\n                hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n                if (response.errorMessage) {\n                    return reject(new Error(response.errorMessage));\n                }\n                resolve(response);\n            });\n            if (this.ui.isStandalone()) {\n                this.sendRequestStandalone(id, request);\n            }\n            else {\n                this.publishWeb3RequestEvent(id, request);\n            }\n        });\n        return { promise, cancel };\n    }\n    setConnectDisabled(disabled) {\n        this.ui.setConnectDisabled(disabled);\n    }\n    setAccountsCallback(accountsCallback) {\n        this.accountsCallback = accountsCallback;\n    }\n    setChainCallback(chainCallback) {\n        this.chainCallback = chainCallback;\n    }\n    publishWeb3RequestEvent(id, request) {\n        var _a;\n        const message = (0, Web3RequestMessage_1.Web3RequestMessage)({ id, request });\n        const storedSession = Session_1.Session.load(this.storage);\n        (_a = this.diagnostic) === null || _a === void 0 ? void 0 : _a.log(DiagnosticLogger_1.EVENTS.WEB3_REQUEST, {\n            eventId: message.id,\n            method: `relay::${message.request.method}`,\n            sessionIdHash: this.getSessionIdHash(),\n            storedSessionIdHash: storedSession ? Session_1.Session.hash(storedSession.id) : \"\",\n            isSessionMismatched: ((storedSession === null || storedSession === void 0 ? void 0 : storedSession.id) !== this._session.id).toString(),\n        });\n        this.subscriptions.add(this.publishEvent(\"Web3Request\", message, true).subscribe({\n            next: _ => {\n                var _a;\n                (_a = this.diagnostic) === null || _a === void 0 ? void 0 : _a.log(DiagnosticLogger_1.EVENTS.WEB3_REQUEST_PUBLISHED, {\n                    eventId: message.id,\n                    method: `relay::${message.request.method}`,\n                    sessionIdHash: this.getSessionIdHash(),\n                    storedSessionIdHash: storedSession\n                        ? Session_1.Session.hash(storedSession.id)\n                        : \"\",\n                    isSessionMismatched: ((storedSession === null || storedSession === void 0 ? void 0 : storedSession.id) !== this._session.id).toString(),\n                });\n            },\n            error: err => {\n                this.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n                    id: message.id,\n                    response: {\n                        method: message.request.method,\n                        errorMessage: err.message,\n                    },\n                }));\n            },\n        }));\n    }\n    publishWeb3RequestCanceledEvent(id) {\n        const message = (0, Web3RequestCanceledMessage_1.Web3RequestCanceledMessage)(id);\n        this.subscriptions.add(this.publishEvent(\"Web3RequestCanceled\", message, false).subscribe());\n    }\n    publishEvent(event, message, callWebhook) {\n        const secret = this.session.secret;\n        return new rxjs_1.Observable(subscriber => {\n            void aes256gcm\n                .encrypt(JSON.stringify(Object.assign(Object.assign({}, message), { origin: location.origin })), secret)\n                .then((encrypted) => {\n                subscriber.next(encrypted);\n                subscriber.complete();\n            });\n        }).pipe((0, operators_1.mergeMap)((encrypted) => {\n            return this.connection.publishEvent(event, encrypted, callWebhook);\n        }));\n    }\n    handleIncomingEvent(event) {\n        try {\n            this.subscriptions.add(aes256gcm\n                .decrypt(event.data, this.session.secret)\n                .pipe((0, operators_1.map)(c => JSON.parse(c)))\n                .subscribe({\n                next: json => {\n                    const message = (0, Web3ResponseMessage_1.isWeb3ResponseMessage)(json) ? json : null;\n                    if (!message) {\n                        return;\n                    }\n                    this.handleWeb3ResponseMessage(message);\n                },\n                error: () => {\n                    var _a;\n                    (_a = this.diagnostic) === null || _a === void 0 ? void 0 : _a.log(DiagnosticLogger_1.EVENTS.GENERAL_ERROR, {\n                        message: \"Had error decrypting\",\n                        value: \"incomingEvent\",\n                    });\n                },\n            }));\n        }\n        catch (_a) {\n            return;\n        }\n    }\n    handleWeb3ResponseMessage(message) {\n        var _a;\n        const { response } = message;\n        (_a = this.diagnostic) === null || _a === void 0 ? void 0 : _a.log(DiagnosticLogger_1.EVENTS.WEB3_RESPONSE, {\n            eventId: message.id,\n            method: `relay::${response.method}`,\n            sessionIdHash: this.getSessionIdHash(),\n        });\n        if ((0, Web3Response_1.isRequestEthereumAccountsResponse)(response)) {\n            WalletSDKRelay.accountRequestCallbackIds.forEach(id => this.invokeCallback(Object.assign(Object.assign({}, message), { id })));\n            WalletSDKRelay.accountRequestCallbackIds.clear();\n            return;\n        }\n        this.invokeCallback(message);\n    }\n    handleErrorResponse(id, method, error, errorCode) {\n        this.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n            id,\n            response: (0, Web3Response_1.ErrorResponse)(method, (error !== null && error !== void 0 ? error : WalletUIError_1.WalletUIError.UserRejectedRequest).message, errorCode),\n        }));\n    }\n    invokeCallback(message) {\n        const callback = this.relayEventManager.callbacks.get(message.id);\n        if (callback) {\n            callback(message.response);\n            this.relayEventManager.callbacks.delete(message.id);\n        }\n    }\n    requestEthereumAccounts() {\n        const request = {\n            method: Web3Method_1.Web3Method.requestEthereumAccounts,\n            params: {\n                appName: this.appName,\n                appLogoUrl: this.appLogoUrl || null,\n            },\n        };\n        const hideSnackbarItem = null;\n        const id = (0, util_1.randomBytesHex)(8);\n        const cancel = (error) => {\n            this.publishWeb3RequestCanceledEvent(id);\n            this.handleErrorResponse(id, request.method, error);\n            // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n            // @ts-ignore\n            hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n        };\n        const promise = new Promise((resolve, reject) => {\n            var _a;\n            this.relayEventManager.callbacks.set(id, response => {\n                this.ui.hideRequestEthereumAccounts();\n                // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n                // @ts-ignore\n                hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n                if (response.errorMessage) {\n                    return reject(new Error(response.errorMessage));\n                }\n                resolve(response);\n            });\n            const userAgent = ((_a = window === null || window === void 0 ? void 0 : window.navigator) === null || _a === void 0 ? void 0 : _a.userAgent) || null;\n            if (userAgent &&\n                /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(userAgent)) {\n                window.location.href = `https://go.cb-w.com/xoXnYwQimhb?cb_url=${encodeURIComponent(window.location.href)}`;\n                return;\n            }\n            if (this.ui.inlineAccountsResponse()) {\n                const onAccounts = (accounts) => {\n                    this.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n                        id,\n                        response: (0, Web3Response_1.RequestEthereumAccountsResponse)(accounts),\n                    }));\n                };\n                this.ui.requestEthereumAccounts({\n                    onCancel: cancel,\n                    onAccounts,\n                });\n            }\n            else {\n                this.ui.requestEthereumAccounts({\n                    onCancel: cancel,\n                });\n            }\n            WalletSDKRelay.accountRequestCallbackIds.add(id);\n            if (!this.ui.inlineAccountsResponse() && !this.ui.isStandalone()) {\n                this.publishWeb3RequestEvent(id, request);\n            }\n        });\n        return { promise, cancel };\n    }\n    selectProvider(providerOptions) {\n        const request = {\n            method: Web3Method_1.Web3Method.selectProvider,\n            params: {\n                providerOptions,\n            },\n        };\n        const id = (0, util_1.randomBytesHex)(8);\n        const cancel = (error) => {\n            this.publishWeb3RequestCanceledEvent(id);\n            this.handleErrorResponse(id, request.method, error);\n        };\n        const promise = new Promise((resolve, reject) => {\n            this.relayEventManager.callbacks.set(id, response => {\n                if (response.errorMessage) {\n                    return reject(new Error(response.errorMessage));\n                }\n                resolve(response);\n            });\n            const _cancel = (_error) => {\n                this.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n                    id,\n                    response: (0, Web3Response_1.SelectProviderResponse)(types_1.ProviderType.Unselected),\n                }));\n            };\n            const approve = (selectedProviderKey) => {\n                this.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n                    id,\n                    response: (0, Web3Response_1.SelectProviderResponse)(selectedProviderKey),\n                }));\n            };\n            if (this.ui.selectProvider)\n                this.ui.selectProvider({\n                    onApprove: approve,\n                    onCancel: _cancel,\n                    providerOptions,\n                });\n        });\n        return { cancel, promise };\n    }\n    watchAsset(type, address, symbol, decimals, image, chainId) {\n        const request = {\n            method: Web3Method_1.Web3Method.watchAsset,\n            params: {\n                type,\n                options: {\n                    address,\n                    symbol,\n                    decimals,\n                    image,\n                },\n                chainId,\n            },\n        };\n        let hideSnackbarItem = null;\n        const id = (0, util_1.randomBytesHex)(8);\n        const cancel = (error) => {\n            this.publishWeb3RequestCanceledEvent(id);\n            this.handleErrorResponse(id, request.method, error);\n            hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n        };\n        if (!this.ui.inlineWatchAsset()) {\n            hideSnackbarItem = this.ui.showConnecting({\n                isUnlinkedErrorState: this.isUnlinkedErrorState,\n                onCancel: cancel,\n                onResetConnection: this.resetAndReload, // eslint-disable-line @typescript-eslint/unbound-method\n            });\n        }\n        const promise = new Promise((resolve, reject) => {\n            this.relayEventManager.callbacks.set(id, response => {\n                hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n                if (response.errorMessage) {\n                    return reject(new Error(response.errorMessage));\n                }\n                resolve(response);\n            });\n            const _cancel = (_error) => {\n                this.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n                    id,\n                    response: (0, Web3Response_1.WatchAssetReponse)(false),\n                }));\n            };\n            const approve = () => {\n                this.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n                    id,\n                    response: (0, Web3Response_1.WatchAssetReponse)(true),\n                }));\n            };\n            if (this.ui.inlineWatchAsset()) {\n                this.ui.watchAsset({\n                    onApprove: approve,\n                    onCancel: _cancel,\n                    type,\n                    address,\n                    symbol,\n                    decimals,\n                    image,\n                    chainId,\n                });\n            }\n            if (!this.ui.inlineWatchAsset() && !this.ui.isStandalone()) {\n                this.publishWeb3RequestEvent(id, request);\n            }\n        });\n        return { cancel, promise };\n    }\n    addEthereumChain(chainId, rpcUrls, iconUrls, blockExplorerUrls, chainName, nativeCurrency) {\n        const request = {\n            method: Web3Method_1.Web3Method.addEthereumChain,\n            params: {\n                chainId,\n                rpcUrls,\n                blockExplorerUrls,\n                chainName,\n                iconUrls,\n                nativeCurrency,\n            },\n        };\n        let hideSnackbarItem = null;\n        const id = (0, util_1.randomBytesHex)(8);\n        const cancel = (error) => {\n            this.publishWeb3RequestCanceledEvent(id);\n            this.handleErrorResponse(id, request.method, error);\n            hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n        };\n        if (!this.ui.inlineAddEthereumChain(chainId)) {\n            hideSnackbarItem = this.ui.showConnecting({\n                isUnlinkedErrorState: this.isUnlinkedErrorState,\n                onCancel: cancel,\n                onResetConnection: this.resetAndReload, // eslint-disable-line @typescript-eslint/unbound-method\n            });\n        }\n        const promise = new Promise((resolve, reject) => {\n            this.relayEventManager.callbacks.set(id, response => {\n                hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n                if (response.errorMessage) {\n                    return reject(new Error(response.errorMessage));\n                }\n                resolve(response);\n            });\n            const _cancel = (_error) => {\n                this.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n                    id,\n                    response: (0, Web3Response_1.AddEthereumChainResponse)({\n                        isApproved: false,\n                        rpcUrl: \"\",\n                    }),\n                }));\n            };\n            const approve = (rpcUrl) => {\n                this.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n                    id,\n                    response: (0, Web3Response_1.AddEthereumChainResponse)({ isApproved: true, rpcUrl }),\n                }));\n            };\n            if (this.ui.inlineAddEthereumChain(chainId)) {\n                this.ui.addEthereumChain({\n                    onCancel: _cancel,\n                    onApprove: approve,\n                    chainId: request.params.chainId,\n                    rpcUrls: request.params.rpcUrls,\n                    blockExplorerUrls: request.params.blockExplorerUrls,\n                    chainName: request.params.chainName,\n                    iconUrls: request.params.iconUrls,\n                    nativeCurrency: request.params.nativeCurrency,\n                });\n            }\n            if (!this.ui.inlineAddEthereumChain(chainId) && !this.ui.isStandalone()) {\n                this.publishWeb3RequestEvent(id, request);\n            }\n        });\n        return { promise, cancel };\n    }\n    switchEthereumChain(chainId) {\n        const request = {\n            method: Web3Method_1.Web3Method.switchEthereumChain,\n            params: {\n                chainId,\n            },\n        };\n        let hideSnackbarItem = null;\n        const id = (0, util_1.randomBytesHex)(8);\n        const cancel = (error) => {\n            this.publishWeb3RequestCanceledEvent(id);\n            this.handleErrorResponse(id, request.method, error);\n            hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n        };\n        if (!this.ui.inlineSwitchEthereumChain()) {\n            hideSnackbarItem = this.ui.showConnecting({\n                isUnlinkedErrorState: this.isUnlinkedErrorState,\n                onCancel: cancel,\n                onResetConnection: this.resetAndReload, // eslint-disable-line @typescript-eslint/unbound-method\n            });\n        }\n        const promise = new Promise((resolve, reject) => {\n            this.relayEventManager.callbacks.set(id, response => {\n                hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n                if (response.errorMessage && response.errorCode) {\n                    return reject(eth_rpc_errors_1.ethErrors.provider.custom({\n                        code: response.errorCode,\n                        message: `Unrecognized chain ID. Try adding the chain using addEthereumChain first.`,\n                    }));\n                }\n                else if (response.errorMessage) {\n                    return reject(new Error(response.errorMessage));\n                }\n                resolve(response);\n            });\n            const _cancel = (error) => {\n                if (typeof error === \"number\") {\n                    // backward compatibility\n                    const errorCode = error;\n                    this.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n                        id,\n                        response: (0, Web3Response_1.ErrorResponse)(Web3Method_1.Web3Method.switchEthereumChain, WalletUIError_1.WalletUIError.SwitchEthereumChainUnsupportedChainId.message, errorCode),\n                    }));\n                }\n                else if (error instanceof WalletUIError_1.WalletUIError) {\n                    this.handleErrorResponse(id, Web3Method_1.Web3Method.switchEthereumChain, error, error.errorCode);\n                }\n                else {\n                    this.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n                        id,\n                        response: (0, Web3Response_1.SwitchEthereumChainResponse)({\n                            isApproved: false,\n                            rpcUrl: \"\",\n                        }),\n                    }));\n                }\n            };\n            const approve = (rpcUrl) => {\n                this.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n                    id,\n                    response: (0, Web3Response_1.SwitchEthereumChainResponse)({\n                        isApproved: true,\n                        rpcUrl,\n                    }),\n                }));\n            };\n            this.ui.switchEthereumChain({\n                onCancel: _cancel,\n                onApprove: approve,\n                chainId: request.params.chainId,\n            });\n            if (!this.ui.inlineSwitchEthereumChain() && !this.ui.isStandalone()) {\n                this.publishWeb3RequestEvent(id, request);\n            }\n        });\n        return { promise, cancel };\n    }\n    inlineAddEthereumChain(chainId) {\n        return this.ui.inlineAddEthereumChain(chainId);\n    }\n    getSessionIdHash() {\n        return Session_1.Session.hash(this._session.id);\n    }\n    sendRequestStandalone(id, request) {\n        const _cancel = (error) => {\n            this.handleErrorResponse(id, request.method, error);\n        };\n        const onSuccess = (response) => {\n            this.handleWeb3ResponseMessage((0, Web3ResponseMessage_1.Web3ResponseMessage)({\n                id,\n                response,\n            }));\n        };\n        switch (request.method) {\n            case Web3Method_1.Web3Method.signEthereumMessage:\n                this.ui.signEthereumMessage({\n                    request,\n                    onSuccess,\n                    onCancel: _cancel,\n                });\n                break;\n            case Web3Method_1.Web3Method.signEthereumTransaction:\n                this.ui.signEthereumTransaction({\n                    request,\n                    onSuccess,\n                    onCancel: _cancel,\n                });\n                break;\n            case Web3Method_1.Web3Method.submitEthereumTransaction:\n                this.ui.submitEthereumTransaction({\n                    request,\n                    onSuccess,\n                    onCancel: _cancel,\n                });\n                break;\n            case Web3Method_1.Web3Method.ethereumAddressFromSignedMessage:\n                this.ui.ethereumAddressFromSignedMessage({\n                    request,\n                    onSuccess,\n                });\n                break;\n            default:\n                _cancel();\n                break;\n        }\n    }\n    onSessionConfigChanged(_nextSessionConfig) { }\n}\nWalletSDKRelay.accountRequestCallbackIds = new Set();\n__decorate([\n    bind_decorator_1.default\n], WalletSDKRelay.prototype, \"resetAndReload\", null);\n__decorate([\n    bind_decorator_1.default\n], WalletSDKRelay.prototype, \"handleIncomingEvent\", null);\nexports.WalletSDKRelay = WalletSDKRelay;\n"]},"metadata":{},"sourceType":"script"}